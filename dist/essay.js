(()=>{"use strict";H5P.EventDispatcher,H5P.jQuery,H5P.JoubelUI;const t=H5P.Question,e=(H5P.shuffleArray,"h5p-essay-input-field-message-char-important"),i="h5p-essay-input-field-message-save-animation";class n{constructor(t,e){var i=this;this.params=t,this.previousState=t.previousState||"",this.callbacks=e||{},this.callbacks.onInteracted=this.callbacks.onInteracted||function(){},this.params.taskDescription=this.params.taskDescription||"",this.taskDescription=document.createElement("div"),this.taskDescription.classList.add("h5p-essay-input-field-label"),this.taskDescription.innerHTML=this.params.taskDescription,this.inputField=document.createElement("textarea"),this.inputField.classList.add("h5p-essay-input-field-textfield"),this.setText(this.previousState),this.oldValue=this.previousState,this.containsText=this.oldValue.length>0,this.inputField.addEventListener("blur",(function(){i.oldValue!==i.getText()&&i.callbacks.onInteracted({updateScore:!0}),i.oldValue=i.getText()})),this.inputField.addEventListener("input",(function(){(i.containsText&&0===i.getText().length||!i.containsText&&i.getText().length>0)&&i.callbacks.onInteracted(),i.containsText=i.getText().length>0})),this.content=document.createElement("div"),this.content.appendChild(this.inputField),this.container=document.createElement("div"),this.container.classList.add("h5p-essay-input-field"),this.container.appendChild(this.taskDescription),this.container.appendChild(this.content)}getIntroduction(){return this.taskDescription}getContent(){return this.content}getText(){return this.inputField.value}disable(){this.inputField.disabled=!0}enable(){this.inputField.disabled=!1}focus(){this.inputField.focus()}setText(t){void 0!==t&&("string"==typeof t&&(this.inputField.innerHTML=t),"object"!=typeof t||Array.isArray(t)||(this.inputField.innerHTML=t.inputField||""))}updateMessageChars(){}updateMessageSaved(t){void 0===t||""===t?this.statusSaved.classList.remove(i):this.statusSaved.classList.add(i),this.statusSaved.innerHTML=t}setMessageChars(t,i){"string"==typeof t&&("&nbsp;"===t||i?this.statusChars.removeAttribute("tabindex"):this.statusChars.setAttribute("tabindex",0),this.statusChars.innerHTML=t,i?this.statusChars.classList.add(e):this.statusChars.classList.remove(e))}}const s=function(){const e='<span class="h5p-essay-feedback-empty">...</span>';function i(e,n,s){if(!e)return;t.call(this,"essay"),this.params=i.extend({media:{},taskDescription:"",checkAnswer:"Check"},e),this.contentId=n,this.extras=s,console.log("*****************************hier1");const o=this.extras&&this.extras.metadata&&this.extras.metadata.defaultLanguage||"en";this.languageTag=i.formatLanguageCode(o),this.score=0,this.internalShowSolutionsCall=!1,void 0!==s&&void 0!==s.previousState&&(this.previousState=s.previousState),this.isAnswered=this.previousState&&this.previousState.inputField&&""!==this.previousState.inputField||!1,"object"==typeof this.previousState&&Object.keys(this.previousState).length&&this.updateScore()}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.registerDomElements=function(){const t=this,e=this.params.media?this.params.media.type:void 0;if(e&&e.library){const t=e.library.split(" ")[0];"H5P.Image"===t?e.params.file&&this.setImage(e.params.file.path,{disableImageZooming:this.params.media.disableImageZooming,alt:e.params.alt,title:e.params.title}):"H5P.Video"===t?e.params.sources&&this.setVideo(e):"H5P.Audio"===t&&e.params.files&&this.setAudio(e)}this.inputField=new n({taskDescription:this.params.taskDescription,previousState:this.previousState},{onInteracted:function(e){t.handleInteracted(e)},onInput:function(){t.handleInput()}}),this.setViewState(this.previousState&&this.previousState.viewState||"task"),"results"===this.viewState?H5P.externalDispatcher.on("initialized",(function(){t.handleCheckAnswer({skipXAPI:!0})})):"solutions"===this.viewState&&H5P.externalDispatcher.on("initialized",(function(){t.handleCheckAnswer({skipXAPI:!0}),t.showSolutions()})),this.content=this.inputField.getContent(),this.setContent(this.content),this.addButtons()},i.prototype.addButtons=function(){const t=this;t.addButton("check-answer",t.params.checkAnswer,(function(){t.handleCheckAnswer()}))},i.prototype.handleCheckAnswer=function(t){const e=this;t=i.extend({skipXAPI:!1},t),e.setViewState("results"),e.inputField.disable(),e.isAnswered=!0,e.handleEvaluation(t),e.hideButton("check-answer")},i.prototype.getInput=function(t){t=t||" ";let e="";return this.inputField?e=this.inputField.getText():this.previousState&&this.previousState.inputField&&(e=this.previousState.inputField),e.replace(/(\r\n|\r|\n)/g,t).replace(/\s\s/g," ")},i.prototype.handleInteracted=function(t){t=t||{},this.isAnswered=this.isAnswered||this.inputField.getText().length>0,this.triggerXAPI("interacted")},i.prototype.getAnswerGiven=function(){return this.isAnswered},i.prototype.getScore=function(){return Math.round(this.score)},i.prototype.showSolutions=function(){this.setViewState("solutions"),this.inputField.disable(),this.hideButton("show-solution"),this.internalShowSolutionsCall||(this.hideButton("check-answer"),this.hideButton("try-again")),this.trigger("resize")},i.prototype.resetTask=function(){this.setViewState("task"),this.setExplanation(),this.removeFeedback(),this.hideSolution(),this.hideButton("show-solution"),this.hideButton("try-again"),this.inputField.enable(),this.inputField.focus(),this.isAnswered=!1},i.prototype.getXAPIData=function(){return{statement:this.getXAPIAnswerEvent().data.statement}},i.prototype.isPassed=function(){return!0},i.prototype.handleEvaluation=function(t){t=i.extend({skipXAPI:!1},t);const e=this.computeResults();this.buildExplanation(e),t.skipXAPI||this.handleXAPI(),this.trigger("resize")},i.prototype.buildSolution=function(){const t=document.createElement("div");t.classList.add("h5p-essay-solution-container"),this.solutionAnnouncer=document.createElement("div"),this.solutionAnnouncer.setAttribute("tabindex","0"),this.solutionAnnouncer.addEventListener("focus",(function(t){t.target.blur(),t.target.setAttribute("tabindex","-1")})),t.appendChild(this.solutionAnnouncer);const e=document.createElement("div");return e.classList.add(SOLUTION_SAMPLE),t.appendChild(e),t},i.prototype.hideSolution=function(){null!==this.solution.parentNode&&this.solution.parentNode.removeChild(this.solution)},i.prototype.computeResults=function(){return[]},i.prototype.computeScore=function(t){return 0},i.prototype.buildExplanation=function(t){const i=[];return i.length>0&&i.sort((function(t,i){return t.correct===e&&i.correct!==e})),i},i.prototype.handleButtons=function(t){},i.prototype.handleXAPI=function(){this.trigger(this.getXAPIAnswerEvent()),this.trigger(this.createEssayXAPIEvent("passed"))},i.prototype.createEssayXAPIEvent=function(t){const e=this.createXAPIEventTemplate(t);return i.extend(e.getVerifiedStatementValue(["object","definition"]),this.getxAPIDefinition()),e},i.prototype.getxAPIDefinition=function(){const t={name:{}};return t.name[this.languageTag]=this.getTitle(),t.name["en-US"]=t.name[this.languageTag],t.description={},t.description[this.languageTag]=this.params.taskDescription+i.FILL_IN_PLACEHOLDER,t.description["en-US"]=t.description[this.languageTag],t.type="http://id.tincanapi.com/activitytype/essay",t.interactionType="long-fill-in",console.log("getxAPIDefinition"),console.log(t),t},i.prototype.getXAPIAnswerEvent=function(){const t=this.createEssayXAPIEvent("answered");return t.setScoredResult(this.getScore(),this.getScore(),this,!0,this.isPassed()),t.data.statement.result.response=this.inputField.getText(),console.log("getXAPIAnswerEvent"),console.log(t),console.log("**************************"),t},i.prototype.detectExactMatches=function(t,e){const n=[];let s=-1,o=0;for(t=t.replace(/\*/,"").replace(new RegExp(i.REGULAR_EXPRESSION_ASTERISK,"g"),"*");-1!==(s=e.indexOf(t))&&""!==t;)H5P.TextUtilities.isIsolated(t,e)&&n.push({keyword:t,match:t,index:o+s}),o+=s+t.length,e=e.substr(s+t.length);return n},i.prototype.detectWildcardMatches=function(t,e,n){if(-1===t.indexOf("*"))return[];t=t.replace(/[*]{2,}/g,"*"),["\\",".","[","]","?","+","(",")","{","}","|","!","^","-"].forEach((function(e){t=t.split(e).join("\\"+e)}));const s=new RegExp(t.replace(/\*/g,i.CHARS_WILDCARD+"+"),this.getRegExpModifiers(n)),o=[];let a;for(;null!==(a=s.exec(e));)H5P.TextUtilities.isIsolated(a[0],e,{index:a.index})&&o.push({keyword:t,match:a[0],index:a.index});return o},i.prototype.detectFuzzyMatches=function(t,e){const i=[];for(let n=-2;n<=2;n++)for(let s=0;s<e.length;s++){const o=e.substr(s,t.length+n);H5P.TextUtilities.areSimilar(t,o)&&H5P.TextUtilities.isIsolated(o,e,{index:s})&&(this.contains(i,s)||i.push({keyword:t,match:o,index:s}))}return i},i.prototype.getRegExpAlternatives=function(t,e,i){const n=this;return t.filter((function(t){return"/"===t[0]&&"/"===t[t.length-1]})).map((function(t){const s=new RegExp(t.slice(1,-1),n.getRegExpModifiers(i));return e.match(s)})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(t){return null!==t}))},i.prototype.getRegExpModifiers=function(t){const e=["g"];return t||e.push("i"),e.join("")},i.prototype.mergeMatches=function(){if(0===arguments.length)return[];if(1===arguments.length)return arguments[0];const t=(arguments[0]||[]).slice();for(let e=1;e<arguments.length;e++){const i=arguments[e]||[];for(let e=0;e<i.length;e++)this.contains(t,i[e].index)||t.push(i[e])}return t.sort((function(t,e){return t.index>e.index}))},i.prototype.contains=function(t,e){return t.some((function(t){return Math.abs(t.index-e)<=t.match.length}))},i.extend=function(){for(let t=1;t<arguments.length;t++)for(let e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&("object"==typeof arguments[0][e]&&"object"==typeof arguments[t][e]?this.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},i.prototype.getTitle=function(){let t;return this.extras.metadata&&(t=this.extras.metadata.title),t=t||i.DEFAULT_DESCRIPTION,H5P.createTitle(t)},i.formatLanguageCode=function(t){if("string"!=typeof t)return t;const e=t.split("-");return e[0]=e[0].toLowerCase(),e.length>1&&(e[1]=e[1].toUpperCase()),e.join("-")},i.prototype.htmlDecode=function(t){return(new DOMParser).parseFromString(t,"text/html").documentElement.textContent},i.prototype.getCurrentState=function(){if(this.inputField)return{inputField:this.inputField.getText(),viewState:this.viewState}},i.prototype.setViewState=function(t){-1!==i.VIEW_STATES.indexOf(t)&&(this.viewState=t)},i.CHARS_WILDCARD="[A-zÀ-ÖØ-öø-ÿͰ-ϿЀ-ӿ぀-ゟ぀-ヿ一-拿挀-矿砀-賿贀-鿿฀-๿]",i.FILL_IN_PLACEHOLDER="__________",i.DEFAULT_DESCRIPTION="EssayScore4LMS",i.REGULAR_EXPRESSION_ASTERISK=":::H5P-EssayScore4LMS-REGEXP-ASTERISK:::",i.VIEW_STATES=["task","results","solutions"],i}();H5P=H5P||{},H5P.EssayScore4LMS=s})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXNzYXkuanMiLCJtYXBwaW5ncyI6Im1CQUErQkEsSUFBSUMsZ0JBQ2JELElBQUlFLE9BQ0ZGLElBQUlHLFNBRnJCLE1BR01DLEVBQVdKLElBQUlJLFNDR3RCQyxHREZzQkwsSUFBSU0sYUNFRCxnREFFekJDLEVBQW9CLCtDQUdYLE1BQU1DLEVBYW5CQyxZQUFZQyxFQUFRQyxHQUNsQixJQUFJQyxFQUFPQyxLQUVYQSxLQUFLSCxPQUFTQSxFQUNkRyxLQUFLQyxjQUFnQkosRUFBT0ksZUFBaUIsR0FHN0NELEtBQUtGLFVBQVlBLEdBQWEsR0FDOUJFLEtBQUtGLFVBQVVJLGFBQWVGLEtBQUtGLFVBQVVJLGNBQWlCLGFBRzlERixLQUFLSCxPQUFPTSxnQkFBa0JILEtBQUtILE9BQU9NLGlCQUFtQixHQUk3REgsS0FBS0csZ0JBQWtCQyxTQUFTQyxjQUFjLE9BQzlDTCxLQUFLRyxnQkFBZ0JHLFVBQVVDLElBdENmLCtCQXVDaEJQLEtBQUtHLGdCQUFnQkssVUFBWVIsS0FBS0gsT0FBT00sZ0JBRzdDSCxLQUFLUyxXQUFhTCxTQUFTQyxjQUFjLFlBQ3pDTCxLQUFLUyxXQUFXSCxVQUFVQyxJQTFDVixtQ0E4Q2hCUCxLQUFLVSxRQUFRVixLQUFLQyxlQUNsQkQsS0FBS1csU0FBV1gsS0FBS0MsY0FFckJELEtBQUtZLGFBQWVaLEtBQUtXLFNBQVNFLE9BQVMsRUFHM0NiLEtBQUtTLFdBQVdLLGlCQUFpQixRQUFRLFdBQ25DZixFQUFLWSxXQUFhWixFQUFLZ0IsV0FDekJoQixFQUFLRCxVQUFVSSxhQUFhLENBQUVjLGFBQWEsSUFHN0NqQixFQUFLWSxTQUFXWixFQUFLZ0IsYUFNdkJmLEtBQUtTLFdBQVdLLGlCQUFpQixTQUFTLFlBRXRDZixFQUFLYSxjQUEwQyxJQUExQmIsRUFBS2dCLFVBQVVGLFNBQ25DZCxFQUFLYSxjQUFnQmIsRUFBS2dCLFVBQVVGLE9BQVMsSUFFOUNkLEVBQUtELFVBQVVJLGVBR2pCSCxFQUFLYSxhQUFlYixFQUFLZ0IsVUFBVUYsT0FBUyxLQUc5Q2IsS0FBS2lCLFFBQVViLFNBQVNDLGNBQWMsT0FDdENMLEtBQUtpQixRQUFRQyxZQUFZbEIsS0FBS1MsWUFHOUJULEtBQUttQixVQUFZZixTQUFTQyxjQUFjLE9BQ3hDTCxLQUFLbUIsVUFBVWIsVUFBVUMsSUFqRk4seUJBa0ZuQlAsS0FBS21CLFVBQVVELFlBQVlsQixLQUFLRyxpQkFDaENILEtBQUttQixVQUFVRCxZQUFZbEIsS0FBS2lCLFNBZ0NsQ0csa0JBQ0UsT0FBT3BCLEtBQUtHLGdCQU9ka0IsYUFDRSxPQUFPckIsS0FBS2lCLFFBT2RGLFVBQ0UsT0FBT2YsS0FBS1MsV0FBV2EsTUFNekJDLFVBQ0V2QixLQUFLUyxXQUFXZSxVQUFXLEVBTTdCQyxTQUNFekIsS0FBS1MsV0FBV2UsVUFBVyxFQU03QkUsUUFDRTFCLEtBQUtTLFdBQVdpQixRQU9sQmhCLFFBQVFULFFBQ3VCLElBQWxCQSxJQUdrQixpQkFBbEJBLElBQ1RELEtBQUtTLFdBQVdELFVBQVlQLEdBRUQsaUJBQWxCQSxHQUErQjBCLE1BQU1DLFFBQVEzQixLQUN0REQsS0FBS1MsV0FBV0QsVUFBWVAsRUFBY1EsWUFBYyxLQWU1RG9CLHNCQWtCQUMsbUJBQW1CQyxRQU1JLElBQVZBLEdBQW1DLEtBQVZBLEVBQ2xDL0IsS0FBS2dDLFlBQVkxQixVQUFVMkIsT0FBT3ZDLEdBSWxDTSxLQUFLZ0MsWUFBWTFCLFVBQVVDLElBQUliLEdBR2pDTSxLQUFLZ0MsWUFBWXhCLFVBQVl1QixFQVEvQkcsZ0JBQWdCQyxFQUFTQyxHQUtBLGlCQUFaRCxJQTVOTyxXQWdPZEEsR0FBNkJDLEVBSy9CcEMsS0FBS3FDLFlBQVlDLGdCQUFnQixZQUdqQ3RDLEtBQUtxQyxZQUFZRSxhQUFhLFdBQVksR0FHNUN2QyxLQUFLcUMsWUFBWTdCLFVBQVkyQixFQUN6QkMsRUFDRnBDLEtBQUtxQyxZQUFZL0IsVUFBVUMsSUFBSWYsR0FHL0JRLEtBQUtxQyxZQUFZL0IsVUFBVTJCLE9BQU96QyxLQzdPeEMsTUE4akNBLEVBOWpDd0IsV0FRdEIsTUFPTWdELEVBQWlCLG9EQVF2QixTQUFTQyxFQUFlQyxFQUFRQyxFQUFXQyxHQUV6QyxJQUFLRixFQUNILE9BSUZuRCxFQUFTc0QsS0FBSzdDLEtBQU0sU0FHcEJBLEtBQUtILE9BQVM0QyxFQUFlSyxPQUMzQixDQUNFQyxNQUFPLEdBQ1A1QyxnQkFBaUIsR0FZakI2QyxZQUFhLFNBZWZOLEdBQ0YxQyxLQUFLMkMsVUFBWUEsRUFDakIzQyxLQUFLaUQsT0FBU0wsRUFDZE0sUUFBUUMsSUFBSSxzQ0FDWixNQUFNQyxFQUFtQnBELEtBQUtpRCxRQUFVakQsS0FBS2lELE9BQU9JLFVBQVlyRCxLQUFLaUQsT0FBT0ksU0FBU0QsaUJBQTBCLEtBQy9HcEQsS0FBS3NELFlBQWNiLEVBQWVjLG1CQUFtQkgsR0FFckRwRCxLQUFLd0QsTUFBUSxFQUNieEQsS0FBS3lELDJCQUE0QixPQU1OLElBQWhCYixRQUFvRSxJQUE5QkEsRUFBWTNDLGdCQUMzREQsS0FBS0MsY0FBZ0IyQyxFQUFZM0MsZUFHbkNELEtBQUswRCxXQUFhMUQsS0FBS0MsZUFBaUJELEtBQUtDLGNBQWNRLFlBQWdELEtBQWxDVCxLQUFLQyxjQUFjUSxhQUFxQixFQTJDL0UsaUJBQXZCVCxLQUFLQyxlQUE4QjBELE9BQU9DLEtBQUs1RCxLQUFLQyxlQUFlWSxRQUM1RWIsS0FBS2dCLGNBODdCVCxPQXo3QkF5QixFQUFlb0IsVUFBWUYsT0FBT0csT0FBT3ZFLEVBQVNzRSxXQUNsRHBCLEVBQWVvQixVQUFVakUsWUFBYzZDLEVBS3ZDQSxFQUFlb0IsVUFBVUUsb0JBQXNCLFdBQzdDLE1BQU1oRSxFQUFPQyxLQUdQK0MsRUFBUy9DLEtBQUtILE9BQU9rRCxNQUFTL0MsS0FBS0gsT0FBT2tELE1BQU1pQixVQUFPQyxFQUM3RCxHQUFJbEIsR0FBU0EsRUFBTW1CLFFBQVMsQ0FDMUIsTUFBTUYsRUFBT2pCLEVBQU1tQixRQUFRQyxNQUFNLEtBQUssR0FDekIsY0FBVEgsRUFDRWpCLEVBQU1sRCxPQUFPdUUsTUFDZnBFLEtBQUtxRSxTQUFTdEIsRUFBTWxELE9BQU91RSxLQUFLRSxLQUFNLENBQ3BDQyxvQkFBcUJ2RSxLQUFLSCxPQUFPa0QsTUFBTXdCLG9CQUN2Q0MsSUFBS3pCLEVBQU1sRCxPQUFPMkUsSUFDbEJDLE1BQU8xQixFQUFNbEQsT0FBTzRFLFFBSVIsY0FBVFQsRUFDSGpCLEVBQU1sRCxPQUFPNkUsU0FDZjFFLEtBQUsyRSxTQUFTNUIsR0FHQSxjQUFUaUIsR0FDSGpCLEVBQU1sRCxPQUFPK0UsT0FDZjVFLEtBQUs2RSxTQUFTOUIsR0FhcEIvQyxLQUFLUyxXQUFhLElBQUlxRSxFQUFnQixDQUNwQzNFLGdCQUFpQkgsS0FBS0gsT0FBT00sZ0JBSzdCRixjQUFlRCxLQUFLQyxlQUVuQixDQUNEQyxhQUFlLFNBQVVMLEdBQ3ZCRSxFQUFLZ0YsaUJBQWlCbEYsSUFFeEJtRixRQUFVLFdBQ1JqRixFQUFLa0YsaUJBSVRqRixLQUFLa0YsYUFBYWxGLEtBQUtDLGVBQWlCRCxLQUFLQyxjQUFja0YsV0FBYSxRQUNqRCxZQUFuQm5GLEtBQUttRixVQUVQaEcsSUFBSWlHLG1CQUFtQkMsR0FBRyxlQUFlLFdBQ3ZDdEYsRUFBS3VGLGtCQUFrQixDQUFFQyxVQUFVLE9BR1gsY0FBbkJ2RixLQUFLbUYsV0FFWmhHLElBQUlpRyxtQkFBbUJDLEdBQUcsZUFBZSxXQUN2Q3RGLEVBQUt1RixrQkFBa0IsQ0FBRUMsVUFBVSxJQUNuQ3hGLEVBQUt5RixtQkFpQlR4RixLQUFLaUIsUUFBVWpCLEtBQUtTLFdBQVdZLGFBQy9CckIsS0FBS3lGLFdBQVd6RixLQUFLaUIsU0FHckJqQixLQUFLMEYsY0FNUGpELEVBQWVvQixVQUFVNkIsV0FBYSxXQUNwQyxNQUFNM0YsRUFBT0MsS0FhYkQsRUFBSzRGLFVBQVUsZUFBZ0I1RixFQUFLRixPQUFPbUQsYUFBYSxXQUN0RGpELEVBQUt1Rix3QkF3QlQ3QyxFQUFlb0IsVUFBVXlCLGtCQUFvQixTQUFVekYsR0FDckQsTUFBTUUsRUFBT0MsS0FFYkgsRUFBUzRDLEVBQWVLLE9BQU8sQ0FDN0J5QyxVQUFVLEdBQ1QxRixHQVVIRSxFQUFLbUYsYUFBYSxXQUVsQm5GLEVBQUtVLFdBQVdjLFVBTWhCeEIsRUFBSzJELFlBQWEsRUFDbEIzRCxFQUFLNkYsaUJBQWlCL0YsR0FLdEJFLEVBQUs4RixXQUFXLGlCQVFsQnBELEVBQWVvQixVQUFVaUMsU0FBVyxTQUFVQyxHQUM1Q0EsRUFBdUJBLEdBQXdCLElBRS9DLElBQUlDLEVBQVcsR0FRZixPQVBJaEcsS0FBS1MsV0FDUHVGLEVBQVdoRyxLQUFLUyxXQUFXTSxVQUVwQmYsS0FBS0MsZUFBaUJELEtBQUtDLGNBQWNRLGFBQ2hEdUYsRUFBV2hHLEtBQUtDLGNBQWNRLFlBR3pCdUYsRUFDSkMsUUFBUSxnQkFBaUJGLEdBQ3pCRSxRQUFRLFFBQVMsTUFRdEJ4RCxFQUFlb0IsVUFBVWtCLGlCQUFtQixTQUFVbEYsR0FDcERBLEVBQVNBLEdBQVUsR0FHbkJHLEtBQUswRCxXQUFhMUQsS0FBSzBELFlBQWMxRCxLQUFLUyxXQUFXTSxVQUFVRixPQUFTLEVBTXhFYixLQUFLa0csWUFBWSxlQVFuQnpELEVBQWVvQixVQUFVc0MsZUFBaUIsV0FDeEMsT0FBT25HLEtBQUswRCxZQVFkakIsRUFBZW9CLFVBQVV1QyxTQUFXLFdBRWxDLE9BQVFDLEtBQUtDLE1BQU10RyxLQUFLd0QsUUFpQjFCZixFQUFlb0IsVUFBVTJCLGNBQWdCLFdBQ3ZDeEYsS0FBS2tGLGFBQWEsYUFFbEJsRixLQUFLUyxXQUFXYyxVQW9CaEJ2QixLQUFLNkYsV0FBVyxpQkFHWDdGLEtBQUt5RCw0QkFDUnpELEtBQUs2RixXQUFXLGdCQUNoQjdGLEtBQUs2RixXQUFXLGNBR2xCN0YsS0FBS3VHLFFBQVEsV0FPZjlELEVBQWVvQixVQUFVMkMsVUFBWSxXQUNuQ3hHLEtBQUtrRixhQUFhLFFBRWxCbEYsS0FBS3lHLGlCQUNMekcsS0FBSzBHLGlCQUNMMUcsS0FBSzJHLGVBRUwzRyxLQUFLNkYsV0FBVyxpQkFDaEI3RixLQUFLNkYsV0FBVyxhQU9oQjdGLEtBQUtTLFdBQVdnQixTQUNoQnpCLEtBQUtTLFdBQVdpQixRQUVoQjFCLEtBQUswRCxZQUFhLEdBUXBCakIsRUFBZW9CLFVBQVUrQyxZQUFjLFdBQ3JDLE1BQU8sQ0FDTEMsVUFBVzdHLEtBQUs4RyxxQkFBcUJDLEtBQUtGLFlBUTlDcEUsRUFBZW9CLFVBQVVtRCxTQUFXLFdBQ2xDLE9BQU8sR0FpQlR2RSxFQUFlb0IsVUFBVStCLGlCQUFtQixTQUFVL0YsR0FDcERBLEVBQVM0QyxFQUFlSyxPQUFPLENBQzdCeUMsVUFBVSxHQUNUMUYsR0FDSCxNQUFNb0gsRUFBVWpILEtBQUtrSCxpQkFHQWxILEtBQUttSCxpQkFBaUJGLEdBd0J0Q3BILEVBQU8wRixVQUVWdkYsS0FBS29ILGFBR1BwSCxLQUFLdUcsUUFBUSxXQU9mOUQsRUFBZW9CLFVBQVV3RCxjQUFnQixXQUN2QyxNQUFNQyxFQUFXbEgsU0FBU0MsY0FBYyxPQUN4Q2lILEVBQVNoSCxVQUFVQyxJQW5mTSxnQ0FxZnpCUCxLQUFLdUgsa0JBQW9CbkgsU0FBU0MsY0FBYyxPQUNoREwsS0FBS3VILGtCQUFrQmhGLGFBQWEsV0FBWSxLQUVoRHZDLEtBQUt1SCxrQkFBa0J6RyxpQkFBaUIsU0FBUyxTQUFVMEcsR0FFekRBLEVBQU1DLE9BQU9DLE9BQ2JGLEVBQU1DLE9BQU9sRixhQUFhLFdBQVksU0FFeEMrRSxFQUFTcEcsWUFBWWxCLEtBQUt1SCxtQkFZMUIsTUFBTUksRUFBaUJ2SCxTQUFTQyxjQUFjLE9BSTlDLE9BSEFzSCxFQUFlckgsVUFBVUMsSUFBSXFILGlCQUM3Qk4sRUFBU3BHLFlBQVl5RyxHQUVkTCxHQU1UN0UsRUFBZW9CLFVBQVU4QyxhQUFlLFdBQ0wsT0FBN0IzRyxLQUFLc0gsU0FBU08sWUFDaEI3SCxLQUFLc0gsU0FBU08sV0FBV0MsWUFBWTlILEtBQUtzSCxXQVE5QzdFLEVBQWVvQixVQUFVcUQsZUFBaUIsV0F3RXhDLE1BdEVnQixJQThFbEJ6RSxFQUFlb0IsVUFBVWtFLGFBQWUsU0FBVWQsR0FLaEQsT0FKWSxHQVlkeEUsRUFBZW9CLFVBQVVzRCxpQkFBbUIsU0FBVUYsR0FDcEQsTUFBTWUsRUFBZSxHQXlDckIsT0FOSUEsRUFBYW5ILE9BQVMsR0FFeEJtSCxFQUFhQyxNQUFLLFNBQVVDLEVBQUdDLEdBQzdCLE9BQU9ELEVBQUVFLFVBQVk1RixHQUFrQjJGLEVBQUVDLFVBQVk1RixLQUdsRHdGLEdBT1R2RixFQUFlb0IsVUFBVXdFLGNBQWdCLFNBQVU3RSxLQW9CbkRmLEVBQWVvQixVQUFVdUQsV0FBYSxXQUNwQ3BILEtBQUt1RyxRQUFRdkcsS0FBSzhHLHNCQUdsQjlHLEtBQUt1RyxRQUFRdkcsS0FBS3NJLHFCQUFxQixZQW1CekM3RixFQUFlb0IsVUFBVXlFLHFCQUF1QixTQUFVQyxHQUN4RCxNQUFNQyxFQUFZeEksS0FBS3lJLHdCQUF3QkYsR0FJL0MsT0FIQTlGLEVBQWVLLE9BQ2IwRixFQUFVRSwwQkFBMEIsQ0FBQyxTQUFVLGVBQy9DMUksS0FBSzJJLHFCQUNBSCxHQU9UL0YsRUFBZW9CLFVBQVU4RSxrQkFBb0IsV0FDM0MsTUFBTUMsRUFBYSxDQUNuQkEsS0FBa0IsSUFrQmxCLE9BakJBQSxFQUFXQyxLQUFLN0ksS0FBS3NELGFBQWV0RCxLQUFLOEksV0FFekNGLEVBQVdDLEtBQUssU0FBV0QsRUFBV0MsS0FBSzdJLEtBQUtzRCxhQUVoRHNGLEVBQVdHLFlBQWMsR0FDekJILEVBQVdHLFlBQVkvSSxLQUFLc0QsYUFBZXRELEtBQUtILE9BQU9NLGdCQUFrQnNDLEVBQWV1RyxvQkFFeEZKLEVBQVdHLFlBQVksU0FBV0gsRUFBV0csWUFBWS9JLEtBQUtzRCxhQUM5RHNGLEVBQVc1RSxLQUFPLDZDQUNsQjRFLEVBQVdLLGdCQUFrQixlQU01Qi9GLFFBQVFDLElBQUkscUJBQ1pELFFBQVFDLElBQUl5RixHQUNOQSxHQU9UbkcsRUFBZW9CLFVBQVVpRCxtQkFBcUIsV0FDNUMsTUFBTTBCLEVBQVl4SSxLQUFLc0kscUJBQXFCLFlBUTVDLE9BTkFFLEVBQVVVLGdCQUFnQmxKLEtBQUtvRyxXQUFZcEcsS0FBS29HLFdBQVlwRyxNQUFNLEVBQU1BLEtBQUtnSCxZQUM3RXdCLEVBQVV6QixLQUFLRixVQUFVc0MsT0FBT0MsU0FBV3BKLEtBQUtTLFdBQVdNLFVBRTNEbUMsUUFBUUMsSUFBSSxzQkFDWkQsUUFBUUMsSUFBSXFGLEdBQ1p0RixRQUFRQyxJQUFJLDhCQUNMcUYsR0FTVC9GLEVBQWVvQixVQUFVd0YsbUJBQXFCLFNBQVVDLEVBQVFDLEdBRTlELE1BQU1KLEVBQVMsR0FDZixJQUFJSyxHQUFPLEVBQ1BDLEVBQVEsRUFNWixJQUpBSCxFQUFTQSxFQUNOckQsUUFBUSxLQUFNLElBQ2RBLFFBQVEsSUFBSXlELE9BQU9qSCxFQUFla0gsNEJBQTZCLEtBQU0sTUFFekIsS0FBdENILEVBQU1ELEVBQVNLLFFBQVFOLEtBQStCLEtBQVhBLEdBQzlDbkssSUFBSTBLLGNBQWNDLFdBQVdSLEVBQVFDLElBQ3ZDSixFQUFPWSxLQUFLLENBQUMsUUFBV1QsRUFBUSxNQUFTQSxFQUFRLE1BQVNHLEVBQVFELElBRXBFQyxHQUFTRCxFQUFNRixFQUFPekksT0FDdEIwSSxFQUFXQSxFQUFTUyxPQUFPUixFQUFNRixFQUFPekksUUFFMUMsT0FBT3NJLEdBVVQxRyxFQUFlb0IsVUFBVW9HLHNCQUF3QixTQUFVWCxFQUFRQyxFQUFVVyxHQUMzRSxJQUE2QixJQUF6QlosRUFBT00sUUFBUSxLQUNqQixNQUFPLEdBSVROLEVBQVNBLEVBQU9yRCxRQUFRLFdBQVksS0FHaEIsQ0FBQyxLQUFNLElBQUssSUFBSyxJQUFLLElBQUssSUFBSyxJQUFLLElBQUssSUFBSyxJQUFLLElBQUssSUFBSyxJQUFLLEtBQzNFa0UsU0FBUSxTQUFVQyxHQUM1QmQsRUFBU0EsRUFBT25GLE1BQU1pRyxHQUFNQyxLQUFLLEtBQU9ELE1BSTFDLE1BQU1FLEVBQVMsSUFBSVosT0FBT0osRUFBT3JELFFBQVEsTUFBT3hELEVBQWU4SCxlQUFpQixLQUFNdkssS0FBS3dLLG1CQUFtQk4sSUFDeEdmLEVBQVMsR0FDZixJQUFJc0IsRUFDSixLQUEyQyxRQUFuQ0EsRUFBUUgsRUFBT0ksS0FBS25CLEtBQ3RCcEssSUFBSTBLLGNBQWNDLFdBQVdXLEVBQU0sR0FBSWxCLEVBQVUsQ0FBQyxNQUFTa0IsRUFBTUUsU0FDbkV4QixFQUFPWSxLQUFLLENBQUMsUUFBV1QsRUFBUSxNQUFTbUIsRUFBTSxHQUFJLE1BQVNBLEVBQU1FLFFBR3RFLE9BQU94QixHQVNUMUcsRUFBZW9CLFVBQVUrRyxtQkFBcUIsU0FBVXRCLEVBQVFDLEdBRTlELE1BT010QyxFQUFVLEdBRWhCLElBQUssSUFBSTRELEdBVFUsRUFTVUEsR0FUVixFQVM4QkEsSUFDL0MsSUFBSyxJQUFJckIsRUFBTSxFQUFHQSxFQUFNRCxFQUFTMUksT0FBUTJJLElBQU8sQ0FDOUMsTUFBTXNCLEVBQVF2QixFQUFTUyxPQUFPUixFQUFLRixFQUFPekksT0FBU2dLLEdBQy9DMUwsSUFBSTBLLGNBQWNrQixXQUFXekIsRUFBUXdCLElBQVUzTCxJQUFJMEssY0FBY0MsV0FBV2dCLEVBQU92QixFQUFVLENBQUMsTUFBU0MsTUFFcEd4SixLQUFLZ0wsU0FBUy9ELEVBQVN1QyxJQUMxQnZDLEVBQVE4QyxLQUFLLENBQUMsUUFBV1QsRUFBUSxNQUFTd0IsRUFBTyxNQUFTdEIsS0FLbEUsT0FBT3ZDLEdBVVR4RSxFQUFlb0IsVUFBVW9ILHNCQUF3QixTQUFVQyxFQUFjQyxFQUFXakIsR0FDbEYsTUFBTW5LLEVBQU9DLEtBRWIsT0FBT2tMLEVBQ0pFLFFBQU8sU0FBVUMsR0FDaEIsTUFBMkIsTUFBbkJBLEVBQVksSUFBc0QsTUFBeENBLEVBQVlBLEVBQVl4SyxPQUFTLE1BRXBFeUssS0FBSSxTQUFVRCxHQUNiLE1BQU1FLEVBQVksSUFBSTdCLE9BQU8yQixFQUFZRyxNQUFNLEdBQUksR0FBSXpMLEVBQUt5SyxtQkFBbUJOLElBQy9FLE9BQU9pQixFQUFVVixNQUFNYyxNQUV4QkUsUUFBTyxTQUFVdkQsRUFBR0MsR0FDbkIsT0FBT0QsRUFBRXdELE9BQU92RCxLQUNmLElBQ0ZpRCxRQUFPLFNBQVVPLEdBQ2hCLE9BQWdCLE9BQVRBLE1BU2JsSixFQUFlb0IsVUFBVTJHLG1CQUFxQixTQUFVTixHQUN0RCxNQUFNMEIsRUFBWSxDQUFDLEtBS25CLE9BSksxQixHQUNIMEIsRUFBVTdCLEtBQUssS0FHVjZCLEVBQVV2QixLQUFLLEtBUXhCNUgsRUFBZW9CLFVBQVVnSSxhQUFlLFdBRXRDLEdBQXlCLElBQXJCQyxVQUFVakwsT0FDWixNQUFPLEdBRVQsR0FBeUIsSUFBckJpTCxVQUFVakwsT0FDWixPQUFPaUwsVUFBVSxHQUluQixNQUFNN0UsR0FBVzZFLFVBQVUsSUFBTSxJQUFJTixRQUNyQyxJQUFLLElBQUlPLEVBQUksRUFBR0EsRUFBSUQsVUFBVWpMLE9BQVFrTCxJQUFLLENBQ3pDLE1BQU1DLEVBQVNGLFVBQVVDLElBQU0sR0FDL0IsSUFBSyxJQUFJRSxFQUFJLEVBQUdBLEVBQUlELEVBQU9uTCxPQUFRb0wsSUFDNUJqTSxLQUFLZ0wsU0FBUy9ELEVBQVMrRSxFQUFPQyxHQUFHdEIsUUFDcEMxRCxFQUFROEMsS0FBS2lDLEVBQU9DLElBSTFCLE9BQU9oRixFQUFRZ0IsTUFBSyxTQUFVQyxFQUFHQyxHQUMvQixPQUFPRCxFQUFFeUMsTUFBUXhDLEVBQUV3QyxVQVl2QmxJLEVBQWVvQixVQUFVbUgsU0FBVyxTQUFVL0QsRUFBUzBELEdBQ3JELE9BQU8xRCxFQUFRaUYsTUFBSyxTQUFVL0MsR0FDNUIsT0FBTzlDLEtBQUs4RixJQUFJaEQsRUFBT3dCLE1BQVFBLElBQVV4QixFQUFPc0IsTUFBTTVKLFdBUzFENEIsRUFBZUssT0FBUyxXQUN0QixJQUFLLElBQUlpSixFQUFJLEVBQUdBLEVBQUlELFVBQVVqTCxPQUFRa0wsSUFDcEMsSUFBSyxJQUFJSyxLQUFPTixVQUFVQyxHQUNwQnBJLE9BQU9FLFVBQVV3SSxlQUFleEosS0FBS2lKLFVBQVVDLEdBQUlLLEtBQ3BCLGlCQUF0Qk4sVUFBVSxHQUFHTSxJQUNTLGlCQUF0Qk4sVUFBVUMsR0FBR0ssR0FDdEJwTSxLQUFLOEMsT0FBT2dKLFVBQVUsR0FBR00sR0FBTU4sVUFBVUMsR0FBR0ssSUFHNUNOLFVBQVUsR0FBR00sR0FBT04sVUFBVUMsR0FBR0ssSUFLekMsT0FBT04sVUFBVSxJQU9uQnJKLEVBQWVvQixVQUFVaUYsU0FBVyxXQUNsQyxJQUFJd0QsRUFPSixPQU5JdE0sS0FBS2lELE9BQU9JLFdBQ2RpSixFQUFNdE0sS0FBS2lELE9BQU9JLFNBQVNvQixPQUU3QjZILEVBQU1BLEdBQU83SixFQUFlOEosb0JBR3JCcE4sSUFBSXFOLFlBQVlGLElBU3pCN0osRUFBZWMsbUJBQXFCLFNBQVVrSixHQUM1QyxHQUE0QixpQkFBakJBLEVBQ1QsT0FBT0EsRUFPVCxNQUFNQyxFQUFXRCxFQUFhdEksTUFBTSxLQU9wQyxPQU5BdUksRUFBUyxHQUFLQSxFQUFTLEdBQUdDLGNBQ3RCRCxFQUFTN0wsT0FBUyxJQUNwQjZMLEVBQVMsR0FBS0EsRUFBUyxHQUFHRSxlQUViRixFQUFTckMsS0FBSyxNQVUvQjVILEVBQWVvQixVQUFVZ0osV0FBYSxTQUFVQyxHQUU5QyxPQURnQixJQUFJQyxXQUFZQyxnQkFBZ0JGLEVBQU8sYUFDeENHLGdCQUFnQkMsYUFPakN6SyxFQUFlb0IsVUFBVXNKLGdCQUFrQixXQUN6QyxHQUFLbk4sS0FBS1MsV0FNVixNQUFPLENBQ0xBLFdBQVlULEtBQUtTLFdBQVdNLFVBQzVCb0UsVUFBV25GLEtBQUttRixZQVFwQjFDLEVBQWVvQixVQUFVcUIsYUFBZSxTQUFVa0ksSUFDRyxJQUEvQzNLLEVBQWU0SyxZQUFZekQsUUFBUXdELEtBSXZDcE4sS0FBS21GLFVBQVlpSSxJQVduQjNLLEVBQWU4SCxlQUFpQiw0Q0FLaEM5SCxFQUFldUcsb0JBQXNCLGFBR3JDdkcsRUFBZThKLG9CQUFzQixpQkFHckM5SixFQUFla0gsNEJBQThCLDJDQUc3Q2xILEVBQWU0SyxZQUFjLENBQUMsT0FBUSxVQUFXLGFBRTFDNUssRUEzakNlLEdDVnhCdEQsSUFBTUEsS0FBTyxHQUNiQSxJQUFJc0QsZUFBaUJBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zNGxtc0Vzc2F5Ly4vc2NyaXB0cy9nbG9iYWxzLmpzIiwid2VicGFjazovL3M0bG1zRXNzYXkvLi9zY3JpcHRzL2lucHV0ZmllbGQuanMiLCJ3ZWJwYWNrOi8vczRsbXNFc3NheS8uL3NjcmlwdHMvZXNzYXkuanMiLCJ3ZWJwYWNrOi8vczRsbXNFc3NheS8uL3NjcmlwdHMvZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEV2ZW50RGlzcGF0Y2hlciA9IEg1UC5FdmVudERpc3BhdGNoZXI7XG5leHBvcnQgY29uc3QgalF1ZXJ5ID0gSDVQLmpRdWVyeTtcbmV4cG9ydCBjb25zdCBKb3ViZWxVSSA9IEg1UC5Kb3ViZWxVSTtcbmV4cG9ydCBjb25zdCBRdWVzdGlvbiA9IEg1UC5RdWVzdGlvbjtcbmV4cG9ydCBjb25zdCBzaHVmZmxlQXJyYXkgPSBINVAuc2h1ZmZsZUFycmF5OyIsIi8vIENTUyBDbGFzc2VzXG5jb25zdCBNQUlOX0NPTlRBSU5FUiA9ICdoNXAtZXNzYXktaW5wdXQtZmllbGQnO1xuY29uc3QgSU5QVVRfTEFCRUwgPSAnaDVwLWVzc2F5LWlucHV0LWZpZWxkLWxhYmVsJztcbmNvbnN0IElOUFVUX0ZJRUxEID0gJ2g1cC1lc3NheS1pbnB1dC1maWVsZC10ZXh0ZmllbGQnO1xuY29uc3QgV1JBUFBFUl9NRVNTQUdFID0gJ2g1cC1lc3NheS1pbnB1dC1maWVsZC1tZXNzYWdlLXdyYXBwZXInO1xuY29uc3QgQ0hBUl9NRVNTQUdFID0gJ2g1cC1lc3NheS1pbnB1dC1maWVsZC1tZXNzYWdlLWNoYXInO1xuY29uc3QgQ0hBUl9NRVNTQUdFX0lNUE9SVEFOVCA9ICdoNXAtZXNzYXktaW5wdXQtZmllbGQtbWVzc2FnZS1jaGFyLWltcG9ydGFudCc7XG5jb25zdCBTQVZFX01FU1NBR0UgPSAnaDVwLWVzc2F5LWlucHV0LWZpZWxkLW1lc3NhZ2Utc2F2ZSc7XG5jb25zdCBBTklNQVRJT05fTUVTU0FHRSA9ICdoNXAtZXNzYXktaW5wdXQtZmllbGQtbWVzc2FnZS1zYXZlLWFuaW1hdGlvbic7XG5jb25zdCBFTVBUWV9NRVNTQUdFID0gJyZuYnNwOyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVzc2F5aW5wdXRGaWVsZHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zIC0gUGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IFtwYXJhbXMuaW5wdXRGaWVsZFNpemVdIC0gTnVtYmVyIG9mIHJvd3MgZm9yIGlucHV0ZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbcGFyYW1zLm1heGltdW1MZW5ndGhdIC0gTWF4aW11bSB0ZXh0IGxlbmd0aC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtwYXJhbXMucGxhY2Vob2xkZXJUZXh0XSAtIFBsYWNlaG9sZGVyIHRleHQgZm9yIGlucHV0IGZpZWxkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gW3BhcmFtcy5yZW1haW5pbmdDaGFyc10gLSBMYWJlbCBmb3IgcmVtYWluaW5nIGNoYXJzIGluZm9ybWF0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gW3BhcmFtcy50YXNrRGVzY3JpcHRpb25dIC0gVGFzayBkZXNjcmlwdGlvbiAoSFRNTCkuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbcGFyYW1zLnByZXZpb3VzU3RhdGVdIC0gQ29udGVudCBzdGF0ZSBvZiBwcmV2aW91cyBhdHRlbXB0LlxuICAgKiBAcGFyYW0ge29iamVjdH0gW2NhbGxiYWNrc10gLSBDYWxsYmFja3MuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja3Mub25JbnRlcmFjdGVkXSAtIEludGVyYWN0ZWQgY2FsbGJhY2suXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNhbGxiYWNrcykge1xuICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgIHRoaXMucHJldmlvdXNTdGF0ZSA9IHBhcmFtcy5wcmV2aW91c1N0YXRlIHx8ICcnO1xuXG4gICAgLy8gQ2FsbGJhY2tzXG4gICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307XG4gICAgdGhpcy5jYWxsYmFja3Mub25JbnRlcmFjdGVkID0gdGhpcy5jYWxsYmFja3Mub25JbnRlcmFjdGVkIHx8IChmdW5jdGlvbiAoKSB7fSk7XG5cbiAgICAvLyBTYW5pdGl6YXRpb25cbiAgICB0aGlzLnBhcmFtcy50YXNrRGVzY3JpcHRpb24gPSB0aGlzLnBhcmFtcy50YXNrRGVzY3JpcHRpb24gfHwgJyc7XG4gICAgLy90aGlzLnBhcmFtcy5wbGFjZWhvbGRlclRleHQgPSB0aGlzLnBhcmFtcy5wbGFjZWhvbGRlclRleHQgfHwgJyc7XG5cbiAgICAvLyBUYXNrIGRlc2NyaXB0aW9uXG4gICAgdGhpcy50YXNrRGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLnRhc2tEZXNjcmlwdGlvbi5jbGFzc0xpc3QuYWRkKElOUFVUX0xBQkVMKTtcbiAgICB0aGlzLnRhc2tEZXNjcmlwdGlvbi5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy50YXNrRGVzY3JpcHRpb247XG5cbiAgICAvLyBJbnB1dEZpZWxkXG4gICAgdGhpcy5pbnB1dEZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgICB0aGlzLmlucHV0RmllbGQuY2xhc3NMaXN0LmFkZChJTlBVVF9GSUVMRCk7XG4gICAgLy90aGlzLmlucHV0RmllbGQuc2V0QXR0cmlidXRlKCdyb3dzJywgdGhpcy5wYXJhbXMuaW5wdXRGaWVsZFNpemUpO1xuICAgIC8vdGhpcy5pbnB1dEZpZWxkLnNldEF0dHJpYnV0ZSgnbWF4bGVuZ3RoJywgdGhpcy5wYXJhbXMubWF4aW11bUxlbmd0aCk7XG4gICAvLyB0aGlzLmlucHV0RmllbGQuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIHRoaXMucGFyYW1zLnBsYWNlaG9sZGVyVGV4dCk7XG4gICAgdGhpcy5zZXRUZXh0KHRoaXMucHJldmlvdXNTdGF0ZSk7XG4gICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMucHJldmlvdXNTdGF0ZTtcblxuICAgIHRoaXMuY29udGFpbnNUZXh0ID0gdGhpcy5vbGRWYWx1ZS5sZW5ndGggPiAwO1xuXG4gICAgLy8gSW50ZXJhY3RlZCBsaXN0ZW5lclxuICAgIHRoaXMuaW5wdXRGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoYXQub2xkVmFsdWUgIT09IHRoYXQuZ2V0VGV4dCgpKSB7XG4gICAgICAgIHRoYXQuY2FsbGJhY2tzLm9uSW50ZXJhY3RlZCh7IHVwZGF0ZVNjb3JlOiB0cnVlIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGF0Lm9sZFZhbHVlID0gdGhhdC5nZXRUZXh0KCk7XG4gICAgfSk7XG5cbiAgICAvKlxuICAgICAqIEV4dHJhIGxpc3RlbmVyIHJlcXVpcmVkIHRvIGJlIHVzZWQgaW4gUXVlc3Rpb25TZXQgcHJvcGVybHlcbiAgICAgKi9cbiAgICB0aGlzLmlucHV0RmllbGQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoYXQuY29udGFpbnNUZXh0ICYmIHRoYXQuZ2V0VGV4dCgpLmxlbmd0aCA9PT0gMCB8fFxuICAgICAgICAhdGhhdC5jb250YWluc1RleHQgJiYgdGhhdC5nZXRUZXh0KCkubGVuZ3RoID4gMFxuICAgICAgKSB7XG4gICAgICAgIHRoYXQuY2FsbGJhY2tzLm9uSW50ZXJhY3RlZCgpO1xuICAgICAgfVxuXG4gICAgICB0aGF0LmNvbnRhaW5zVGV4dCA9IHRoYXQuZ2V0VGV4dCgpLmxlbmd0aCA+IDA7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmNvbnRlbnQuYXBwZW5kQ2hpbGQodGhpcy5pbnB1dEZpZWxkKTtcblxuICAgIC8vIENvbnRhaW5lclxuICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZChNQUlOX0NPTlRBSU5FUik7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy50YXNrRGVzY3JpcHRpb24pO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY29udGVudCk7XG5cbiAgICAvKmlmIChwYXJhbXMuc3RhdHVzQmFyKSB7XG4gICAgICB2YXIgc3RhdHVzV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgc3RhdHVzV3JhcHBlci5jbGFzc0xpc3QuYWRkKFdSQVBQRVJfTUVTU0FHRSk7XG5cbiAgICAgIHRoaXMuc3RhdHVzQ2hhcnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRoaXMuc3RhdHVzQ2hhcnMuY2xhc3NMaXN0LmFkZChDSEFSX01FU1NBR0UpO1xuXG4gICAgICBzdGF0dXNXcmFwcGVyLmFwcGVuZENoaWxkKHRoaXMuc3RhdHVzQ2hhcnMpO1xuXG4gICAgICBbJ2NoYW5nZScsICdrZXl1cCcsICdwYXN0ZSddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoYXQuaW5wdXRGaWVsZC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdGhhdC51cGRhdGVNZXNzYWdlU2F2ZWQoJycpO1xuICAgICAgICAgIHRoYXQudXBkYXRlTWVzc2FnZUNoYXJzKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3RhdHVzU2F2ZWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRoaXMuc3RhdHVzU2F2ZWQuY2xhc3NMaXN0LmFkZChTQVZFX01FU1NBR0UpO1xuICAgICAgc3RhdHVzV3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLnN0YXR1c1NhdmVkKTtcblxuICAgICAgdGhpcy5jb250ZW50LmFwcGVuZENoaWxkKHN0YXR1c1dyYXBwZXIpO1xuXG4gICAgICB0aGlzLnVwZGF0ZU1lc3NhZ2VDaGFycygpO1xuICAgIH0qL1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgaW50cm9kdWN0aW9uIGZvciBINVAuUXVlc3Rpb24uXG4gICAqIEByZXR1cm4ge09iamVjdH0gRE9NIGVsZW1lbnRzIGZvciBpbnRyb2R1Y3Rpb24uXG4gICAqL1xuICBnZXRJbnRyb2R1Y3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy50YXNrRGVzY3JpcHRpb247XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBjb250ZW50IGZvciBINVAuUXVlc3Rpb24uXG4gICAqIEByZXR1cm4ge09iamVjdH0gRE9NIGVsZW1lbnRzIGZvciBjb250ZW50LlxuICAgKi9cbiAgZ2V0Q29udGVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCB0ZXh0IGluIElucHV0RmllbGQuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ3VycmVudCB0ZXh0LlxuICAgKi9cbiAgZ2V0VGV4dCgpIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dEZpZWxkLnZhbHVlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlIHRoZSBpbnB1dEZpZWxkLlxuICAgKi9cbiAgZGlzYWJsZSgpIHtcbiAgICB0aGlzLmlucHV0RmllbGQuZGlzYWJsZWQgPSB0cnVlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBFbmFibGUgdGhlIGlucHV0RmllbGQuXG4gICAqL1xuICBlbmFibGUoKSB7XG4gICAgdGhpcy5pbnB1dEZpZWxkLmRpc2FibGVkID0gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIEVuYWJsZSB0aGUgaW5wdXRGaWVsZC5cbiAgICovXG4gIGZvY3VzKCkge1xuICAgIHRoaXMuaW5wdXRGaWVsZC5mb2N1cygpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHRleHQgZm9yIHRoZSBJbnB1dEZpZWxkLlxuICAgKiBAcGFyYW0ge3N0cmluZ3xPYmplY3R9IHByZXZpb3VzU3RhdGUgLSBQcmV2aW91cyBzdGF0ZSB0aGF0IHdhcyBzYXZlZC5cbiAgICovXG4gIHNldFRleHQocHJldmlvdXNTdGF0ZSkge1xuICAgIGlmICh0eXBlb2YgcHJldmlvdXNTdGF0ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwcmV2aW91c1N0YXRlID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5pbnB1dEZpZWxkLmlubmVySFRNTCA9IHByZXZpb3VzU3RhdGU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcHJldmlvdXNTdGF0ZSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkocHJldmlvdXNTdGF0ZSkpIHtcbiAgICAgIHRoaXMuaW5wdXRGaWVsZC5pbm5lckhUTUwgPSBwcmV2aW91c1N0YXRlLmlucHV0RmllbGQgfHwgJyc7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBDb21wdXRlIHRoZSByZW1haW5pbmcgbnVtYmVyIG9mIGNoYXJhY3RlcnMuXG4gICAqIEByZXR1cm4ge251bWJlcn0gTnVtYmVyIG9mIGNoYXJhY3RlcnMgbGVmdC5cbiAgICovXG4gIC8qZnVuY3Rpb24gY29tcHV0ZVJlbWFpbmluZ0NoYXJzKCkge1xuICAgIHJldHVybiB0aGlzLnBhcmFtcy5tYXhpbXVtTGVuZ3RoIC0gdGhpcy5pbnB1dEZpZWxkLnZhbHVlLmxlbmd0aDtcbiAgfTsqL1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgY2hhcmFjdGVyIG1lc3NhZ2UgZmllbGQuXG4gICAqL1xuICB1cGRhdGVNZXNzYWdlQ2hhcnMoKSB7XG4gICAgLyppZiAoIXRoaXMucGFyYW1zLnN0YXR1c0Jhcikge1xuICAgICAgcmV0dXJuO1xuICAgIH0qL1xuXG4gICAgLyppZiAodHlwZW9mIHRoaXMucGFyYW1zLm1heGltdW1MZW5ndGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLnNldE1lc3NhZ2VDaGFycyh0aGlzLnBhcmFtcy5yZW1haW5pbmdDaGFycy5yZXBsYWNlKC9AY2hhcnMvZywgdGhpcy5jb21wdXRlUmVtYWluaW5nQ2hhcnMoKSksIGZhbHNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBVc2UgRU1QVFlfTUVTU0FHRSB0byBrZWVwIGhlaWdodFxuICAgICAgdGhpcy5zZXRNZXNzYWdlQ2hhcnMoRU1QVFlfTUVTU0FHRSwgZmFsc2UpO1xuICAgIH0qL1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGluZGljYXRvciBtZXNzYWdlIGZvciBzYXZlZCB0ZXh0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2F2ZWQgLSBNZXNzYWdlIHRvIGluZGljYXRlIHRoZSB0ZXh0IHdhcyBzYXZlZC5cbiAgICovXG4gIHVwZGF0ZU1lc3NhZ2VTYXZlZChzYXZlZCkge1xuICAgLyogaWYgKCF0aGlzLnBhcmFtcy5zdGF0dXNCYXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9Ki9cblxuICAgIC8vIEFkZC9yZW1vdmUgYmxlbmRpbmcgZWZmZWN0XG4gICAgaWYgKHR5cGVvZiBzYXZlZCA9PT0gJ3VuZGVmaW5lZCcgfHwgc2F2ZWQgPT09ICcnKSB7XG4gICAgICB0aGlzLnN0YXR1c1NhdmVkLmNsYXNzTGlzdC5yZW1vdmUoQU5JTUFUSU9OX01FU1NBR0UpO1xuICAgICAgLy90aGlzLnN0YXR1c1NhdmVkLnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnN0YXR1c1NhdmVkLmNsYXNzTGlzdC5hZGQoQU5JTUFUSU9OX01FU1NBR0UpO1xuICAgICAgLy90aGlzLnN0YXR1c1NhdmVkLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcbiAgICB9XG4gICAgdGhpcy5zdGF0dXNTYXZlZC5pbm5lckhUTUwgPSBzYXZlZDtcbiAgfTtcblxuICAvKipcbiAgICogU2V0IHRoZSB0ZXh0IGZvciB0aGUgY2hhcmFjdGVyIG1lc3NhZ2UuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gTWVzc2FnZSB0ZXh0LlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGltcG9ydGFudCAtIElmIHRydWUsIG1lc3NhZ2Ugd2lsbCBhZGRlZCBhIHBhcnRpY3VsYXIgQ1NTIGNsYXNzLlxuICAgKi9cbiAgc2V0TWVzc2FnZUNoYXJzKG1lc3NhZ2UsIGltcG9ydGFudCkge1xuICAgIC8qaWYgKCF0aGlzLnBhcmFtcy5zdGF0dXNCYXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9Ki9cblxuICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZSA9PT0gRU1QVFlfTUVTU0FHRSB8fCBpbXBvcnRhbnQpIHtcbiAgICAgIC8qXG4gICAgICAgKiBJbXBvcnRhbnQgbWVzc2FnZXMgc2hvdWxkIGJlIHJlYWQgZm9yIGEgcmVhZHNwZWFrZXIgYnkgY2FsbGVyIGFuZCBuZWVkXG4gICAgICAgKiBub3QgYmUgYWNjZXNzaWJsZSB3aGVuIHRhYmJpbmcgYmFjayBhZ2Fpbi5cbiAgICAgICAqL1xuICAgICAgdGhpcy5zdGF0dXNDaGFycy5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5zdGF0dXNDaGFycy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0dXNDaGFycy5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIGlmIChpbXBvcnRhbnQpIHtcbiAgICAgIHRoaXMuc3RhdHVzQ2hhcnMuY2xhc3NMaXN0LmFkZChDSEFSX01FU1NBR0VfSU1QT1JUQU5UKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnN0YXR1c0NoYXJzLmNsYXNzTGlzdC5yZW1vdmUoQ0hBUl9NRVNTQUdFX0lNUE9SVEFOVCk7XG4gICAgfVxuICB9O1xuXG59IiwiaW1wb3J0IHtcbiAgalF1ZXJ5IGFzICQsIEpvdWJlbFVJIGFzIFVJLCBRdWVzdGlvblxufSBcbmZyb20gXCIuL2dsb2JhbHNcIjtcblxuaW1wb3J0IEVzc2F5SW5wdXRGaWVsZCBmcm9tIFwiLi9pbnB1dGZpZWxkXCI7XG5cbmltcG9ydCBjYW52ZyBmcm9tIFwiY2FudmdcIlxuXG4vKipcbiAqIFRPRE86IFRoaXMgY29udGVudCB0eXBlIG5lZWRzIHJlZmFjdG9yaW5nLlxuICovXG5jb25zdCBFc3NheVNjb3JlNExNUyA9IChmdW5jdGlvbiAoKSB7XG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAZXh0ZW5kcyBRdWVzdGlvblxuICAgKi9cblxuICAvLyBDU1MgQ2xhc3Nlc1xuICBjb25zdCBTT0xVVElPTl9DT05UQUlORVIgPSAnaDVwLWVzc2F5LXNvbHV0aW9uLWNvbnRhaW5lcic7XG4gIGNvbnN0IFNPTFVUSU9OX1RJVExFID0gJ2g1cC1lc3NheS1zb2x1dGlvbi10aXRsZSc7XG4gIC8vY29uc3QgU09MVVRJT05fSU5UUk9EVUNUSU9OID0gJ2g1cC1lc3NheS1zb2x1dGlvbi1pbnRyb2R1Y3Rpb24nO1xuIC8vIGNvbnN0IFNPTFVUSU9OX1NBTVBMRSA9ICdoNXAtZXNzYXktc29sdXRpb24tc2FtcGxlJztcbiAgLy9jb25zdCBTT0xVVElPTl9TQU1QTEVfVEVYVCA9ICdoNXAtZXNzYXktc29sdXRpb24tc2FtcGxlLXRleHQnO1xuXG4gIC8vIFRoZSBINVAgZmVlZGJhY2sgcmlnaHQgbm93IG9ubHkgZXhwZWN0cyB0cnVlIChncmVlbikvZmFsc2UgKHJlZCkgZmVlZGJhY2ssIG5vdCBuZXV0cmFsIGZlZWRiYWNrXG4gIGNvbnN0IEZFRURCQUNLX0VNUFRZID0gJzxzcGFuIGNsYXNzPVwiaDVwLWVzc2F5LWZlZWRiYWNrLWVtcHR5XCI+Li4uPC9zcGFuPic7XG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gQ29uZmlnIGZyb20gc2VtYW50aWNzLmpzb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50SWQgLSBDb250ZW50SWQuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbY29udGVudERhdGFdIC0gY29udGVudERhdGEuXG4gICAqL1xuICBmdW5jdGlvbiBFc3NheVNjb3JlNExNUyhjb25maWcsIGNvbnRlbnRJZCwgY29udGVudERhdGEpIHtcbiAgICAvLyBJbml0aWFsaXplXG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbmhlcml0YW5jZVxuICAgIFF1ZXN0aW9uLmNhbGwodGhpcywgJ2Vzc2F5Jyk7XG5cbiAgICAvLyBTYW5pdGl6ZSBkZWZhdWx0c1xuICAgIHRoaXMucGFyYW1zID0gRXNzYXlTY29yZTRMTVMuZXh0ZW5kKFxuICAgICAge1xuICAgICAgICBtZWRpYToge30sXG4gICAgICAgIHRhc2tEZXNjcmlwdGlvbjogJycsXG4gICAgICAgIC8vc29sdXRpb246IHt9LFxuICAgICAgICAvL2tleXdvcmRzOiBbXSxcbiAgICAgICAgLy9vdmVyYWxsRmVlZGJhY2s6IFtdLFxuICAgICAgICAvKmJlaGF2aW91cjoge1xuICAgICAgICAgIG1pbmltdW1MZW5ndGg6IDAsXG4gICAgICAgICAgaW5wdXRGaWVsZFNpemU6IDEwLFxuICAgICAgICAgIGVuYWJsZUNoZWNrQnV0dG9uOiB0cnVlLFxuICAgICAgICAgIGVuYWJsZVJldHJ5OiB0cnVlLFxuICAgICAgICAgIGlnbm9yZVNjb3Jpbmc6IGZhbHNlLFxuICAgICAgICAgIHBvaW50c0hvc3Q6IDFcbiAgICAgICAgfSwqL1xuICAgICAgICBjaGVja0Fuc3dlcjogJ0NoZWNrJ1xuICAgICAgICAvL3N1Ym1pdEFuc3dlcjogJ1N1Ym1pdCdcbiAgICAgICAgLy90cnlBZ2FpbjogJ1JldHJ5J1xuICAgICAgICAvL3Nob3dTb2x1dGlvbjogJ1Nob3cgc29sdXRpb24nXG4gICAgICAgIC8vZmVlZGJhY2tIZWFkZXI6ICdGZWVkYmFjaydcbiAgICAgICAgLy9zb2x1dGlvblRpdGxlOiAnU2FtcGxlIHNvbHV0aW9uJ1xuICAgICAgICAvL3JlbWFpbmluZ0NoYXJzOiAnUmVtYWluaW5nIGNoYXJhY3RlcnM6IEBjaGFycydcbiAgICAgICAgLy9ub3RFbm91Z2hDaGFyczogJ1lvdSBtdXN0IGVudGVyIGF0IGxlYXN0IEBjaGFycyBjaGFyYWN0ZXJzISdcbiAgICAgICAgLy9tZXNzYWdlU2F2ZTogJ3NhdmVkJ1xuICAgICAgICAvL2FyaWFZb3VyUmVzdWx0OiAnWW91IGdvdCBAc2NvcmUgb3V0IG9mIEB0b3RhbCBwb2ludHMnXG4gICAgICAgIC8vYXJpYU5hdmlnYXRlZFRvU29sdXRpb246ICdOYXZpZ2F0ZWQgdG8gbmV3bHkgaW5jbHVkZWQgc2FtcGxlIHNvbHV0aW9uIGFmdGVyIHRleHRhcmVhLidcbiAgICAgICAgLy9hcmlhQ2hlY2s6ICdDaGVjayB0aGUgYW5zd2Vycy4nXG4gICAgICAgIC8vYXJpYVNob3dTb2x1dGlvbjogJ1Nob3cgdGhlIHNvbHV0aW9uLiBZb3Ugd2lsbCBiZSBwcm92aWRlZCB3aXRoIGEgc2FtcGxlIHNvbHV0aW9uLidcbiAgICAgICAvLyBhcmlhUmV0cnk6ICdSZXRyeSB0aGUgdGFzay4gWW91IGNhbiBpbXByb3ZlIHlvdXIgcHJldmlvdXMgYW5zd2VyIGlmIHRoZSBhdXRob3IgYWxsb3dlZCB0aGF0LidcbiAgICAgIH0sXG4gICAgICBjb25maWcpO1xuICAgIHRoaXMuY29udGVudElkID0gY29udGVudElkO1xuICAgIHRoaXMuZXh0cmFzID0gY29udGVudERhdGE7XG4gICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqaGllcjEnKTtcbiAgICBjb25zdCBkZWZhdWx0TGFuZ3VhZ2UgPSAodGhpcy5leHRyYXMgJiYgdGhpcy5leHRyYXMubWV0YWRhdGEpID8gdGhpcy5leHRyYXMubWV0YWRhdGEuZGVmYXVsdExhbmd1YWdlIHx8ICdlbicgOiAnZW4nO1xuICAgIHRoaXMubGFuZ3VhZ2VUYWcgPSBFc3NheVNjb3JlNExNUy5mb3JtYXRMYW5ndWFnZUNvZGUoZGVmYXVsdExhbmd1YWdlKTtcblxuICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgIHRoaXMuaW50ZXJuYWxTaG93U29sdXRpb25zQ2FsbCA9IGZhbHNlO1xuXG4gICAgLy8gU2FuaXRpemUgSFRNTCBlbmNvZGluZ1xuICAgIC8vdGhpcy5wYXJhbXMucGxhY2Vob2xkZXJUZXh0ID0gdGhpcy5odG1sRGVjb2RlKHRoaXMucGFyYW1zLnBsYWNlaG9sZGVyVGV4dCB8fCAnJyk7XG5cbiAgICAvLyBHZXQgcHJldmlvdXMgc3RhdGUgZnJvbSBjb250ZW50IGRhdGFcbiAgICBpZiAodHlwZW9mIGNvbnRlbnREYXRhICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29udGVudERhdGEucHJldmlvdXNTdGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMucHJldmlvdXNTdGF0ZSA9IGNvbnRlbnREYXRhLnByZXZpb3VzU3RhdGU7XG4gICAgfVxuXG4gICAgdGhpcy5pc0Fuc3dlcmVkID0gdGhpcy5wcmV2aW91c1N0YXRlICYmIHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkICYmIHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkICE9PSAnJyB8fCBmYWxzZTtcbiAgICAvKlxuICAgICAqIHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVTb2x1dGlvbnNCdXR0b24gYW5kIHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSBhcmUgdXNlZCBieVxuICAgICAqIGNvbnRyYWN0IGF0IHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTh9IGFuZFxuICAgICAqIHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTl9XG4gICAgICovXG4gICAgLy90aGlzLnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlU29sdXRpb25zQnV0dG9uID0gKHR5cGVvZiB0aGlzLnBhcmFtcy5zb2x1dGlvbi5zYW1wbGUgIT09ICd1bmRlZmluZWQnICYmIHRoaXMucGFyYW1zLnNvbHV0aW9uLnNhbXBsZSAhPT0gJycpO1xuICAgIC8vdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5ID0gdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5IHx8IGZhbHNlO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRoYXQgc2hvdWxkIGJlIGVudGVyZWRcbiAgIC8qIHRoaXMucGFyYW1zLmJlaGF2aW91ci5taW5pbXVtTGVuZ3RoID0gdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggfHwgMDtcbiAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heGltdW1MZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggPSBNYXRoLm1pbih0aGlzLnBhcmFtcy5iZWhhdmlvdXIubWluaW11bUxlbmd0aCwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heGltdW1MZW5ndGgpO1xuICAgIH0qL1xuXG4gICAgLy8gbWFwIGZ1bmN0aW9uXG4gICAgY29uc3QgdG9Qb2ludHMgPSBmdW5jdGlvbiAoa2V5d29yZCkge1xuICAgICAgcmV0dXJuIChrZXl3b3JkLmtleXdvcmQgJiYga2V5d29yZC5vcHRpb25zICYmIGtleXdvcmQub3B0aW9ucy5wb2ludHMgfHwgMCkgKiAoa2V5d29yZC5vcHRpb25zLm9jY3VycmVuY2VzIHx8IDEpO1xuICAgIH07XG5cbiAgICAvLyByZWR1Y2UgZnVuY3Rpb25cbiAgICBjb25zdCBzdW0gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgKyBiO1xuICAgIH07XG5cbiAgICAvLyBzY29yZU1heCA9IE1heGltdW0gbnVtYmVyIG9mIHBvaW50cyBhdmFpbGFibGUgYnkgYWxsIGtleXdvcmQgZ3JvdXBzXG4gICAgLypjb25zdCBzY29yZU1heCA9IHRoaXMucGFyYW1zLmtleXdvcmRzXG4gICAgICAubWFwKHRvUG9pbnRzKVxuICAgICAgLnJlZHVjZShzdW0sIDApOyovXG5cbiAgICAvLyBzY29yZU1hc3RlcmluZzogc2NvcmUgaW5kaWNhdGluZyBtYXN0ZXJ5IGFuZCBtYXhpbXVtIG51bWJlciBvbiBwcm9ncmVzcyBiYXIgKGNhbiBiZSA8IHNjb3JlTWF4KVxuICAgIC8qdGhpcy5zY29yZU1hc3RlcmluZyA9IHRoaXMucGFyYW1zLmJlaGF2aW91ci5wZXJjZW50YWdlTWFzdGVyaW5nID09PSB1bmRlZmluZWQgP1xuICAgICAgc2NvcmVNYXggOlxuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnBlcmNlbnRhZ2VNYXN0ZXJpbmcgKiBzY29yZU1heCAvIDEwMDsqL1xuXG4gICAgLy8gc2NvcmVQYXNzaW5nOiBzY29yZSB0byBwYXNzIHRoZSB0YXNrICg8PSBzY29yZU1hc3RlcmluZylcbiAgICAvKnRoaXMuc2NvcmVQYXNzaW5nID0gTWF0aC5taW4oXG4gICAgICB0aGlzLmdldE1heFNjb3JlKCksXG4gICAgICB0aGlzLnBhcmFtcy5iZWhhdmlvdXIucGVyY2VudGFnZVBhc3NpbmcgKiBzY29yZU1heCAvIDEwMCB8fCAwKTsqL1xuXG4gICAgLy90aGlzLnNvbHV0aW9uID0gdGhpcy5idWlsZFNvbHV0aW9uKCk7XG5cbiAgICAvLyBSZS1jcmVhdGUgc2NvcmVcbiAgICBpZiAodHlwZW9mIHRoaXMucHJldmlvdXNTdGF0ZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXModGhpcy5wcmV2aW91c1N0YXRlKS5sZW5ndGgpIHtcbiAgICAgIHRoaXMudXBkYXRlU2NvcmUoKTtcbiAgICB9XG4gIH1cblxuICAvLyBFeHRlbmRzIFF1ZXN0aW9uXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUXVlc3Rpb24ucHJvdG90eXBlKTtcbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRXNzYXlTY29yZTRMTVM7XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIHRoZSBET00gZWxlbWVudHMgd2l0aCBINVAuUXVlc3Rpb24uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUucmVnaXN0ZXJEb21FbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIC8vIFNldCBvcHRpb25hbCBtZWRpYVxuICAgIGNvbnN0IG1lZGlhID0gKHRoaXMucGFyYW1zLm1lZGlhKSA/IHRoaXMucGFyYW1zLm1lZGlhLnR5cGUgOiB1bmRlZmluZWQ7XG4gICAgaWYgKG1lZGlhICYmIG1lZGlhLmxpYnJhcnkpIHtcbiAgICAgIGNvbnN0IHR5cGUgPSBtZWRpYS5saWJyYXJ5LnNwbGl0KCcgJylbMF07XG4gICAgICBpZiAodHlwZSA9PT0gJ0g1UC5JbWFnZScpIHtcbiAgICAgICAgaWYgKG1lZGlhLnBhcmFtcy5maWxlKSB7XG4gICAgICAgICAgdGhpcy5zZXRJbWFnZShtZWRpYS5wYXJhbXMuZmlsZS5wYXRoLCB7XG4gICAgICAgICAgICBkaXNhYmxlSW1hZ2Vab29taW5nOiB0aGlzLnBhcmFtcy5tZWRpYS5kaXNhYmxlSW1hZ2Vab29taW5nLFxuICAgICAgICAgICAgYWx0OiBtZWRpYS5wYXJhbXMuYWx0LFxuICAgICAgICAgICAgdGl0bGU6IG1lZGlhLnBhcmFtcy50aXRsZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0eXBlID09PSAnSDVQLlZpZGVvJykge1xuICAgICAgICBpZiAobWVkaWEucGFyYW1zLnNvdXJjZXMpIHtcbiAgICAgICAgICB0aGlzLnNldFZpZGVvKG1lZGlhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ0g1UC5BdWRpbycpIHtcbiAgICAgICAgaWYgKG1lZGlhLnBhcmFtcy5maWxlcykge1xuICAgICAgICAgIHRoaXMuc2V0QXVkaW8obWVkaWEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgd2hldGhlciBzdGF0dXMgYmFyIGlzIG5lZWRlZFxuICAgIC8qY29uc3Qgc3RhdHVzQmFyID0gKFxuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggfHxcbiAgICAgIHRoaXMucGFyYW1zLmJlaGF2aW91ci5tYXhpbXVtTGVuZ3RoIHx8XG4gICAgICAoSDVQSW50ZWdyYXRpb24gJiYgSDVQSW50ZWdyYXRpb24uc2F2ZUZyZXEpXG4gICAgKTsqL1xuXG4gICAgLy8gQ3JlYXRlIElucHV0RmllbGRcbiAgICB0aGlzLmlucHV0RmllbGQgPSBuZXcgRXNzYXlJbnB1dEZpZWxkKHtcbiAgICAgIHRhc2tEZXNjcmlwdGlvbjogdGhpcy5wYXJhbXMudGFza0Rlc2NyaXB0aW9uLFxuICAgICAgLy9wbGFjZWhvbGRlclRleHQ6IHRoaXMucGFyYW1zLnBsYWNlaG9sZGVyVGV4dCxcbiAgICAgIC8vbWF4aW11bUxlbmd0aDogdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heGltdW1MZW5ndGgsXG4gICAgICAvL3JlbWFpbmluZ0NoYXJzOiB0aGlzLnBhcmFtcy5yZW1haW5pbmdDaGFycyxcbiAgICAgLy8gaW5wdXRGaWVsZFNpemU6IHRoaXMucGFyYW1zLmJlaGF2aW91ci5pbnB1dEZpZWxkU2l6ZSxcbiAgICAgIHByZXZpb3VzU3RhdGU6IHRoaXMucHJldmlvdXNTdGF0ZVxuICAgICAgLy9zdGF0dXNCYXI6IHN0YXR1c0JhclxuICAgIH0sIHtcbiAgICAgIG9uSW50ZXJhY3RlZDogKGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhhdC5oYW5kbGVJbnRlcmFjdGVkKHBhcmFtcyk7XG4gICAgICB9KSxcbiAgICAgIG9uSW5wdXQ6IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoYXQuaGFuZGxlSW5wdXQoKTtcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICB0aGlzLnNldFZpZXdTdGF0ZSh0aGlzLnByZXZpb3VzU3RhdGUgJiYgdGhpcy5wcmV2aW91c1N0YXRlLnZpZXdTdGF0ZSB8fCAndGFzaycpO1xuICAgIGlmICh0aGlzLnZpZXdTdGF0ZSA9PT0gJ3Jlc3VsdHMnKSB7XG4gICAgICAvLyBOZWVkIHRvIHdhaXQgdW50aWwgRE9NIGlzIHJlYWR5IGZvciB1c1xuICAgICAgSDVQLmV4dGVybmFsRGlzcGF0Y2hlci5vbignaW5pdGlhbGl6ZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoYXQuaGFuZGxlQ2hlY2tBbnN3ZXIoeyBza2lwWEFQSTogdHJ1ZSB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLnZpZXdTdGF0ZSA9PT0gJ3NvbHV0aW9ucycpIHtcbiAgICAgIC8vIE5lZWQgdG8gd2FpdCB1bnRpbCBET00gaXMgcmVhZHkgZm9yIHVzXG4gICAgICBINVAuZXh0ZXJuYWxEaXNwYXRjaGVyLm9uKCdpbml0aWFsaXplZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhhdC5oYW5kbGVDaGVja0Fuc3dlcih7IHNraXBYQVBJOiB0cnVlIH0pO1xuICAgICAgICB0aGF0LnNob3dTb2x1dGlvbnMoKTtcbiAgICAgICAgLy8gV2UgbmVlZCB0aGUgcmV0cnkgYnV0dG9uIGlmIHRoZSBtYXN0ZXJpbmcgc2NvcmUgaGFzIG5vdCBiZWVuIHJlYWNoZWQgb3Igc2NvcmluZyBpcyBpcnJlbGV2YW50XG4gICAgICAgLyogaWYgKHRoYXQuZ2V0U2NvcmUoKSA8IHRoYXQuZ2V0TWF4U2NvcmUoKSB8fCB0aGF0LnBhcmFtcy5iZWhhdmlvdXIuaWdub3JlU2NvcmluZyB8fCB0aGF0LmdldE1heFNjb3JlKCkgPT09IDApIHtcbiAgICAgICAgICBpZiAodGhhdC5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5KSB7XG4gICAgICAgICAgICB0aGF0LnNob3dCdXR0b24oJ3RyeS1hZ2FpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGF0LmhpZGVCdXR0b24oJ3RyeS1hZ2FpbicpO1xuICAgICAgICB9Ki9cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlZ2lzdGVyIHRhc2sgaW50cm9kdWN0aW9uIHRleHRcbiAgICAvL3RoaXMuc2V0SW50cm9kdWN0aW9uKHRoaXMuaW5wdXRGaWVsZC5nZXRJbnRyb2R1Y3Rpb24oKSk7XG5cbiAgICAvLyBSZWdpc3RlciBjb250ZW50XG4gICAgdGhpcy5jb250ZW50ID0gdGhpcy5pbnB1dEZpZWxkLmdldENvbnRlbnQoKTtcbiAgICB0aGlzLnNldENvbnRlbnQodGhpcy5jb250ZW50KTtcblxuICAgIC8vIFJlZ2lzdGVyIEJ1dHRvbnNcbiAgICB0aGlzLmFkZEJ1dHRvbnMoKTtcbiAgfTtcblxuICAvKipcbiAgICogQWRkIGFsbCB0aGUgYnV0dG9ucyB0aGF0IHNoYWxsIGJlIHBhc3NlZCB0byBINVAuUXVlc3Rpb24uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuYWRkQnV0dG9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIC8vIFNob3cgc29sdXRpb24gYnV0dG9uXG4gICAgLyp0aGF0LmFkZEJ1dHRvbignc2hvdy1zb2x1dGlvbicsIHRoYXQucGFyYW1zLnNob3dTb2x1dGlvbiwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gTm90IHVzaW5nIGEgcGFyYW1ldGVyIGZvciBzaG93U29sdXRpb25zIHRvIG5vdCBtZXNzIHdpdGggcG9zc2liZSBmdXR1cmUgY29udHJhY3QgY2hhbmdlc1xuICAgICAgdGhhdC5pbnRlcm5hbFNob3dTb2x1dGlvbnNDYWxsID0gdHJ1ZTtcbiAgICAgIHRoYXQuc2hvd1NvbHV0aW9ucygpO1xuICAgICAgdGhhdC5pbnRlcm5hbFNob3dTb2x1dGlvbnNDYWxsID0gZmFsc2U7XG4gICAgfSwgZmFsc2UsIHtcbiAgICAgICdhcmlhLWxhYmVsJzogdGhpcy5wYXJhbXMuYXJpYVNob3dTb2x1dGlvblxuICAgIH0sIHt9KTsqL1xuXG4gICAgLy8gQ2hlY2sgYW5zd2VyIGJ1dHRvblxuICAgIHRoYXQuYWRkQnV0dG9uKCdjaGVjay1hbnN3ZXInLCB0aGF0LnBhcmFtcy5jaGVja0Fuc3dlciwgZnVuY3Rpb24gKCkge1xuICAgICAgdGhhdC5oYW5kbGVDaGVja0Fuc3dlcigpO1xuICAgIH0gXG4gICAvKiB0aGlzLnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlQ2hlY2tCdXR0b24sIHtcbiAgICAgICdhcmlhLWxhYmVsJzogdGhpcy5wYXJhbXMuYXJpYUNoZWNrXG4gICAgfSwgKi9cbiAgIC8qIHtcbiAgICAgIGNvbnRlbnREYXRhOiB0aGlzLmV4dHJhcyxcbiAgICAgIHRleHRJZlN1Ym1pdHRpbmc6IHRoaXMucGFyYW1zLnN1Ym1pdEFuc3dlcixcbiAgICB9Ki9cbiAgICApO1xuXG4gICAgLy8gUmV0cnkgYnV0dG9uXG4gICAgLyp0aGF0LmFkZEJ1dHRvbigndHJ5LWFnYWluJywgdGhhdC5wYXJhbXMudHJ5QWdhaW4sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoYXQucmVzZXRUYXNrKCk7XG4gICAgfSwgZmFsc2UsIHtcbiAgICAgICdhcmlhLWxhYmVsJzogdGhpcy5wYXJhbXMuYXJpYVJldHJ5XG4gICAgfSwge30pOyovXG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgZXZhbHVhdGlvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IFtwYXJhbXMgPSB7fV0gUGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtib29sZWFufSBbcGFyYW1zLnNraXBYQVBJID0gZmFsc2VdIElmIHRydWUsIGRvbid0IHRyaWdnZXIgeEFQSS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oYW5kbGVDaGVja0Fuc3dlciA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIHBhcmFtcyA9IEVzc2F5U2NvcmU0TE1TLmV4dGVuZCh7XG4gICAgICBza2lwWEFQSTogZmFsc2VcbiAgICB9LCBwYXJhbXMpO1xuXG4gICAgLy8gU2hvdyBtZXNzYWdlIGlmIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIGhhcyBub3QgYmVlbiBtZXRcbiAgICAvKmlmICh0aGF0LmlucHV0RmllbGQuZ2V0VGV4dCgpLmxlbmd0aCA8IHRoYXQucGFyYW1zLmJlaGF2aW91ci5taW5pbXVtTGVuZ3RoKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gdGhhdC5wYXJhbXMubm90RW5vdWdoQ2hhcnMucmVwbGFjZSgvQGNoYXJzL2csIHRoYXQucGFyYW1zLmJlaGF2aW91ci5taW5pbXVtTGVuZ3RoKTtcbiAgICAgIHRoYXQuaW5wdXRGaWVsZC5zZXRNZXNzYWdlQ2hhcnMobWVzc2FnZSwgdHJ1ZSk7XG4gICAgICB0aGF0LnJlYWQobWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfSovXG5cbiAgICB0aGF0LnNldFZpZXdTdGF0ZSgncmVzdWx0cycpO1xuXG4gICAgdGhhdC5pbnB1dEZpZWxkLmRpc2FibGUoKTtcbiAgICAvKlxuICAgICAqIE9ubHkgc2V0IHRydWUgb24gXCJjaGVja1wiLiBSZXN1bHQgY29tcHV0YXRpb24gbWF5IHRha2Ugc29tZSB0aW1lIGlmXG4gICAgICogdGhlcmUgYXJlIG1hbnkga2V5d29yZHMgZHVlIHRvIHRoZSBmdXp6eSBtYXRjaCBjaGVja2luZywgc28gaXQncyBub3RcbiAgICAgKiBhIGdvb2QgaWRlYSB0byBkbyB0aGlzIHdoaWxlIHR5cGluZy5cbiAgICAgKi9cbiAgICB0aGF0LmlzQW5zd2VyZWQgPSB0cnVlO1xuICAgIHRoYXQuaGFuZGxlRXZhbHVhdGlvbihwYXJhbXMpO1xuXG4gICAvKiBpZiAodGhhdC5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVNvbHV0aW9uc0J1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgdGhhdC5zaG93QnV0dG9uKCdzaG93LXNvbHV0aW9uJyk7XG4gICAgfSovXG4gICAgdGhhdC5oaWRlQnV0dG9uKCdjaGVjay1hbnN3ZXInKTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IHRoZSB1c2VyIGlucHV0IGZyb20gRE9NLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gW2xpbmVicmVha1JlcGxhY2VtZW50PScgJ10gUmVwbGFjZW1lbnQgZm9yIGxpbmUgYnJlYWtzLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IENsZWFuZWQgaW5wdXQuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZ2V0SW5wdXQgPSBmdW5jdGlvbiAobGluZWJyZWFrUmVwbGFjZW1lbnQpIHtcbiAgICBsaW5lYnJlYWtSZXBsYWNlbWVudCA9IGxpbmVicmVha1JlcGxhY2VtZW50IHx8ICcgJztcblxuICAgIGxldCB1c2VyVGV4dCA9ICcnO1xuICAgIGlmICh0aGlzLmlucHV0RmllbGQpIHtcbiAgICAgIHVzZXJUZXh0ID0gdGhpcy5pbnB1dEZpZWxkLmdldFRleHQoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5wcmV2aW91c1N0YXRlICYmIHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkKSB7XG4gICAgICB1c2VyVGV4dCA9IHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkO1xuICAgIH1cblxuICAgIHJldHVybiB1c2VyVGV4dFxuICAgICAgLnJlcGxhY2UoLyhcXHJcXG58XFxyfFxcbikvZywgbGluZWJyZWFrUmVwbGFjZW1lbnQpXG4gICAgICAucmVwbGFjZSgvXFxzXFxzL2csICcgJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB1c2VyIGludGVyYWN0ZWQuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtib29sZWFufSBbcGFyYW1zLnVwZGF0ZVNjb3JlXSBJZiB0cnVlLCB3aWxsIHRyaWdnZXIgc2NvcmUgY29tcHV0YXRpb24uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuaGFuZGxlSW50ZXJhY3RlZCA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307XG5cbiAgICAvLyBEZWxpYmVyYXRlbHkga2VlcGluZyB0aGUgc3RhdGUgb25jZSBhbnN3ZXJlZFxuICAgIHRoaXMuaXNBbnN3ZXJlZCA9IHRoaXMuaXNBbnN3ZXJlZCB8fCB0aGlzLmlucHV0RmllbGQuZ2V0VGV4dCgpLmxlbmd0aCA+IDA7XG4gICAgLyppZiAocGFyYW1zLnVwZGF0ZVNjb3JlKSB7XG4gICAgICAvLyBPbmx5IHRyaWdnZXJlZCB3aGVuIGV4cGxpY2l0bHkgcmVxdWVzdGVkIGR1ZSB0byBwb3RlbnRpYWwgY29tcGxleGl0eVxuICAgICAgdGhpcy51cGRhdGVTY29yZSgpO1xuICAgIH0qL1xuXG4gICAgdGhpcy50cmlnZ2VyWEFQSSgnaW50ZXJhY3RlZCcpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBFc3NheVNjb3JlNExNUyBoYXMgYmVlbiBzdWJtaXR0ZWQvbWluaW11bSBsZW5ndGggbWV0LlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiBhbnN3ZXIgd2FzIGdpdmVuLlxuICAgKiBAc2VlIGNvbnRyYWN0IGF0IHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTF9XG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZ2V0QW5zd2VyR2l2ZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNBbnN3ZXJlZDtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IGxhdGVzdCBzY29yZS5cbiAgICogQHJldHVybiB7bnVtYmVyfSBsYXRlc3Qgc2NvcmUuXG4gICAqIEBzZWUgY29udHJhY3QgYXQge0BsaW5rIGh0dHBzOi8vaDVwLm9yZy9kb2N1bWVudGF0aW9uL2RldmVsb3BlcnMvY29udHJhY3RzI2d1aWRlcy1oZWFkZXItMn1cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRTY29yZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBSZXR1cm4gdmFsdWUgaXMgcm91bmRlZCBiZWNhdXNlIHJlcG9ydGluZyBtb2R1bGUgZm9yIG1vb2RsZSdzIEg1UCBwbHVnaW4gZXhwZWN0cyBpbnRlZ2Vyc1xuICAgIHJldHVybiAgTWF0aC5yb3VuZCh0aGlzLnNjb3JlKTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IG1heGltdW0gcG9zc2libGUgc2NvcmUuXG4gICAqIEByZXR1cm4ge251bWJlcn0gU2NvcmUgbmVjZXNzYXJ5IGZvciBtYXN0ZXJpbmcuXG4gICAqIEBzZWUgY29udHJhY3QgYXQge0BsaW5rIGh0dHBzOi8vaDVwLm9yZy9kb2N1bWVudGF0aW9uL2RldmVsb3BlcnMvY29udHJhY3RzI2d1aWRlcy1oZWFkZXItM31cbiAgICovXG4gIC8qRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldE1heFNjb3JlID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIFJldHVybiB2YWx1ZSBpcyByb3VuZGVkIGJlY2F1c2UgcmVwb3J0aW5nIG1vZHVsZSBmb3IgbW9vZGxlJ3MgSDVQIHBsdWdpbiBleHBlY3RzIGludGVnZXJzXG4gICAgcmV0dXJuICh0aGlzLnBhcmFtcy5iZWhhdmlvdXIuaWdub3JlU2NvcmluZykgPyB0aGlzLnBhcmFtcy5iZWhhdmlvdXIucG9pbnRzSG9zdCB8fCAwIDogTWF0aC5yb3VuZCh0aGlzLnNjb3JlTWFzdGVyaW5nKTtcbiAgfTsqL1xuXG4gIC8qKlxuICAgKiBTaG93IHNvbHV0aW9uLlxuICAgKiBAc2VlIGNvbnRyYWN0IGF0IHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTR9XG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuc2hvd1NvbHV0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldFZpZXdTdGF0ZSgnc29sdXRpb25zJyk7XG5cbiAgICB0aGlzLmlucHV0RmllbGQuZGlzYWJsZSgpO1xuXG4gICAgLyppZiAodHlwZW9mIHRoaXMucGFyYW1zLnNvbHV0aW9uLnNhbXBsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhpcy5wYXJhbXMuc29sdXRpb24uc2FtcGxlICE9PSAnJykge1xuICAgICAgLy8gV2UgYWRkIHRoZSBzYW1wbGUgc29sdXRpb24gaGVyZSB0byBtYWtlIGNoZWF0aW5nIGF0IGxlYXN0IGEgbGl0dGxlIG1vcmUgZGlmZmljdWx0XG4gICAgICBpZiAodGhpcy5zb2x1dGlvbi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFNPTFVUSU9OX1NBTVBMRSlbMF0uY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGV4dC5jbGFzc0xpc3QuYWRkKFNPTFVUSU9OX1NBTVBMRV9URVhUKTtcbiAgICAgICAgdGV4dC5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy5zb2x1dGlvbi5zYW1wbGU7XG4gICAgICAgIHRoaXMuc29sdXRpb24uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShTT0xVVElPTl9TQU1QTEUpWzBdLmFwcGVuZENoaWxkKHRleHQpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbnNlcnQgc29sdXRpb24gYWZ0ZXIgZXhwbGFuYXRpb25zIG9yIGNvbnRlbnQuXG4gICAgICBjb25zdCBwcmVkZWNlc3NvciA9IHRoaXMuY29udGVudC5wYXJlbnROb2RlO1xuXG4gICAgICBwcmVkZWNlc3Nvci5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnNvbHV0aW9uLCBwcmVkZWNlc3Nvci5uZXh0U2libGluZyk7XG5cbiAgICAgIC8vIFVzZWZ1bCBmb3IgYWNjZXNzaWJpbGl0eSwgYnV0IHNlZW1zIHRvIGp1bXAgdG8gd3JvbmcgcG9zaXRpb24gb24gc29tZSBTYWZhcmkgdmVyc2lvbnNcbiAgICAgIHRoaXMuc29sdXRpb25Bbm5vdW5jZXIuZm9jdXMoKTtcbiAgICB9Ki9cblxuICAgIHRoaXMuaGlkZUJ1dHRvbignc2hvdy1zb2x1dGlvbicpO1xuXG4gICAgLy8gSGFuZGxlIGNhbGxzIGZyb20gdGhlIG91dHNpZGVcbiAgICBpZiAoIXRoaXMuaW50ZXJuYWxTaG93U29sdXRpb25zQ2FsbCkge1xuICAgICAgdGhpcy5oaWRlQnV0dG9uKCdjaGVjay1hbnN3ZXInKTtcbiAgICAgIHRoaXMuaGlkZUJ1dHRvbigndHJ5LWFnYWluJyk7XG4gICAgfVxuXG4gICAgdGhpcy50cmlnZ2VyKCdyZXNpemUnKTtcbiAgfTtcblxuICAvKipcbiAgICogUmVzZXQgdGFzay5cbiAgICogQHNlZSBjb250cmFjdCBhdCB7QGxpbmsgaHR0cHM6Ly9oNXAub3JnL2RvY3VtZW50YXRpb24vZGV2ZWxvcGVycy9jb250cmFjdHMjZ3VpZGVzLWhlYWRlci01fVxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLnJlc2V0VGFzayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldFZpZXdTdGF0ZSgndGFzaycpO1xuXG4gICAgdGhpcy5zZXRFeHBsYW5hdGlvbigpO1xuICAgIHRoaXMucmVtb3ZlRmVlZGJhY2soKTtcbiAgICB0aGlzLmhpZGVTb2x1dGlvbigpO1xuXG4gICAgdGhpcy5oaWRlQnV0dG9uKCdzaG93LXNvbHV0aW9uJyk7XG4gICAgdGhpcy5oaWRlQnV0dG9uKCd0cnktYWdhaW4nKTtcblxuICAgIC8vIFF1ZXN0aW9uU2V0IGNhbiBjb250cm9sIGNoZWNrIGJ1dHRvbiBkZXNwaXRlIG5vdCBpbiBRdWVzdGlvbiBUeXBlIGNvbnRyYWN0XG4gICAgLyppZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZUNoZWNrQnV0dG9uKSB7XG4gICAgICB0aGlzLnNob3dCdXR0b24oJ2NoZWNrLWFuc3dlcicpO1xuICAgIH0qL1xuXG4gICAgdGhpcy5pbnB1dEZpZWxkLmVuYWJsZSgpO1xuICAgIHRoaXMuaW5wdXRGaWVsZC5mb2N1cygpO1xuXG4gICAgdGhpcy5pc0Fuc3dlcmVkID0gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCB4QVBJIGRhdGEuXG4gICAqIEByZXR1cm4ge09iamVjdH0geEFQSSBzdGF0ZW1lbnQuXG4gICAqIEBzZWUgY29udHJhY3QgYXQge0BsaW5rIGh0dHBzOi8vaDVwLm9yZy9kb2N1bWVudGF0aW9uL2RldmVsb3BlcnMvY29udHJhY3RzI2d1aWRlcy1oZWFkZXItNn1cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRYQVBJRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdGVtZW50OiB0aGlzLmdldFhBUElBbnN3ZXJFdmVudCgpLmRhdGEuc3RhdGVtZW50XG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHRhc2sgaGFzIGJlZW4gcGFzc2VkIGJ5IHRoZSB1c2VyLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHVzZXIgcGFzc2VkIG9yIHRhc2sgaXMgbm90IHNjb3JlZC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5pc1Bhc3NlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdHJ1ZTsvLyh0aGlzLnBhcmFtcy5iZWhhdmlvdXIuaWdub3JlU2NvcmluZyB8fCB0aGlzLmdldFNjb3JlKCkgPj0gdGhpcy5zY29yZVBhc3NpbmcpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2NvcmUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSByZXN1bHRzIFJlc3VsdHMuXG4gICAqL1xuIC8qIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS51cGRhdGVTY29yZSA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgcmVzdWx0cyA9IHJlc3VsdHMgfHwgdGhpcy5jb21wdXRlUmVzdWx0cygpO1xuICAgIHRoaXMuc2NvcmUgPSBNYXRoLm1pbih0aGlzLmNvbXB1dGVTY29yZShyZXN1bHRzKSwgdGhpcy5nZXRNYXhTY29yZSgpKTtcbiAgfTtcbiovXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGV2YWx1YXRpb24uXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbcGFyYW1zID0ge31dIFBhcmFtZXRlcnMuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3BhcmFtcy5za2lwWEFQSSA9IGZhbHNlXSBJZiB0cnVlLCBkb24ndCB0cmlnZ2VyIHhBUEkuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuaGFuZGxlRXZhbHVhdGlvbiA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICBwYXJhbXMgPSBFc3NheVNjb3JlNExNUy5leHRlbmQoe1xuICAgICAgc2tpcFhBUEk6IGZhbHNlXG4gICAgfSwgcGFyYW1zKTtcbiAgICBjb25zdCByZXN1bHRzID0gdGhpcy5jb21wdXRlUmVzdWx0cygpO1xuXG4gICAgLy8gQnVpbGQgZXhwbGFuYXRpb25zXG4gICAgY29uc3QgZXhwbGFuYXRpb25zID0gdGhpcy5idWlsZEV4cGxhbmF0aW9uKHJlc3VsdHMpO1xuXG4gICAgLy8gU2hvdyBleHBsYW5hdGlvbnNcbiAgICAvKmlmIChleHBsYW5hdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZXRFeHBsYW5hdGlvbihleHBsYW5hdGlvbnMsIHRoaXMucGFyYW1zLmZlZWRiYWNrSGVhZGVyKTtcbiAgICB9Ki9cblxuICAgIC8vIE5vdCBhbGwga2V5d29yZCBncm91cHMgbWlnaHQgYmUgbmVjZXNzYXJ5IGZvciBtYXN0ZXJpbmdcbiAgIC8vIHRoaXMudXBkYXRlU2NvcmUocmVzdWx0cyk7XG4gICAgLypjb25zdCB0ZXh0U2NvcmUgPSBINVAuUXVlc3Rpb25cbiAgICAgIC5kZXRlcm1pbmVPdmVyYWxsRmVlZGJhY2sodGhpcy5wYXJhbXMub3ZlcmFsbEZlZWRiYWNrLCB0aGlzLmdldFNjb3JlKCkgLyB0aGlzLmdldE1heFNjb3JlKCkpXG4gICAgICAucmVwbGFjZSgnQHNjb3JlJywgdGhpcy5nZXRTY29yZSgpKVxuICAgICAgLnJlcGxhY2UoJ0B0b3RhbCcsIHRoaXMuZ2V0TWF4U2NvcmUoKSk7Ki9cblxuICAgIC8qaWYgKCF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuaWdub3JlU2NvcmluZyAmJiB0aGlzLmdldE1heFNjb3JlKCkgPiAwKSB7XG4gICAgICBjb25zdCBhcmlhTWVzc2FnZSA9ICh0aGlzLnBhcmFtcy5hcmlhWW91clJlc3VsdClcbiAgICAgICAgLnJlcGxhY2UoJ0BzY29yZScsICc6bnVtJylcbiAgICAgICAgLnJlcGxhY2UoJ0B0b3RhbCcsICc6dG90YWwnKTtcbiAgICAgIHRoaXMuc2V0RmVlZGJhY2sodGV4dFNjb3JlLCB0aGlzLmdldFNjb3JlKCksIHRoaXMuZ2V0TWF4U2NvcmUoKSwgYXJpYU1lc3NhZ2UpO1xuICAgIH0qL1xuXG4gICAgLy8gU2hvdyBhbmQgaGlkZSBidXR0b25zIGFzIG5lY2Vzc2FyeVxuICAgIC8vdGhpcy5oYW5kbGVCdXR0b25zKHRoaXMuZ2V0U2NvcmUoKSk7XG5cbiAgICBpZiAoIXBhcmFtcy5za2lwWEFQSSkge1xuICAgICAgLy8gVHJpZ2dlciB4QVBJIHN0YXRlbWVudHMgYXMgbmVjZXNzYXJ5XG4gICAgICB0aGlzLmhhbmRsZVhBUEkoKTtcbiAgICB9XG5cbiAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBCdWlsZCBzb2x1dGlvbiBET00gb2JqZWN0LlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IERPTSBvYmplY3QuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuYnVpbGRTb2x1dGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzb2x1dGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHNvbHV0aW9uLmNsYXNzTGlzdC5hZGQoU09MVVRJT05fQ09OVEFJTkVSKTtcblxuICAgIHRoaXMuc29sdXRpb25Bbm5vdW5jZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLnNvbHV0aW9uQW5ub3VuY2VyLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICAgIC8vdGhpcy5zb2x1dGlvbkFubm91bmNlci5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCB0aGlzLnBhcmFtcy5hcmlhTmF2aWdhdGVkVG9Tb2x1dGlvbik7XG4gICAgdGhpcy5zb2x1dGlvbkFubm91bmNlci5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgLy8gSnVzdCB0ZW1wb3JhcnkgdGFiYmFibGUgZWxlbWVudC4gV2lsbCBiZSBhbm5vdW5jZWQgYnkgcmVhZHNwYWtlci5cbiAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICBldmVudC50YXJnZXQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgIH0pO1xuICAgIHNvbHV0aW9uLmFwcGVuZENoaWxkKHRoaXMuc29sdXRpb25Bbm5vdW5jZXIpO1xuXG4gICAgLypjb25zdCBzb2x1dGlvblRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc29sdXRpb25UaXRsZS5jbGFzc0xpc3QuYWRkKFNPTFVUSU9OX1RJVExFKTtcbiAgICBzb2x1dGlvblRpdGxlLmlubmVySFRNTCA9IHRoaXMucGFyYW1zLnNvbHV0aW9uVGl0bGU7XG4gICAgc29sdXRpb24uYXBwZW5kQ2hpbGQoc29sdXRpb25UaXRsZSk7Ki9cblxuICAgLyogY29uc3Qgc29sdXRpb25JbnRyb2R1Y3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzb2x1dGlvbkludHJvZHVjdGlvbi5jbGFzc0xpc3QuYWRkKFNPTFVUSU9OX0lOVFJPRFVDVElPTik7XG4gICAgc29sdXRpb25JbnRyb2R1Y3Rpb24uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMuc29sdXRpb24uaW50cm9kdWN0aW9uO1xuICAgIHNvbHV0aW9uLmFwcGVuZENoaWxkKHNvbHV0aW9uSW50cm9kdWN0aW9uKTsqL1xuXG4gICAgY29uc3Qgc29sdXRpb25TYW1wbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzb2x1dGlvblNhbXBsZS5jbGFzc0xpc3QuYWRkKFNPTFVUSU9OX1NBTVBMRSk7XG4gICAgc29sdXRpb24uYXBwZW5kQ2hpbGQoc29sdXRpb25TYW1wbGUpO1xuXG4gICAgcmV0dXJuIHNvbHV0aW9uO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIaWRlIHRoZSBzb2x1dGlvbi5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oaWRlU29sdXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuc29sdXRpb24ucGFyZW50Tm9kZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5zb2x1dGlvbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuc29sdXRpb24pO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQ29tcHV0ZSByZXN1bHRzLlxuICAgKiBAcmV0dXJuIHtPYmplY3RbXX0gUmVzdWx0czogW1t7XCJrZXl3b3JkXCI6IGtleXdvcmQsIFwibWF0Y2hcIjogbWF0Y2gsIFwiaW5kZXhcIjogaW5kZXh9Kl0qXS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5jb21wdXRlUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCByZXN1bHRzID0gW107XG5cbiAgICAvLyBTaG91bGQgbm90IGhhcHBlbiwgYnV0IGp1c3QgdG8gYmUgc3VyZSAuLi5cbiAgIC8vIHRoaXMucGFyYW1zLmtleXdvcmRzID0gdGhpcy5wYXJhbXMua2V5d29yZHMgfHwgW107XG5cbiAgICAvLyBGaWx0ZXIgb3V0IGtleXdvcmRzIHRoYXQgaGF2ZSBub3QgYmVlbiBzZXQuXG4gICAvKiB0aGlzLnBhcmFtcy5rZXl3b3JkcyA9IHRoaXMucGFyYW1zLmtleXdvcmRzLmZpbHRlcihmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIHR5cGVvZiBlbGVtZW50LmtleXdvcmQgIT09ICd1bmRlZmluZWQnO1xuICAgIH0pOyovXG5cbiAgICAvKnRoaXMucGFyYW1zLmtleXdvcmRzLmZvckVhY2goZnVuY3Rpb24gKGFsdGVybmF0aXZlR3JvdXApIHtcbiAgICAgIGNvbnN0IHJlc3VsdHNHcm91cCA9IFtdO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IGFsdGVybmF0aXZlR3JvdXAub3B0aW9ucztcbiAgICAgIGNvbnN0IGNhc2VTZW5zaXRpdmUgPSAodGhhdC5wYXJhbXMuYmVoYXZpb3VyLm92ZXJyaWRlQ2FzZVNlbnNpdGl2ZSAhPT0gJ29mZicpICYmXG4gICAgICAgICh0aGF0LnBhcmFtcy5iZWhhdmlvdXIub3ZlcnJpZGVDYXNlU2Vuc2l0aXZlID09PSAnb24nIHx8IG9wdGlvbnMuY2FzZVNlbnNpdGl2ZSk7XG5cbiAgICAgIGxldCBhbHRlcm5hdGl2ZXMgPSBbYWx0ZXJuYXRpdmVHcm91cC5rZXl3b3JkIHx8IFtdXVxuICAgICAgICAuY29uY2F0KGFsdGVybmF0aXZlR3JvdXAuYWx0ZXJuYXRpdmVzIHx8IFtdKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChhbHRlcm5hdGl2ZSkge1xuICAgICAgICAgIHJldHVybiB0aGF0Lmh0bWxEZWNvZGUoYWx0ZXJuYXRpdmUpO1xuICAgICAgICB9KTtcblxuICAgICAgL1xcKlxuICAgICAgICogR2V0IGFsbCBtYXRjaGVzIHRvIHJlZ3VsYXIgZXhwcmVzc2lvbnMgYW5kIHByZXRlbmQgdGhlIG1hdGNoZXMgd2VyZVxuICAgICAgICogZ2l2ZW4gYXMgYWx0ZXJuYXRpdmUgYW5zd2VycyBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGRldGVjdCB0aGVtLlxuICAgICAgICogVGhpcyByZXN1bHQgY29tcHV0YXRpb24gbWlnaHQgbmVlZCBhIHJld3JpdGUgLi4uXG4gICAgICAgKlxcL1xuICAgICAgY29uc3QgcmVndWxhckV4cHJlc3Npb25NYXRjaGVzID0gdGhhdFxuICAgICAgICAuZ2V0UmVnRXhwQWx0ZXJuYXRpdmVzKGFsdGVybmF0aXZlcywgdGhhdC5nZXRJbnB1dCgpLCBjYXNlU2Vuc2l0aXZlKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgIC8vIEFsbG93IHRvIGRpZmZlcmVudGlhdGUgZnJvbSB3aWxkY2FyZCBhc3Rlcmlza1xuICAgICAgICAgIHJldHVybiBtYXRjaCA9IG1hdGNoLnJlcGxhY2UoL1xcKlxcLywgRXNzYXlTY29yZTRMTVMuUkVHVUxBUl9FWFBSRVNTSU9OX0FTVEVSSVNLKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIE5vdCBjaGFpbmVkLCBiZWNhdXNlIHdlIHN0aWxsIG5lZWQgdGhlIG9sZCB2YWx1ZSBpbnNpZGVcbiAgICAgIGFsdGVybmF0aXZlcyA9IGFsdGVybmF0aXZlc1xuICAgICAgICAvLyBvbmx5IFwibm9ybWFsXCIgYWx0ZXJuYXRpdmVzXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFsdGVybmF0aXZlKSB7XG4gICAgICAgICAgcmV0dXJuIChhbHRlcm5hdGl2ZVswXSAhPT0gJy8nIHx8IGFsdGVybmF0aXZlW2FsdGVybmF0aXZlLmxlbmd0aCAtIDFdICE9PSAnLycpO1xuICAgICAgICB9KVxuICAgICAgICAvLyByZWd1bGFyIG1hdGNoZXMgZm91bmQgaW4gdGV4dCBmb3IgYWx0ZXJuYXRpdmVzXG4gICAgICAgIC5jb25jYXQocmVndWxhckV4cHJlc3Npb25NYXRjaGVzKVxuICAgICAgICAvLyByZWd1bGFyIG1hdGNoZXMgY291bGQgbWF0Y2ggZW1wdHkgc3RyaW5nXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFsdGVybmF0aXZlKSB7XG4gICAgICAgICAgcmV0dXJuIGFsdGVybmF0aXZlICE9PSAnJztcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIERldGVjdCBhbGwgbWF0Y2hlc1xuICAgICAgYWx0ZXJuYXRpdmVzLmZvckVhY2goZnVuY3Rpb24gKGFsdGVybmF0aXZlKSB7XG4gICAgICAgIGxldCBpbnB1dFRlc3QgPSB0aGF0LmdldElucHV0KCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGNhc2Ugc2Vuc2l0aXZpdHlcbiAgICAgICAgY29uc3QgY2FzZVNlbnNpdGl2ZSA9IHRoYXQucGFyYW1zLmJlaGF2aW91ci5vdmVycmlkZUNhc2VTZW5zaXRpdmUgPT09ICdvbicgfHwgb3B0aW9ucy5jYXNlU2Vuc2l0aXZlO1xuICAgICAgICBpZiAoIWNhc2VTZW5zaXRpdmUpIHtcbiAgICAgICAgICBhbHRlcm5hdGl2ZSA9IGFsdGVybmF0aXZlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaW5wdXRUZXN0ID0gaW5wdXRUZXN0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCdWlsZCBhcnJheSBvZiBtYXRjaGVzIGZvciBlYWNoIHR5cGUgb2YgbWF0Y2hcbiAgICAgICAgY29uc3QgbWF0Y2hlc0V4YWN0ID0gdGhhdC5kZXRlY3RFeGFjdE1hdGNoZXMoYWx0ZXJuYXRpdmUsIGlucHV0VGVzdCk7XG4gICAgICAgIGNvbnN0IG1hdGNoZXNXaWxkY2FyZCA9IGFsdGVybmF0aXZlLmluZGV4T2YoJyonKSAhPT0gLTEgPyB0aGF0LmRldGVjdFdpbGRjYXJkTWF0Y2hlcyhhbHRlcm5hdGl2ZSwgaW5wdXRUZXN0LCBjYXNlU2Vuc2l0aXZlKSA6IFtdO1xuICAgICAgICBjb25zdCBtYXRjaGVzRnV6enkgPSBvcHRpb25zLmZvcmdpdmVNaXN0YWtlcyA/IHRoYXQuZGV0ZWN0RnV6enlNYXRjaGVzKGFsdGVybmF0aXZlLCBpbnB1dFRlc3QpIDogW107XG5cbiAgICAgICAgLy8gTWVyZ2UgbWF0Y2hlcyB3aXRob3V0IGR1cGxpY2F0ZXNcbiAgICAgICAgdGhhdC5tZXJnZU1hdGNoZXMobWF0Y2hlc0V4YWN0LCBtYXRjaGVzV2lsZGNhcmQsIG1hdGNoZXNGdXp6eSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHJlc3VsdHNHcm91cC5wdXNoKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdHNHcm91cCk7XG4gICAgfSk7Ki9cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICAvKipcbiAgICogQ29tcHV0ZSB0aGUgc2NvcmUgZm9yIHRoZSByZXN1bHRzLlxuICAgKiBAcGFyYW0ge09iamVjdFtdfSByZXN1bHRzIC0gUmVzdWx0cyBmcm9tIHRoZSB0YXNrLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFNjb3JlLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmNvbXB1dGVTY29yZSA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgIC8qIHRoaXMucGFyYW1zLmtleXdvcmRzLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQsIGkpIHtcbiAgICAgIHNjb3JlICs9IE1hdGgubWluKHJlc3VsdHNbaV0ubGVuZ3RoLCBrZXl3b3JkLm9wdGlvbnMub2NjdXJyZW5jZXMpICoga2V5d29yZC5vcHRpb25zLnBvaW50cztcbiAgICB9KTsqL1xuICAgIHJldHVybiBzY29yZTtcbiAgfTtcblxuICAvKipcbiAgICogQnVpbGQgdGhlIGV4cGxhbmF0aW9ucyBmb3IgSDVQLlF1ZXN0aW9uLnNldEV4cGxhbmF0aW9uLlxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVzdWx0cyAtIFJlc3VsdHMgZnJvbSB0aGUgdGFzay5cbiAgICogQHJldHVybiB7T2JqZWN0W119IEV4cGxhbmF0aW9ucyBmb3IgSDVQLlF1ZXN0aW9uLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmJ1aWxkRXhwbGFuYXRpb24gPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgIGNvbnN0IGV4cGxhbmF0aW9ucyA9IFtdO1xuXG4gICAgbGV0IHdvcmQ7XG4vLyAgICB0aGlzLnBhcmFtcy5rZXl3b3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChrZXl3b3JkLCBpKSB7XG4vLyAgICAgIHdvcmQgPSBGRUVEQkFDS19FTVBUWTtcbi8vICAgICAgLy8gS2V5d29yZCB3YXMgbm90IGZvdW5kIGFuZCBmZWVkYmFjayBpcyBwcm92aWRlZCBmb3IgdGhpcyBjYXNlXG4vLyAgICAgIGlmIChyZXN1bHRzW2ldLmxlbmd0aCA9PT0gMCAmJiBrZXl3b3JkLm9wdGlvbnMuZmVlZGJhY2tNaXNzZWQpIHtcbi8vICAgICAgICBpZiAoa2V5d29yZC5vcHRpb25zLmZlZWRiYWNrTWlzc2VkV29yZCA9PT0gJ2tleXdvcmQnKSB7XG4vLyAgICAgICAgICAvLyBNYWluIGtleXdvcmQgZGVmaW5lZFxuLy8gICAgICAgICAgd29yZCA9IGtleXdvcmQua2V5d29yZDtcbi8vICAgICAgICB9XG4vLyAgICAgICAgZXhwbGFuYXRpb25zLnB1c2goe2NvcnJlY3Q6IHdvcmQsIHRleHQ6IGtleXdvcmQub3B0aW9ucy5mZWVkYmFja01pc3NlZH0pO1xuLy8gICAgICB9XG4vL1xuLy8gICAgICAvLyBLZXl3b3JkIGZvdW5kIGFuZCBmZWVkYmFjayBpcyBwcm92aWRlZCBmb3IgdGhpcyBjYXNlXG4vLyAgICAgIGlmIChyZXN1bHRzW2ldLmxlbmd0aCA+IDAgJiYga2V5d29yZC5vcHRpb25zLmZlZWRiYWNrSW5jbHVkZWQpIHtcbi8vICAgICAgICAvLyBTZXQgd29yZCBpbiBmcm9udCBvZiBmZWVkYmFja1xuLy8gICAgICAgIHN3aXRjaCAoa2V5d29yZC5vcHRpb25zLmZlZWRiYWNrSW5jbHVkZWRXb3JkKSB7XG4vLyAgICAgICAgICBjYXNlICdrZXl3b3JkJzpcbi8vICAgICAgICAgICAgLy8gTWFpbiBrZXl3b3JkIGRlZmluZWRcbi8vICAgICAgICAgICAgd29yZCA9IGtleXdvcmQua2V5d29yZDtcbi8vICAgICAgICAgICAgYnJlYWs7XG4vLyAgICAgICAgICBjYXNlICdhbHRlcm5hdGl2ZSc6XG4vLyAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHRoYXQgd2FzIGZvdW5kXG4vLyAgICAgICAgICAgIHdvcmQgPSByZXN1bHRzW2ldWzBdLmtleXdvcmQ7XG4vLyAgICAgICAgICAgIGJyZWFrO1xuLy8gICAgICAgICAgY2FzZSAnYW5zd2VyJzpcbi8vICAgICAgICAgICAgLy8gQW5zd2VyIG1hdGNoaW5nIGFuIGFsdGVybmF0aXZlIGF0IHRoZSBsZWFybmVyIHR5cGVkIGl0XG4vLyAgICAgICAgICAgIHdvcmQgPSByZXN1bHRzW2ldWzBdLm1hdGNoO1xuLy8gICAgICAgICAgICBicmVhaztcbi8vICAgICAgICB9XG4vLyAgICAgICAgZXhwbGFuYXRpb25zLnB1c2goe2NvcnJlY3Q6IHdvcmQsIHRleHQ6IGtleXdvcmQub3B0aW9ucy5mZWVkYmFja0luY2x1ZGVkfSk7XG4vLyAgICAgIH1cbi8vICAgIH0pO1xuXG4gICAgaWYgKGV4cGxhbmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBTb3J0IFwiaW5jbHVkZWRcIiBiZWZvcmUgXCJub3QgaW5jbHVkZWRcIiwgYnV0IGtlZXAgb3JkZXIgb3RoZXJ3aXNlXG4gICAgICBleHBsYW5hdGlvbnMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYS5jb3JyZWN0ID09PSBGRUVEQkFDS19FTVBUWSAmJiBiLmNvcnJlY3QgIT09IEZFRURCQUNLX0VNUFRZO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBleHBsYW5hdGlvbnM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBidXR0b25zJyB2aXNpYmlsaXR5LlxuICAgKiBAcGFyYW0ge251bWJlcn0gc2NvcmUgLSBTY29yZSB0aGUgdXNlciByZWNlaXZlZC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oYW5kbGVCdXR0b25zID0gZnVuY3Rpb24gKHNjb3JlKSB7XG4gICAgLyppZiAodGhpcy5wYXJhbXMuc29sdXRpb24uc2FtcGxlICYmICF0aGlzLnNvbHV0aW9uKSB7XG4gICAgICB0aGlzLnNob3dCdXR0b24oJ3Nob3ctc29sdXRpb24nKTtcbiAgICB9Ki9cblxuICAgIC8vIFdlIG5lZWQgdGhlIHJldHJ5IGJ1dHRvbiBpZiB0aGUgbWFzdGVyaW5nIHNjb3JlIGhhcyBub3QgYmVlbiByZWFjaGVkIG9yIHNjb3JpbmcgaXMgaXJyZWxldmFudFxuICAgIC8qaWYgKHNjb3JlIDwgdGhpcy5nZXRNYXhTY29yZSgpIHx8IHRoaXMucGFyYW1zLmJlaGF2aW91ci5pZ25vcmVTY29yaW5nIHx8IHRoaXMuZ2V0TWF4U2NvcmUoKSA9PT0gMCkge1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSkge1xuICAgICAgICB0aGlzLnNob3dCdXR0b24oJ3RyeS1hZ2FpbicpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZUJ1dHRvbigndHJ5LWFnYWluJyk7XG4gICAgfSovXG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB4QVBJIGV2ZW50IHRyaWdnZXJpbmdcbiAgICogQHBhcmFtIHtudW1iZXJ9IHNjb3JlIC0gU2NvcmUgdGhlIHVzZXIgcmVjZWl2ZWQuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuaGFuZGxlWEFQSSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnRyaWdnZXIodGhpcy5nZXRYQVBJQW5zd2VyRXZlbnQoKSk7XG5cbiAgICAvLyBBZGRpdGlvbmFsIHhBUEkgdmVyYnMgdGhhdCBtaWdodCBiZSB1c2VmdWwgZm9yIG1ha2luZyBhbmFseXRpY3MgZWFzaWVyXG4gICAgdGhpcy50cmlnZ2VyKHRoaXMuY3JlYXRlRXNzYXlYQVBJRXZlbnQoJ3Bhc3NlZCcpKTtcbiAgIC8qIGlmICghdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmlnbm9yZVNjb3JpbmcgJiYgdGhpcy5nZXRNYXhTY29yZSgpID4gMCkge1xuICAgICAgaWYgKHRoaXMuZ2V0U2NvcmUoKSA8IHRoaXMuc2NvcmVQYXNzaW5nKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcih0aGlzLmNyZWF0ZUVzc2F5WEFQSUV2ZW50KCdmYWlsZWQnKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKHRoaXMuY3JlYXRlRXNzYXlYQVBJRXZlbnQoJ3Bhc3NlZCcpKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldFNjb3JlKCkgPj0gdGhpcy5nZXRNYXhTY29yZSgpKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcih0aGlzLmNyZWF0ZUVzc2F5WEFQSUV2ZW50KCdtYXN0ZXJlZCcpKTtcbiAgICAgIH1cbiAgICB9Ki9cbiAgfTtcblxuICAvKipcbiAgICogQ3JlYXRlIGFuIHhBUEkgZXZlbnQgZm9yIEVzc2F5U2NvcmU0TE1TLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyYiAtIFNob3J0IGlkIG9mIHRoZSB2ZXJiIHdlIHdhbnQgdG8gdHJpZ2dlci5cbiAgICogQHJldHVybiB7SDVQLlhBUElFdmVudH0gRXZlbnQgdGVtcGxhdGUuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuY3JlYXRlRXNzYXlYQVBJRXZlbnQgPSBmdW5jdGlvbiAodmVyYikge1xuICAgIGNvbnN0IHhBUElFdmVudCA9IHRoaXMuY3JlYXRlWEFQSUV2ZW50VGVtcGxhdGUodmVyYik7XG4gICAgRXNzYXlTY29yZTRMTVMuZXh0ZW5kKFxuICAgICAgeEFQSUV2ZW50LmdldFZlcmlmaWVkU3RhdGVtZW50VmFsdWUoWydvYmplY3QnLCAnZGVmaW5pdGlvbiddKSxcbiAgICAgIHRoaXMuZ2V0eEFQSURlZmluaXRpb24oKSk7XG4gICAgcmV0dXJuIHhBUElFdmVudDtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IHRoZSB4QVBJIGRlZmluaXRpb24gZm9yIHRoZSB4QVBJIG9iamVjdC5cbiAgICogcmV0dXJuIHtPYmplY3R9IFhBUEkgZGVmaW5pdGlvbi5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXR4QVBJRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBkZWZpbml0aW9uID0ge307XG4gICAgZGVmaW5pdGlvbi5uYW1lID0ge307XG4gICAgZGVmaW5pdGlvbi5uYW1lW3RoaXMubGFuZ3VhZ2VUYWddID0gdGhpcy5nZXRUaXRsZSgpO1xuICAgIC8vIEZhbGxiYWNrIGZvciBoNXAtcGhwLXJlcG9ydGluZywgZXhwZWN0cyBlbi1VU1xuICAgIGRlZmluaXRpb24ubmFtZVsnZW4tVVMnXSA9IGRlZmluaXRpb24ubmFtZVt0aGlzLmxhbmd1YWdlVGFnXTtcbiAgICAvLyBUaGUgSDVQIHJlcG9ydGluZyBtb2R1bGUgZXhwZWN0cyB0aGUgXCJibGFua3NcIiB0byBiZSBhZGRlZCB0byB0aGUgZGVzY3JpcHRpb25cbiAgICBkZWZpbml0aW9uLmRlc2NyaXB0aW9uID0ge307XG4gICAgZGVmaW5pdGlvbi5kZXNjcmlwdGlvblt0aGlzLmxhbmd1YWdlVGFnXSA9IHRoaXMucGFyYW1zLnRhc2tEZXNjcmlwdGlvbiArIEVzc2F5U2NvcmU0TE1TLkZJTExfSU5fUExBQ0VIT0xERVI7XG4gICAgLy8gRmFsbGJhY2sgZm9yIGg1cC1waHAtcmVwb3J0aW5nLCBleHBlY3RzIGVuLVVTXG4gICAgZGVmaW5pdGlvbi5kZXNjcmlwdGlvblsnZW4tVVMnXSA9IGRlZmluaXRpb24uZGVzY3JpcHRpb25bdGhpcy5sYW5ndWFnZVRhZ107XG4gICAgZGVmaW5pdGlvbi50eXBlID0gJ2h0dHA6Ly9pZC50aW5jYW5hcGkuY29tL2FjdGl2aXR5dHlwZS9lc3NheSc7XG4gICAgZGVmaW5pdGlvbi5pbnRlcmFjdGlvblR5cGUgPSAnbG9uZy1maWxsLWluJztcbiAgICAvKlxuICAgICAqIFRoZSBvZmZpY2lhbCB4QVBJIGRvY3VtZW50YXRpb24gZGlzY291cmFnZXMgdG8gdXNlIGEgY29ycmVjdCByZXNwb25zZVxuICAgICAqIHBhdHRlcm4gaXQgaWYgdGhlIGNyaXRlcmlhIGZvciBhIHF1ZXN0aW9uIGFyZSBjb21wbGV4IGFuZCBjb3JyZWN0XG4gICAgICogcmVzcG9uc2VzIGNhbm5vdCBiZSBleGhhdXN0aXZlbHkgbGlzdGVkLiBUaGV5IGNhbid0LlxuICAgICAqL1xuICAgICBjb25zb2xlLmxvZygnZ2V0eEFQSURlZmluaXRpb24nKTtcbiAgICAgY29uc29sZS5sb2coZGVmaW5pdGlvbik7XG4gICAgcmV0dXJuIGRlZmluaXRpb247XG4gIH07XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHhBUEkgYW5zd2VyIGV2ZW50LlxuICAgKiBAcmV0dXJuIHtINVAuWEFQSUV2ZW50fSB4QVBJIGFuc3dlciBldmVudC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRYQVBJQW5zd2VyRXZlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgeEFQSUV2ZW50ID0gdGhpcy5jcmVhdGVFc3NheVhBUElFdmVudCgnYW5zd2VyZWQnKTtcblxuICAgIHhBUElFdmVudC5zZXRTY29yZWRSZXN1bHQodGhpcy5nZXRTY29yZSgpLCB0aGlzLmdldFNjb3JlKCksIHRoaXMsIHRydWUsIHRoaXMuaXNQYXNzZWQoKSk7XG4gICAgeEFQSUV2ZW50LmRhdGEuc3RhdGVtZW50LnJlc3VsdC5yZXNwb25zZSA9IHRoaXMuaW5wdXRGaWVsZC5nZXRUZXh0KCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ2dldFhBUElBbnN3ZXJFdmVudCcpO1xuICAgIGNvbnNvbGUubG9nKHhBUElFdmVudCk7XG4gICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqJyk7XG4gICAgcmV0dXJuIHhBUElFdmVudDtcbiAgfTtcblxuICAvKipcbiAgICogRGV0ZWN0IGV4YWN0IG1hdGNoZXMgb2YgbmVlZGxlIGluIGhheXN0YWNrLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmVlZGxlIC0gV29yZCBvciBwaHJhc2UgdG8gZmluZC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGhheXN0YWNrIC0gVGV4dCB0byBmaW5kIHRoZSB3b3JkIG9yIHBocmFzZSBpbi5cbiAgICogQHJldHVybiB7T2JqZWN0W119IFJlc3VsdHM6IFt7J2tleXdvcmQnOiBuZWVkbGUsICdtYXRjaCc6IG5lZWRsZSwgJ2luZGV4JzogZnJvbnQgKyBwb3N9Kl0uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZGV0ZWN0RXhhY3RNYXRjaGVzID0gZnVuY3Rpb24gKG5lZWRsZSwgaGF5c3RhY2spIHtcbiAgICAvLyBTaW1wbHkgZGV0ZWN0IGFsbCBleGFjdCBtYXRjaGVzIGFuZCBpdHMgcG9zaXRpb25zIGluIHRoZSBoYXlzdGFja1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGxldCBwb3MgPSAtMTtcbiAgICBsZXQgZnJvbnQgPSAwO1xuXG4gICAgbmVlZGxlID0gbmVlZGxlXG4gICAgICAucmVwbGFjZSgvXFwqLywgJycpIC8vIFdpbGRjYXJkcyBjaGVja2VkIHNlcGFyYXRlbHlcbiAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoRXNzYXlTY29yZTRMTVMuUkVHVUxBUl9FWFBSRVNTSU9OX0FTVEVSSVNLLCAnZycpLCAnKicpOyAvLyBBc3RlcmlzayBmcm9tIHJlZ2V4cFxuXG4gICAgd2hpbGUgKCgocG9zID0gaGF5c3RhY2suaW5kZXhPZihuZWVkbGUpKSkgIT09IC0xICYmIG5lZWRsZSAhPT0gJycpIHtcbiAgICAgIGlmIChINVAuVGV4dFV0aWxpdGllcy5pc0lzb2xhdGVkKG5lZWRsZSwgaGF5c3RhY2spKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHsna2V5d29yZCc6IG5lZWRsZSwgJ21hdGNoJzogbmVlZGxlLCAnaW5kZXgnOiBmcm9udCArIHBvc30pO1xuICAgICAgfVxuICAgICAgZnJvbnQgKz0gcG9zICsgbmVlZGxlLmxlbmd0aDtcbiAgICAgIGhheXN0YWNrID0gaGF5c3RhY2suc3Vic3RyKHBvcyArIG5lZWRsZS5sZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXRlY3Qgd2lsZGNhcmQgbWF0Y2hlcyBvZiBuZWVkbGUgaW4gaGF5c3RhY2suXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZWVkbGUgLSBXb3JkIG9yIHBocmFzZSB0byBmaW5kLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGF5c3RhY2sgLSBUZXh0IHRvIGZpbmQgdGhlIHdvcmQgb3IgcGhyYXNlIGluLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNhc2VTZW5zaXRpdmUgLSBJZiB0cnVlLCBhbHRlcm5hdGl2ZSBpcyBjYXNlIHNlbnNpdGl2ZS5cbiAgICogQHJldHVybiB7T2JqZWN0W119IFJlc3VsdHM6IFt7J2tleXdvcmQnOiBuZWVkbGUsICdtYXRjaCc6IG5lZWRsZSwgJ2luZGV4JzogZnJvbnQgKyBwb3N9Kl0uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZGV0ZWN0V2lsZGNhcmRNYXRjaGVzID0gZnVuY3Rpb24gKG5lZWRsZSwgaGF5c3RhY2ssIGNhc2VTZW5zaXRpdmUpIHtcbiAgICBpZiAobmVlZGxlLmluZGV4T2YoJyonKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvLyBDbGVhbiBuZWVkbGUgZnJvbSBzdWNjZXNzaXZlIHdpbGRjYXJkc1xuICAgIG5lZWRsZSA9IG5lZWRsZS5yZXBsYWNlKC9bKl17Mix9L2csICcqJyk7XG5cbiAgICAvLyBDbGVhbiBuZWVkbGUgZnJvbSByZWd1bGFyIGV4cHJlc3Npb24gY2hhcmFjdGVycywgKiBuZWVkZWQgZm9yIHdpbGRjYXJkXG4gICAgY29uc3QgcmVnZXhwQ2hhcnMgPSBbJ1xcXFwnLCAnLicsICdbJywgJ10nLCAnPycsICcrJywgJygnLCAnKScsICd7JywgJ30nLCAnfCcsICchJywgJ14nLCAnLSddO1xuICAgIHJlZ2V4cENoYXJzLmZvckVhY2goZnVuY3Rpb24gKGNoYXIpIHtcbiAgICAgIG5lZWRsZSA9IG5lZWRsZS5zcGxpdChjaGFyKS5qb2luKCdcXFxcJyArIGNoYXIpO1xuICAgIH0pO1xuXG4gICAgLy8gV2UgYWNjZXB0IG9ubHkgY2hhcmFjdGVycyBmb3IgdGhlIHdpbGRjYXJkXG4gICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cChuZWVkbGUucmVwbGFjZSgvXFwqL2csIEVzc2F5U2NvcmU0TE1TLkNIQVJTX1dJTERDQVJEICsgJysnKSwgdGhpcy5nZXRSZWdFeHBNb2RpZmllcnMoY2FzZVNlbnNpdGl2ZSkpO1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGxldCBtYXRjaDtcbiAgICB3aGlsZSAoKG1hdGNoID0gcmVnZXhwLmV4ZWMoaGF5c3RhY2spKSAhPT0gbnVsbCApIHtcbiAgICAgIGlmIChINVAuVGV4dFV0aWxpdGllcy5pc0lzb2xhdGVkKG1hdGNoWzBdLCBoYXlzdGFjaywgeydpbmRleCc6IG1hdGNoLmluZGV4fSkpIHtcbiAgICAgICAgcmVzdWx0LnB1c2goeydrZXl3b3JkJzogbmVlZGxlLCAnbWF0Y2gnOiBtYXRjaFswXSwgJ2luZGV4JzogbWF0Y2guaW5kZXh9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKipcbiAgICogRGV0ZWN0IGZ1enp5IG1hdGNoZXMgb2YgbmVlZGxlIGluIGhheXN0YWNrLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmVlZGxlIC0gV29yZCBvciBwaHJhc2UgdG8gZmluZC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGhheXN0YWNrIC0gVGV4dCB0byBmaW5kIHRoZSB3b3JkIG9yIHBocmFzZSBpbi5cbiAgICogQHBhcmFtIHtPYmplY3RbXX0gUmVzdWx0cy5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5kZXRlY3RGdXp6eU1hdGNoZXMgPSBmdW5jdGlvbiAobmVlZGxlLCBoYXlzdGFjaykge1xuICAgIC8vIElkZWFsbHksIHRoaXMgc2hvdWxkIGJlIHRoZSBtYXhpbXVtIG51bWJlciBvZiBhbGxvd2VkIHRyYW5zZm9ybWF0aW9ucyBmb3IgdGhlIExldmVuc2h0ZWluIGRpc2N0YW5jZS5cbiAgICBjb25zdCB3aW5kb3dTaXplID0gMjtcbiAgICAvKlxuICAgICAqIFdlIGNhbm5vdCBzaW1wbGUgc3BsaXQgd29yZHMgYmVjYXVzZSB3ZSdyZSBhbHNvIGxvb2tpbmcgZm9yIHBocmFzZXMuXG4gICAgICogSWYgd2Ugd2VyZSBqdXN0IGxvb2tpbmcgZm9yIGV4YWN0IG1hdGNoZXMsIHdlIGNvdWxkIHVzZSBzb21ldGhpbmcgc21hcnRlclxuICAgICAqIHN1Y2ggYXMgdGhlIEtNUCBhbGdvcml0aG0uIEJlY2F1c2Ugd2UncmUgZGVhbGluZyB3aXRoIGZ1enp5IG1hdGNoZXMsIHVzaW5nXG4gICAgICogdGhpcyBpbnR1aXRpdmUgZXhoYXVzdGl2ZSBhcHByb2FjaCBtaWdodCBiZSB0aGUgYmVzdCB3YXkgdG8gZ28uXG4gICAgICovXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIC8vIFdpdGhvdXQgbG9va2luZyBhdCB0aGUgc3Vycm91bmRpbmdzIHdlJ2QgbWlzcyB3b3JkcyB0aGF0IGhhdmUgYWRkaXRpb25hbCBvciBtaXNzaW5nIGNoYXJzXG4gICAgZm9yIChsZXQgc2l6ZSA9IC13aW5kb3dTaXplOyBzaXplIDw9IHdpbmRvd1NpemU7IHNpemUrKykge1xuICAgICAgZm9yIChsZXQgcG9zID0gMDsgcG9zIDwgaGF5c3RhY2subGVuZ3RoOyBwb3MrKykge1xuICAgICAgICBjb25zdCBzdHJhdyA9IGhheXN0YWNrLnN1YnN0cihwb3MsIG5lZWRsZS5sZW5ndGggKyBzaXplKTtcbiAgICAgICAgaWYgKEg1UC5UZXh0VXRpbGl0aWVzLmFyZVNpbWlsYXIobmVlZGxlLCBzdHJhdykgJiYgSDVQLlRleHRVdGlsaXRpZXMuaXNJc29sYXRlZChzdHJhdywgaGF5c3RhY2ssIHsnaW5kZXgnOiBwb3N9KSkge1xuICAgICAgICAgIC8vIFRoaXMgd2lsbCBvbmx5IGFkZCB0aGUgbWF0Y2ggaWYgaXQncyBub3QgYSBkdXBsaWNhdGUgdGhhdCB3ZSBmb3VuZCBhbHJlYWR5IGluIHRoZSBwcm94aW1pdHkgb2YgcG9zXG4gICAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5zKHJlc3VsdHMsIHBvcykpIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7J2tleXdvcmQnOiBuZWVkbGUsICdtYXRjaCc6IHN0cmF3LCAnaW5kZXgnOiBwb3N9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgdGhlIG1hdGNoZXMgZm91bmQgdG8gYSByZWd1bGFyIGV4cHJlc3Npb24gYWx0ZXJuYXRpdmUuXG4gICAqIEBwYXJhbSB7c3RyaW5nW119IGFsdGVybmF0aXZlcyAtIEFsdGVybmF0aXZlcy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGlucHV0VGVzdCAtIE9yaWdpbmFsIHRleHQgYnkgc3R1ZGVudC5cbiAgICogQHBhcmFtIHtib29sZWFufSBjYXNlU2Vuc2l0aXZlIC0gSWYgdHJ1ZSwgYWx0ZXJuYXRpdmUgaXMgY2FzZSBzZW5zaXRpdmUuXG4gICAqIEByZXR1cm4ge3N0cmluZ1tdfSBNYXRjaGVzIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvbnMuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZ2V0UmVnRXhwQWx0ZXJuYXRpdmVzID0gZnVuY3Rpb24gKGFsdGVybmF0aXZlcywgaW5wdXRUZXN0LCBjYXNlU2Vuc2l0aXZlKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG5cbiAgICByZXR1cm4gYWx0ZXJuYXRpdmVzXG4gICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhbHRlcm5hdGl2ZSkge1xuICAgICAgICByZXR1cm4gKGFsdGVybmF0aXZlWzBdID09PSAnLycgJiYgYWx0ZXJuYXRpdmVbYWx0ZXJuYXRpdmUubGVuZ3RoIC0gMV0gPT09ICcvJyk7XG4gICAgICB9KVxuICAgICAgLm1hcChmdW5jdGlvbiAoYWx0ZXJuYXRpdmUpIHtcbiAgICAgICAgY29uc3QgcmVnTmVlZGxlID0gbmV3IFJlZ0V4cChhbHRlcm5hdGl2ZS5zbGljZSgxLCAtMSksIHRoYXQuZ2V0UmVnRXhwTW9kaWZpZXJzKGNhc2VTZW5zaXRpdmUpKTtcbiAgICAgICAgcmV0dXJuIGlucHV0VGVzdC5tYXRjaChyZWdOZWVkbGUpO1xuICAgICAgfSlcbiAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGEuY29uY2F0KGIpO1xuICAgICAgfSwgW10pXG4gICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtICE9PSBudWxsO1xuICAgICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBtb2RpZmllcnMgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbnMuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gY2FzZVNlbnNpdGl2ZSAtIElmIHRydWUsIGFsdGVybmF0aXZlIGlzIGNhc2Ugc2Vuc2l0aXZlLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IE1vZGlmaWVycyBmb3IgcmVndWxhciBleHByZXNzaW9ucy5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRSZWdFeHBNb2RpZmllcnMgPSBmdW5jdGlvbiAoY2FzZVNlbnNpdGl2ZSkge1xuICAgIGNvbnN0IG1vZGlmaWVycyA9IFsnZyddO1xuICAgIGlmICghY2FzZVNlbnNpdGl2ZSkge1xuICAgICAgbW9kaWZpZXJzLnB1c2goJ2knKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW9kaWZpZXJzLmpvaW4oJycpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBNZXJnZSB0aGUgbWF0Y2hlcy5cbiAgICogQHBhcmFtIHsuLi5PYmplY3RbXX0gbWF0Y2hlcyAtIERldGVjdGVkIG1hdGNoZXMuXG4gICAqIEByZXR1cm4ge09iamVjdFtdfSBNZXJnZWQgbWF0Y2hlcy5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5tZXJnZU1hdGNoZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gU2FuaXRpemF0aW9uXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgIHJldHVybiBhcmd1bWVudHNbMF07XG4gICAgfVxuXG4gICAgLy8gQWRkIGFsbCBlbGVtZW50cyBmcm9tIGFyZ3NbMStdIHRvIGFyZ3NbMF0gaWYgbm90IGFscmVhZHkgdGhlcmUgY2xvc2UgYnkuXG4gICAgY29uc3QgcmVzdWx0cyA9IChhcmd1bWVudHNbMF0gfHwgW10pLnNsaWNlKCk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG1hdGNoMiA9IGFyZ3VtZW50c1tpXSB8fCBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbWF0Y2gyLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICghdGhpcy5jb250YWlucyhyZXN1bHRzLCBtYXRjaDJbal0uaW5kZXgpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKG1hdGNoMltqXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEuaW5kZXggPiBiLmluZGV4O1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhbiBhcnJheSBvZiBkZXRlY3RlZCByZXN1bHRzIGNvbnRhaW5zIHRoZSBzYW1lIG1hdGNoIGluIHRoZSB3b3JkJ3MgcHJveGltaXR5LlxuICAgKiBVc2VkIHRvIHByZXZlbnQgZG91YmxlIGVudHJpZXMgdGhhdCBjYW4gYmUgY2F1c2VkIGJ5IGZ1enp5IG1hdGNoaW5nLlxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVzdWx0cyAtIFByZWxpbWluYXJ5IHJlc3VsdHMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZXN1bHRzLm1hdGNoIC0gTWF0Y2ggdGhhdCB3YXMgZm91bmQgYmVmb3JlIGF0IGEgcGFydGljdWxhciBwb3NpdGlvbi5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHJlc3VsdHMuaW5kZXggLSBTdGFydGluZyBwb3NpdGlvbiBvZiB0aGUgbWF0Y2guXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIEluZGV4IG9mIHNvbHV0aW9uIHRvIGJlIGNoZWNrZWQgZm9yIGRvdWJsZSBlbnRyeS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uIChyZXN1bHRzLCBpbmRleCkge1xuICAgIHJldHVybiByZXN1bHRzLnNvbWUoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgcmV0dXJuIE1hdGguYWJzKHJlc3VsdC5pbmRleCAtIGluZGV4KSA8PSByZXN1bHQubWF0Y2gubGVuZ3RoO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBFeHRlbmQgYW4gYXJyYXkganVzdCBsaWtlIEpRdWVyeSdzIGV4dGVuZC5cbiAgICogQHBhcmFtIHsuLi5PYmplY3R9IGFyZ3VtZW50cyAtIE9iamVjdHMgdG8gYmUgbWVyZ2VkLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IE1lcmdlZCBvYmplY3RzLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMuZXh0ZW5kID0gZnVuY3Rpb24gKCkge1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBrZXkgaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYXJndW1lbnRzW2ldLCBrZXkpKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF1ba2V5XSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAgICAgdHlwZW9mIGFyZ3VtZW50c1tpXVtrZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhpcy5leHRlbmQoYXJndW1lbnRzWzBdW2tleV0sIGFyZ3VtZW50c1tpXVtrZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhcmd1bWVudHNbMF1ba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXJndW1lbnRzWzBdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgdGFzayB0aXRsZS5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaXRsZS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgcmF3O1xuICAgIGlmICh0aGlzLmV4dHJhcy5tZXRhZGF0YSkge1xuICAgICAgcmF3ID0gdGhpcy5leHRyYXMubWV0YWRhdGEudGl0bGU7XG4gICAgfVxuICAgIHJhdyA9IHJhdyB8fCBFc3NheVNjb3JlNExNUy5ERUZBVUxUX0RFU0NSSVBUSU9OO1xuXG4gICAgLy8gSDVQIENvcmUgZnVuY3Rpb246IGNyZWF0ZVRpdGxlXG4gICAgcmV0dXJuIEg1UC5jcmVhdGVUaXRsZShyYXcpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBGb3JtYXQgbGFuZ3VhZ2UgdGFnIChSRkMgNTY0NikuIEFzc3VtaW5nIFwibGFuZ3VhZ2UtY291dHJ5XCIuIE5vIHZhbGlkYXRpb24uXG4gICAqIENtcC4gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzU2NDZcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlVGFnIExhbmd1YWdlIHRhZy5cbiAgICogQHJldHVybiB7c3RyaW5nfSBGb3JtYXR0ZWQgbGFuZ3VhZ2UgdGFnLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMuZm9ybWF0TGFuZ3VhZ2VDb2RlID0gZnVuY3Rpb24gKGxhbmd1YWdlQ29kZSkge1xuICAgIGlmICh0eXBlb2YgbGFuZ3VhZ2VDb2RlICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGxhbmd1YWdlQ29kZTtcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIFJGQyA1NjQ2IHN0YXRlcyB0aGF0IGxhbmd1YWdlIHRhZ3MgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dFxuICAgICAqIHJlY29tbWVuZGF0aW9ucyBtYXkgYmUgZm9sbG93ZWQgdG8gaW1wcm92ZSBodW1hbiBpbnRlcnByZXRhdGlvblxuICAgICAqL1xuICAgIGNvbnN0IHNlZ21lbnRzID0gbGFuZ3VhZ2VDb2RlLnNwbGl0KCctJyk7XG4gICAgc2VnbWVudHNbMF0gPSBzZWdtZW50c1swXS50b0xvd2VyQ2FzZSgpOyAvLyBJU08gNjM5IHJlY29tbWVuZGF0aW9uXG4gICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgIHNlZ21lbnRzWzFdID0gc2VnbWVudHNbMV0udG9VcHBlckNhc2UoKTsgLy8gSVNPIDMxNjYtMSByZWNvbW1lbmRhdGlvblxuICAgIH1cbiAgICBsYW5ndWFnZUNvZGUgPSBzZWdtZW50cy5qb2luKCctJyk7XG5cbiAgICByZXR1cm4gbGFuZ3VhZ2VDb2RlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0cnVlIHN0cmluZyBmcm9tIEhUTUwgZW5jb2RlZCBzdHJpbmdcbiAgICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IC0gSW5wdXQgc3RyaW5nLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IE91dHB1dCBzdHJpbmcuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuaHRtbERlY29kZSA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIGNvbnN0IGRwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGlucHV0LCAndGV4dC9odG1sJyk7XG4gICAgcmV0dXJuIGRwYXJzZXIuZG9jdW1lbnRFbGVtZW50LnRleHRDb250ZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBzdGF0ZSBmb3IgSDVQLlF1ZXN0aW9uLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgc3RhdGUuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZ2V0Q3VycmVudFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5pbnB1dEZpZWxkKSB7XG4gICAgICByZXR1cm47IC8vIG1heSBub3QgYmUgYXR0YWNoZWQgdG8gdGhlIERPTSB5ZXRcbiAgICB9XG5cbiAgIC8vIHRoaXMuaW5wdXRGaWVsZC51cGRhdGVNZXNzYWdlU2F2ZWQodGhpcy5wYXJhbXMubWVzc2FnZVNhdmUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlucHV0RmllbGQ6IHRoaXMuaW5wdXRGaWVsZC5nZXRUZXh0KCksXG4gICAgICB2aWV3U3RhdGU6IHRoaXMudmlld1N0YXRlXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogU2V0IHZpZXcgc3RhdGUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdGF0ZSBWaWV3IHN0YXRlLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLnNldFZpZXdTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgIGlmIChFc3NheVNjb3JlNExNUy5WSUVXX1NUQVRFUy5pbmRleE9mKHN0YXRlKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnZpZXdTdGF0ZSA9IHN0YXRlO1xuICB9O1xuXG4gIC8qKiBAY29uc3RhbnQge3N0cmluZ31cbiAgICogbGF0aW4gc3BlY2lhbCBjaGFyczogXFx1MDBDMC1cXHUwMEQ2XFx1MDBEOC1cXHUwMEY2XFx1MDBGOC1cXHUwMEZGXG4gICAqIGdyZWVrIGNoYXJzOiBcXHUwMzcwLVxcdTAzRkZcbiAgICoga3lyaWxsaWMgY2hhcnM6IFxcdTA0MDAtXFx1MDRGRlxuICAgKiBoaXJhZ2FuYSArIGthdGFrYW5hOiBcXHUzMDQwLVxcdTMwRkZcbiAgICogY29tbW9uIENKSyBjaGFyYWN0ZXJzOiBcXHU0RTAwLVxcdTYyRkZcXHU2MzAwLVxcdTc3RkZcXHU3ODAwLVxcdThDRkZcXHU4RDAwLVxcdTlGRkZcbiAgICogdGhhaSBjaGFyczogXFx1MEUwMC1cXHUwRTdGXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5DSEFSU19XSUxEQ0FSRCA9ICdbQS16XFx1MDBDMC1cXHUwMEQ2XFx1MDBEOC1cXHUwMEY2XFx1MDBGOC1cXHUwMEZGXFx1MDM3MC1cXHUwM0ZGXFx1MDQwMC1cXHUwNEZGXFx1MzA0MC1cXHUzMDlGXFx1MzA0MC1cXHUzMEZGXFx1NEUwMC1cXHU2MkZGXFx1NjMwMC1cXHU3N0ZGXFx1NzgwMC1cXHU4Q0ZGXFx1OEQwMC1cXHU5RkZGXFx1MEUwMC1cXHUwRTdGXSc7XG5cbiAgLyoqIEBjb25zdGFudCB7c3RyaW5nfVxuICAgKiBSZXF1aXJlZCB0byBiZSBhZGRlZCB0byB4QVBJIG9iamVjdCBkZXNjcmlwdGlvbiBmb3IgSDVQIHJlcG9ydGluZ1xuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMuRklMTF9JTl9QTEFDRUhPTERFUiA9ICdfX19fX19fX19fJztcblxuICAvKiogQGNvbnN0YW50IHtzdHJpbmd9ICovXG4gIEVzc2F5U2NvcmU0TE1TLkRFRkFVTFRfREVTQ1JJUFRJT04gPSAnRXNzYXlTY29yZTRMTVMnO1xuXG4gIC8qKiBAY29uc3RhbnQge3N0cmluZ30gKi9cbiAgRXNzYXlTY29yZTRMTVMuUkVHVUxBUl9FWFBSRVNTSU9OX0FTVEVSSVNLID0gJzo6Okg1UC1Fc3NheVNjb3JlNExNUy1SRUdFWFAtQVNURVJJU0s6OjonO1xuXG4gIC8qKiBAY29uc3RhbnQge3N0cmluZ1tdfSB2aWV3IHN0YXRlIG5hbWVzKi9cbiAgRXNzYXlTY29yZTRMTVMuVklFV19TVEFURVMgPSBbJ3Rhc2snLCAncmVzdWx0cycsICdzb2x1dGlvbnMnXTtcblxuICByZXR1cm4gRXNzYXlTY29yZTRMTVM7XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBFc3NheVNjb3JlNExNUzsiLCJpbXBvcnQgRXNzYXlTY29yZTRMTVMgZnJvbSBcIi4vZXNzYXlcIlxuXG5INVAgPSBINVAgfHwge307XG5INVAuRXNzYXlTY29yZTRMTVMgPSBFc3NheVNjb3JlNExNUzsiXSwibmFtZXMiOlsiSDVQIiwiRXZlbnREaXNwYXRjaGVyIiwialF1ZXJ5IiwiSm91YmVsVUkiLCJRdWVzdGlvbiIsIkNIQVJfTUVTU0FHRV9JTVBPUlRBTlQiLCJzaHVmZmxlQXJyYXkiLCJBTklNQVRJT05fTUVTU0FHRSIsIkVzc2F5aW5wdXRGaWVsZCIsImNvbnN0cnVjdG9yIiwicGFyYW1zIiwiY2FsbGJhY2tzIiwidGhhdCIsInRoaXMiLCJwcmV2aW91c1N0YXRlIiwib25JbnRlcmFjdGVkIiwidGFza0Rlc2NyaXB0aW9uIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5uZXJIVE1MIiwiaW5wdXRGaWVsZCIsInNldFRleHQiLCJvbGRWYWx1ZSIsImNvbnRhaW5zVGV4dCIsImxlbmd0aCIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZXRUZXh0IiwidXBkYXRlU2NvcmUiLCJjb250ZW50IiwiYXBwZW5kQ2hpbGQiLCJjb250YWluZXIiLCJnZXRJbnRyb2R1Y3Rpb24iLCJnZXRDb250ZW50IiwidmFsdWUiLCJkaXNhYmxlIiwiZGlzYWJsZWQiLCJlbmFibGUiLCJmb2N1cyIsIkFycmF5IiwiaXNBcnJheSIsInVwZGF0ZU1lc3NhZ2VDaGFycyIsInVwZGF0ZU1lc3NhZ2VTYXZlZCIsInNhdmVkIiwic3RhdHVzU2F2ZWQiLCJyZW1vdmUiLCJzZXRNZXNzYWdlQ2hhcnMiLCJtZXNzYWdlIiwiaW1wb3J0YW50Iiwic3RhdHVzQ2hhcnMiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJGRUVEQkFDS19FTVBUWSIsIkVzc2F5U2NvcmU0TE1TIiwiY29uZmlnIiwiY29udGVudElkIiwiY29udGVudERhdGEiLCJjYWxsIiwiZXh0ZW5kIiwibWVkaWEiLCJjaGVja0Fuc3dlciIsImV4dHJhcyIsImNvbnNvbGUiLCJsb2ciLCJkZWZhdWx0TGFuZ3VhZ2UiLCJtZXRhZGF0YSIsImxhbmd1YWdlVGFnIiwiZm9ybWF0TGFuZ3VhZ2VDb2RlIiwic2NvcmUiLCJpbnRlcm5hbFNob3dTb2x1dGlvbnNDYWxsIiwiaXNBbnN3ZXJlZCIsIk9iamVjdCIsImtleXMiLCJwcm90b3R5cGUiLCJjcmVhdGUiLCJyZWdpc3RlckRvbUVsZW1lbnRzIiwidHlwZSIsInVuZGVmaW5lZCIsImxpYnJhcnkiLCJzcGxpdCIsImZpbGUiLCJzZXRJbWFnZSIsInBhdGgiLCJkaXNhYmxlSW1hZ2Vab29taW5nIiwiYWx0IiwidGl0bGUiLCJzb3VyY2VzIiwic2V0VmlkZW8iLCJmaWxlcyIsInNldEF1ZGlvIiwiRXNzYXlJbnB1dEZpZWxkIiwiaGFuZGxlSW50ZXJhY3RlZCIsIm9uSW5wdXQiLCJoYW5kbGVJbnB1dCIsInNldFZpZXdTdGF0ZSIsInZpZXdTdGF0ZSIsImV4dGVybmFsRGlzcGF0Y2hlciIsIm9uIiwiaGFuZGxlQ2hlY2tBbnN3ZXIiLCJza2lwWEFQSSIsInNob3dTb2x1dGlvbnMiLCJzZXRDb250ZW50IiwiYWRkQnV0dG9ucyIsImFkZEJ1dHRvbiIsImhhbmRsZUV2YWx1YXRpb24iLCJoaWRlQnV0dG9uIiwiZ2V0SW5wdXQiLCJsaW5lYnJlYWtSZXBsYWNlbWVudCIsInVzZXJUZXh0IiwicmVwbGFjZSIsInRyaWdnZXJYQVBJIiwiZ2V0QW5zd2VyR2l2ZW4iLCJnZXRTY29yZSIsIk1hdGgiLCJyb3VuZCIsInRyaWdnZXIiLCJyZXNldFRhc2siLCJzZXRFeHBsYW5hdGlvbiIsInJlbW92ZUZlZWRiYWNrIiwiaGlkZVNvbHV0aW9uIiwiZ2V0WEFQSURhdGEiLCJzdGF0ZW1lbnQiLCJnZXRYQVBJQW5zd2VyRXZlbnQiLCJkYXRhIiwiaXNQYXNzZWQiLCJyZXN1bHRzIiwiY29tcHV0ZVJlc3VsdHMiLCJidWlsZEV4cGxhbmF0aW9uIiwiaGFuZGxlWEFQSSIsImJ1aWxkU29sdXRpb24iLCJzb2x1dGlvbiIsInNvbHV0aW9uQW5ub3VuY2VyIiwiZXZlbnQiLCJ0YXJnZXQiLCJibHVyIiwic29sdXRpb25TYW1wbGUiLCJTT0xVVElPTl9TQU1QTEUiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJjb21wdXRlU2NvcmUiLCJleHBsYW5hdGlvbnMiLCJzb3J0IiwiYSIsImIiLCJjb3JyZWN0IiwiaGFuZGxlQnV0dG9ucyIsImNyZWF0ZUVzc2F5WEFQSUV2ZW50IiwidmVyYiIsInhBUElFdmVudCIsImNyZWF0ZVhBUElFdmVudFRlbXBsYXRlIiwiZ2V0VmVyaWZpZWRTdGF0ZW1lbnRWYWx1ZSIsImdldHhBUElEZWZpbml0aW9uIiwiZGVmaW5pdGlvbiIsIm5hbWUiLCJnZXRUaXRsZSIsImRlc2NyaXB0aW9uIiwiRklMTF9JTl9QTEFDRUhPTERFUiIsImludGVyYWN0aW9uVHlwZSIsInNldFNjb3JlZFJlc3VsdCIsInJlc3VsdCIsInJlc3BvbnNlIiwiZGV0ZWN0RXhhY3RNYXRjaGVzIiwibmVlZGxlIiwiaGF5c3RhY2siLCJwb3MiLCJmcm9udCIsIlJlZ0V4cCIsIlJFR1VMQVJfRVhQUkVTU0lPTl9BU1RFUklTSyIsImluZGV4T2YiLCJUZXh0VXRpbGl0aWVzIiwiaXNJc29sYXRlZCIsInB1c2giLCJzdWJzdHIiLCJkZXRlY3RXaWxkY2FyZE1hdGNoZXMiLCJjYXNlU2Vuc2l0aXZlIiwiZm9yRWFjaCIsImNoYXIiLCJqb2luIiwicmVnZXhwIiwiQ0hBUlNfV0lMRENBUkQiLCJnZXRSZWdFeHBNb2RpZmllcnMiLCJtYXRjaCIsImV4ZWMiLCJpbmRleCIsImRldGVjdEZ1enp5TWF0Y2hlcyIsInNpemUiLCJzdHJhdyIsImFyZVNpbWlsYXIiLCJjb250YWlucyIsImdldFJlZ0V4cEFsdGVybmF0aXZlcyIsImFsdGVybmF0aXZlcyIsImlucHV0VGVzdCIsImZpbHRlciIsImFsdGVybmF0aXZlIiwibWFwIiwicmVnTmVlZGxlIiwic2xpY2UiLCJyZWR1Y2UiLCJjb25jYXQiLCJpdGVtIiwibW9kaWZpZXJzIiwibWVyZ2VNYXRjaGVzIiwiYXJndW1lbnRzIiwiaSIsIm1hdGNoMiIsImoiLCJzb21lIiwiYWJzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJyYXciLCJERUZBVUxUX0RFU0NSSVBUSU9OIiwiY3JlYXRlVGl0bGUiLCJsYW5ndWFnZUNvZGUiLCJzZWdtZW50cyIsInRvTG93ZXJDYXNlIiwidG9VcHBlckNhc2UiLCJodG1sRGVjb2RlIiwiaW5wdXQiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJkb2N1bWVudEVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImdldEN1cnJlbnRTdGF0ZSIsInN0YXRlIiwiVklFV19TVEFURVMiXSwic291cmNlUm9vdCI6IiJ9