(()=>{var t=t||{};t.EssayScore4LMS=function(e,n){"use strict";const i='<span class="h5p-essay-feedback-empty">...</span>';function s(t,e,i){if(!t)return;n.call(this,"essay"),this.params=s.extend({media:{},taskDescription:"",checkAnswer:"Check"},t),this.contentId=e,this.extras=i,console.log("*****************************hier1");const o=this.extras&&this.extras.metadata&&this.extras.metadata.defaultLanguage||"en";this.languageTag=s.formatLanguageCode(o),this.score=0,this.internalShowSolutionsCall=!1,void 0!==i&&void 0!==i.previousState&&(this.previousState=i.previousState),this.isAnswered=this.previousState&&this.previousState.inputField&&""!==this.previousState.inputField||!1,"object"==typeof this.previousState&&Object.keys(this.previousState).length&&this.updateScore()}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.registerDomElements=function(){const e=this,n=this.params.media?this.params.media.type:void 0;if(n&&n.library){const t=n.library.split(" ")[0];"H5P.Image"===t?n.params.file&&this.setImage(n.params.file.path,{disableImageZooming:this.params.media.disableImageZooming,alt:n.params.alt,title:n.params.title}):"H5P.Video"===t?n.params.sources&&this.setVideo(n):"H5P.Audio"===t&&n.params.files&&this.setAudio(n)}this.inputField=new t.EssayScore4LMS.InputField({taskDescription:this.params.taskDescription,previousState:this.previousState},{onInteracted:function(t){e.handleInteracted(t)},onInput:function(){e.handleInput()}}),this.setViewState(this.previousState&&this.previousState.viewState||"task"),"results"===this.viewState?t.externalDispatcher.on("initialized",(function(){e.handleCheckAnswer({skipXAPI:!0})})):"solutions"===this.viewState&&t.externalDispatcher.on("initialized",(function(){e.handleCheckAnswer({skipXAPI:!0}),e.showSolutions()})),this.content=this.inputField.getContent(),this.setContent(this.content),this.addButtons()},s.prototype.addButtons=function(){const t=this;t.addButton("check-answer",t.params.checkAnswer,(function(){t.handleCheckAnswer()}))},s.prototype.handleCheckAnswer=function(t){const e=this;t=s.extend({skipXAPI:!1},t),e.setViewState("results"),e.inputField.disable(),e.isAnswered=!0,e.handleEvaluation(t),e.hideButton("check-answer")},s.prototype.getInput=function(t){t=t||" ";let e="";return this.inputField?e=this.inputField.getText():this.previousState&&this.previousState.inputField&&(e=this.previousState.inputField),e.replace(/(\r\n|\r|\n)/g,t).replace(/\s\s/g," ")},s.prototype.handleInteracted=function(t){t=t||{},this.isAnswered=this.isAnswered||this.inputField.getText().length>0,this.triggerXAPI("interacted")},s.prototype.getAnswerGiven=function(){return this.isAnswered},s.prototype.getScore=function(){return Math.round(this.score)},s.prototype.showSolutions=function(){this.setViewState("solutions"),this.inputField.disable(),this.hideButton("show-solution"),this.internalShowSolutionsCall||(this.hideButton("check-answer"),this.hideButton("try-again")),this.trigger("resize")},s.prototype.resetTask=function(){this.setViewState("task"),this.setExplanation(),this.removeFeedback(),this.hideSolution(),this.hideButton("show-solution"),this.hideButton("try-again"),this.inputField.enable(),this.inputField.focus(),this.isAnswered=!1},s.prototype.getXAPIData=function(){return{statement:this.getXAPIAnswerEvent().data.statement}},s.prototype.isPassed=function(){return!0},s.prototype.handleEvaluation=function(t){t=s.extend({skipXAPI:!1},t);const e=this.computeResults();this.buildExplanation(e),t.skipXAPI||this.handleXAPI(),this.trigger("resize")},s.prototype.buildSolution=function(){const t=document.createElement("div");t.classList.add("h5p-essay-solution-container"),this.solutionAnnouncer=document.createElement("div"),this.solutionAnnouncer.setAttribute("tabindex","0"),this.solutionAnnouncer.addEventListener("focus",(function(t){t.target.blur(),t.target.setAttribute("tabindex","-1")})),t.appendChild(this.solutionAnnouncer);const e=document.createElement("div");return e.classList.add(SOLUTION_SAMPLE),t.appendChild(e),t},s.prototype.hideSolution=function(){null!==this.solution.parentNode&&this.solution.parentNode.removeChild(this.solution)},s.prototype.computeResults=function(){return[]},s.prototype.computeScore=function(t){return 0},s.prototype.buildExplanation=function(t){const e=[];return e.length>0&&e.sort((function(t,e){return t.correct===i&&e.correct!==i})),e},s.prototype.handleButtons=function(t){},s.prototype.handleXAPI=function(){this.trigger(this.getXAPIAnswerEvent()),this.trigger(this.createEssayXAPIEvent("passed"))},s.prototype.createEssayXAPIEvent=function(t){const e=this.createXAPIEventTemplate(t);return s.extend(e.getVerifiedStatementValue(["object","definition"]),this.getxAPIDefinition()),e},s.prototype.getxAPIDefinition=function(){const t={name:{}};return t.name[this.languageTag]=this.getTitle(),t.name["en-US"]=t.name[this.languageTag],t.description={},t.description[this.languageTag]=this.params.taskDescription+s.FILL_IN_PLACEHOLDER,t.description["en-US"]=t.description[this.languageTag],t.type="http://id.tincanapi.com/activitytype/essay",t.interactionType="long-fill-in",console.log("getxAPIDefinition"),console.log(t),t},s.prototype.getXAPIAnswerEvent=function(){const t=this.createEssayXAPIEvent("answered");return t.setScoredResult(this.getScore(),this.getScore(),this,!0,this.isPassed()),t.data.statement.result.response=this.inputField.getText(),console.log("getXAPIAnswerEvent"),console.log(t),console.log("**************************"),t},s.prototype.detectExactMatches=function(e,n){const i=[];let o=-1,r=0;for(e=e.replace(/\*/,"").replace(new RegExp(s.REGULAR_EXPRESSION_ASTERISK,"g"),"*");-1!==(o=n.indexOf(e))&&""!==e;)t.TextUtilities.isIsolated(e,n)&&i.push({keyword:e,match:e,index:r+o}),r+=o+e.length,n=n.substr(o+e.length);return i},s.prototype.detectWildcardMatches=function(e,n,i){if(-1===e.indexOf("*"))return[];e=e.replace(/[*]{2,}/g,"*"),["\\",".","[","]","?","+","(",")","{","}","|","!","^","-"].forEach((function(t){e=e.split(t).join("\\"+t)}));const o=new RegExp(e.replace(/\*/g,s.CHARS_WILDCARD+"+"),this.getRegExpModifiers(i)),r=[];let a;for(;null!==(a=o.exec(n));)t.TextUtilities.isIsolated(a[0],n,{index:a.index})&&r.push({keyword:e,match:a[0],index:a.index});return r},s.prototype.detectFuzzyMatches=function(e,n){const i=[];for(let s=-2;s<=2;s++)for(let o=0;o<n.length;o++){const r=n.substr(o,e.length+s);t.TextUtilities.areSimilar(e,r)&&t.TextUtilities.isIsolated(r,n,{index:o})&&(this.contains(i,o)||i.push({keyword:e,match:r,index:o}))}return i},s.prototype.getRegExpAlternatives=function(t,e,n){const i=this;return t.filter((function(t){return"/"===t[0]&&"/"===t[t.length-1]})).map((function(t){const s=new RegExp(t.slice(1,-1),i.getRegExpModifiers(n));return e.match(s)})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(t){return null!==t}))},s.prototype.getRegExpModifiers=function(t){const e=["g"];return t||e.push("i"),e.join("")},s.prototype.mergeMatches=function(){if(0===arguments.length)return[];if(1===arguments.length)return arguments[0];const t=(arguments[0]||[]).slice();for(let e=1;e<arguments.length;e++){const n=arguments[e]||[];for(let e=0;e<n.length;e++)this.contains(t,n[e].index)||t.push(n[e])}return t.sort((function(t,e){return t.index>e.index}))},s.prototype.contains=function(t,e){return t.some((function(t){return Math.abs(t.index-e)<=t.match.length}))},s.extend=function(){for(let t=1;t<arguments.length;t++)for(let e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&("object"==typeof arguments[0][e]&&"object"==typeof arguments[t][e]?this.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},s.prototype.getTitle=function(){let e;return this.extras.metadata&&(e=this.extras.metadata.title),e=e||s.DEFAULT_DESCRIPTION,t.createTitle(e)},s.formatLanguageCode=function(t){if("string"!=typeof t)return t;const e=t.split("-");return e[0]=e[0].toLowerCase(),e.length>1&&(e[1]=e[1].toUpperCase()),e.join("-")},s.prototype.htmlDecode=function(t){return(new DOMParser).parseFromString(t,"text/html").documentElement.textContent},s.prototype.getCurrentState=function(){if(this.inputField)return{inputField:this.inputField.getText(),viewState:this.viewState}},s.prototype.setViewState=function(t){-1!==s.VIEW_STATES.indexOf(t)&&(this.viewState=t)},s.CHARS_WILDCARD="[A-zÀ-ÖØ-öø-ÿͰ-ϿЀ-ӿ぀-ゟ぀-ヿ一-拿挀-矿砀-賿贀-鿿฀-๿]",s.FILL_IN_PLACEHOLDER="__________",s.DEFAULT_DESCRIPTION="EssayScore4LMS",s.REGULAR_EXPRESSION_ASTERISK=":::H5P-EssayScore4LMS-REGEXP-ASTERISK:::",s.VIEW_STATES=["task","results","solutions"],s}(t.jQuery,t.Question)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bG1zRXNzYXkvLi9zY3JpcHRzL2Vzc2F5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBINVAgPSBINVAgfHwge307XG5cbi8qKlxuICogVE9ETzogVGhpcyBjb250ZW50IHR5cGUgbmVlZHMgcmVmYWN0b3JpbmcuXG4gKi9cbkg1UC5Fc3NheVNjb3JlNExNUyA9IGZ1bmN0aW9uICgkLCBRdWVzdGlvbikge1xuICAndXNlIHN0cmljdCc7XG4gIFxuICAvLyBDU1MgQ2xhc3Nlc1xuICBjb25zdCBTT0xVVElPTl9DT05UQUlORVIgPSAnaDVwLWVzc2F5LXNvbHV0aW9uLWNvbnRhaW5lcic7XG4gIGNvbnN0IFNPTFVUSU9OX1RJVExFID0gJ2g1cC1lc3NheS1zb2x1dGlvbi10aXRsZSc7XG4gIC8vY29uc3QgU09MVVRJT05fSU5UUk9EVUNUSU9OID0gJ2g1cC1lc3NheS1zb2x1dGlvbi1pbnRyb2R1Y3Rpb24nO1xuIC8vIGNvbnN0IFNPTFVUSU9OX1NBTVBMRSA9ICdoNXAtZXNzYXktc29sdXRpb24tc2FtcGxlJztcbiAgLy9jb25zdCBTT0xVVElPTl9TQU1QTEVfVEVYVCA9ICdoNXAtZXNzYXktc29sdXRpb24tc2FtcGxlLXRleHQnO1xuXG4gIC8vIFRoZSBINVAgZmVlZGJhY2sgcmlnaHQgbm93IG9ubHkgZXhwZWN0cyB0cnVlIChncmVlbikvZmFsc2UgKHJlZCkgZmVlZGJhY2ssIG5vdCBuZXV0cmFsIGZlZWRiYWNrXG4gIGNvbnN0IEZFRURCQUNLX0VNUFRZID0gJzxzcGFuIGNsYXNzPVwiaDVwLWVzc2F5LWZlZWRiYWNrLWVtcHR5XCI+Li4uPC9zcGFuPic7XG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gQ29uZmlnIGZyb20gc2VtYW50aWNzLmpzb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50SWQgLSBDb250ZW50SWQuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbY29udGVudERhdGFdIC0gY29udGVudERhdGEuXG4gICAqL1xuICBmdW5jdGlvbiBFc3NheVNjb3JlNExNUyhjb25maWcsIGNvbnRlbnRJZCwgY29udGVudERhdGEpIHtcbiAgICAvLyBJbml0aWFsaXplXG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbmhlcml0YW5jZVxuICAgIFF1ZXN0aW9uLmNhbGwodGhpcywgJ2Vzc2F5Jyk7XG5cbiAgICAvLyBTYW5pdGl6ZSBkZWZhdWx0c1xuICAgIHRoaXMucGFyYW1zID0gRXNzYXlTY29yZTRMTVMuZXh0ZW5kKFxuICAgICAge1xuICAgICAgICBtZWRpYToge30sXG4gICAgICAgIHRhc2tEZXNjcmlwdGlvbjogJycsXG4gICAgICAgIC8vc29sdXRpb246IHt9LFxuICAgICAgICAvL2tleXdvcmRzOiBbXSxcbiAgICAgICAgLy9vdmVyYWxsRmVlZGJhY2s6IFtdLFxuICAgICAgICAvKmJlaGF2aW91cjoge1xuICAgICAgICAgIG1pbmltdW1MZW5ndGg6IDAsXG4gICAgICAgICAgaW5wdXRGaWVsZFNpemU6IDEwLFxuICAgICAgICAgIGVuYWJsZUNoZWNrQnV0dG9uOiB0cnVlLFxuICAgICAgICAgIGVuYWJsZVJldHJ5OiB0cnVlLFxuICAgICAgICAgIGlnbm9yZVNjb3Jpbmc6IGZhbHNlLFxuICAgICAgICAgIHBvaW50c0hvc3Q6IDFcbiAgICAgICAgfSwqL1xuICAgICAgICBjaGVja0Fuc3dlcjogJ0NoZWNrJ1xuICAgICAgICAvL3N1Ym1pdEFuc3dlcjogJ1N1Ym1pdCdcbiAgICAgICAgLy90cnlBZ2FpbjogJ1JldHJ5J1xuICAgICAgICAvL3Nob3dTb2x1dGlvbjogJ1Nob3cgc29sdXRpb24nXG4gICAgICAgIC8vZmVlZGJhY2tIZWFkZXI6ICdGZWVkYmFjaydcbiAgICAgICAgLy9zb2x1dGlvblRpdGxlOiAnU2FtcGxlIHNvbHV0aW9uJ1xuICAgICAgICAvL3JlbWFpbmluZ0NoYXJzOiAnUmVtYWluaW5nIGNoYXJhY3RlcnM6IEBjaGFycydcbiAgICAgICAgLy9ub3RFbm91Z2hDaGFyczogJ1lvdSBtdXN0IGVudGVyIGF0IGxlYXN0IEBjaGFycyBjaGFyYWN0ZXJzISdcbiAgICAgICAgLy9tZXNzYWdlU2F2ZTogJ3NhdmVkJ1xuICAgICAgICAvL2FyaWFZb3VyUmVzdWx0OiAnWW91IGdvdCBAc2NvcmUgb3V0IG9mIEB0b3RhbCBwb2ludHMnXG4gICAgICAgIC8vYXJpYU5hdmlnYXRlZFRvU29sdXRpb246ICdOYXZpZ2F0ZWQgdG8gbmV3bHkgaW5jbHVkZWQgc2FtcGxlIHNvbHV0aW9uIGFmdGVyIHRleHRhcmVhLidcbiAgICAgICAgLy9hcmlhQ2hlY2s6ICdDaGVjayB0aGUgYW5zd2Vycy4nXG4gICAgICAgIC8vYXJpYVNob3dTb2x1dGlvbjogJ1Nob3cgdGhlIHNvbHV0aW9uLiBZb3Ugd2lsbCBiZSBwcm92aWRlZCB3aXRoIGEgc2FtcGxlIHNvbHV0aW9uLidcbiAgICAgICAvLyBhcmlhUmV0cnk6ICdSZXRyeSB0aGUgdGFzay4gWW91IGNhbiBpbXByb3ZlIHlvdXIgcHJldmlvdXMgYW5zd2VyIGlmIHRoZSBhdXRob3IgYWxsb3dlZCB0aGF0LidcbiAgICAgIH0sXG4gICAgICBjb25maWcpO1xuICAgIHRoaXMuY29udGVudElkID0gY29udGVudElkO1xuICAgIHRoaXMuZXh0cmFzID0gY29udGVudERhdGE7XG4gICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqaGllcjEnKTtcbiAgICBjb25zdCBkZWZhdWx0TGFuZ3VhZ2UgPSAodGhpcy5leHRyYXMgJiYgdGhpcy5leHRyYXMubWV0YWRhdGEpID8gdGhpcy5leHRyYXMubWV0YWRhdGEuZGVmYXVsdExhbmd1YWdlIHx8ICdlbicgOiAnZW4nO1xuICAgIHRoaXMubGFuZ3VhZ2VUYWcgPSBFc3NheVNjb3JlNExNUy5mb3JtYXRMYW5ndWFnZUNvZGUoZGVmYXVsdExhbmd1YWdlKTtcblxuICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgIHRoaXMuaW50ZXJuYWxTaG93U29sdXRpb25zQ2FsbCA9IGZhbHNlO1xuXG4gICAgLy8gU2FuaXRpemUgSFRNTCBlbmNvZGluZ1xuICAgIC8vdGhpcy5wYXJhbXMucGxhY2Vob2xkZXJUZXh0ID0gdGhpcy5odG1sRGVjb2RlKHRoaXMucGFyYW1zLnBsYWNlaG9sZGVyVGV4dCB8fCAnJyk7XG5cbiAgICAvLyBHZXQgcHJldmlvdXMgc3RhdGUgZnJvbSBjb250ZW50IGRhdGFcbiAgICBpZiAodHlwZW9mIGNvbnRlbnREYXRhICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29udGVudERhdGEucHJldmlvdXNTdGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMucHJldmlvdXNTdGF0ZSA9IGNvbnRlbnREYXRhLnByZXZpb3VzU3RhdGU7XG4gICAgfVxuXG4gICAgdGhpcy5pc0Fuc3dlcmVkID0gdGhpcy5wcmV2aW91c1N0YXRlICYmIHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkICYmIHRoaXMucHJldmlvdXNTdGF0ZS5pbnB1dEZpZWxkICE9PSAnJyB8fCBmYWxzZTtcbiAgICAvKlxuICAgICAqIHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVTb2x1dGlvbnNCdXR0b24gYW5kIHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSBhcmUgdXNlZCBieVxuICAgICAqIGNvbnRyYWN0IGF0IHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTh9IGFuZFxuICAgICAqIHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTl9XG4gICAgICovXG4gICAgLy90aGlzLnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlU29sdXRpb25zQnV0dG9uID0gKHR5cGVvZiB0aGlzLnBhcmFtcy5zb2x1dGlvbi5zYW1wbGUgIT09ICd1bmRlZmluZWQnICYmIHRoaXMucGFyYW1zLnNvbHV0aW9uLnNhbXBsZSAhPT0gJycpO1xuICAgIC8vdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5ID0gdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5IHx8IGZhbHNlO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRoYXQgc2hvdWxkIGJlIGVudGVyZWRcbiAgIC8qIHRoaXMucGFyYW1zLmJlaGF2aW91ci5taW5pbXVtTGVuZ3RoID0gdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggfHwgMDtcbiAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heGltdW1MZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggPSBNYXRoLm1pbih0aGlzLnBhcmFtcy5iZWhhdmlvdXIubWluaW11bUxlbmd0aCwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heGltdW1MZW5ndGgpO1xuICAgIH0qL1xuXG4gICAgLy8gbWFwIGZ1bmN0aW9uXG4gICAgY29uc3QgdG9Qb2ludHMgPSBmdW5jdGlvbiAoa2V5d29yZCkge1xuICAgICAgcmV0dXJuIChrZXl3b3JkLmtleXdvcmQgJiYga2V5d29yZC5vcHRpb25zICYmIGtleXdvcmQub3B0aW9ucy5wb2ludHMgfHwgMCkgKiAoa2V5d29yZC5vcHRpb25zLm9jY3VycmVuY2VzIHx8IDEpO1xuICAgIH07XG5cbiAgICAvLyByZWR1Y2UgZnVuY3Rpb25cbiAgICBjb25zdCBzdW0gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgKyBiO1xuICAgIH07XG5cbiAgICAvLyBzY29yZU1heCA9IE1heGltdW0gbnVtYmVyIG9mIHBvaW50cyBhdmFpbGFibGUgYnkgYWxsIGtleXdvcmQgZ3JvdXBzXG4gICAgLypjb25zdCBzY29yZU1heCA9IHRoaXMucGFyYW1zLmtleXdvcmRzXG4gICAgICAubWFwKHRvUG9pbnRzKVxuICAgICAgLnJlZHVjZShzdW0sIDApOyovXG5cbiAgICAvLyBzY29yZU1hc3RlcmluZzogc2NvcmUgaW5kaWNhdGluZyBtYXN0ZXJ5IGFuZCBtYXhpbXVtIG51bWJlciBvbiBwcm9ncmVzcyBiYXIgKGNhbiBiZSA8IHNjb3JlTWF4KVxuICAgIC8qdGhpcy5zY29yZU1hc3RlcmluZyA9IHRoaXMucGFyYW1zLmJlaGF2aW91ci5wZXJjZW50YWdlTWFzdGVyaW5nID09PSB1bmRlZmluZWQgP1xuICAgICAgc2NvcmVNYXggOlxuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnBlcmNlbnRhZ2VNYXN0ZXJpbmcgKiBzY29yZU1heCAvIDEwMDsqL1xuXG4gICAgLy8gc2NvcmVQYXNzaW5nOiBzY29yZSB0byBwYXNzIHRoZSB0YXNrICg8PSBzY29yZU1hc3RlcmluZylcbiAgICAvKnRoaXMuc2NvcmVQYXNzaW5nID0gTWF0aC5taW4oXG4gICAgICB0aGlzLmdldE1heFNjb3JlKCksXG4gICAgICB0aGlzLnBhcmFtcy5iZWhhdmlvdXIucGVyY2VudGFnZVBhc3NpbmcgKiBzY29yZU1heCAvIDEwMCB8fCAwKTsqL1xuXG4gICAgLy90aGlzLnNvbHV0aW9uID0gdGhpcy5idWlsZFNvbHV0aW9uKCk7XG5cbiAgICAvLyBSZS1jcmVhdGUgc2NvcmVcbiAgICBpZiAodHlwZW9mIHRoaXMucHJldmlvdXNTdGF0ZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXModGhpcy5wcmV2aW91c1N0YXRlKS5sZW5ndGgpIHtcbiAgICAgIHRoaXMudXBkYXRlU2NvcmUoKTtcbiAgICB9XG4gIH1cblxuICAvLyBFeHRlbmRzIFF1ZXN0aW9uXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUXVlc3Rpb24ucHJvdG90eXBlKTtcbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRXNzYXlTY29yZTRMTVM7XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIHRoZSBET00gZWxlbWVudHMgd2l0aCBINVAuUXVlc3Rpb24uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUucmVnaXN0ZXJEb21FbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIC8vIFNldCBvcHRpb25hbCBtZWRpYVxuICAgIGNvbnN0IG1lZGlhID0gKHRoaXMucGFyYW1zLm1lZGlhKSA/IHRoaXMucGFyYW1zLm1lZGlhLnR5cGUgOiB1bmRlZmluZWQ7XG4gICAgaWYgKG1lZGlhICYmIG1lZGlhLmxpYnJhcnkpIHtcbiAgICAgIGNvbnN0IHR5cGUgPSBtZWRpYS5saWJyYXJ5LnNwbGl0KCcgJylbMF07XG4gICAgICBpZiAodHlwZSA9PT0gJ0g1UC5JbWFnZScpIHtcbiAgICAgICAgaWYgKG1lZGlhLnBhcmFtcy5maWxlKSB7XG4gICAgICAgICAgdGhpcy5zZXRJbWFnZShtZWRpYS5wYXJhbXMuZmlsZS5wYXRoLCB7XG4gICAgICAgICAgICBkaXNhYmxlSW1hZ2Vab29taW5nOiB0aGlzLnBhcmFtcy5tZWRpYS5kaXNhYmxlSW1hZ2Vab29taW5nLFxuICAgICAgICAgICAgYWx0OiBtZWRpYS5wYXJhbXMuYWx0LFxuICAgICAgICAgICAgdGl0bGU6IG1lZGlhLnBhcmFtcy50aXRsZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0eXBlID09PSAnSDVQLlZpZGVvJykge1xuICAgICAgICBpZiAobWVkaWEucGFyYW1zLnNvdXJjZXMpIHtcbiAgICAgICAgICB0aGlzLnNldFZpZGVvKG1lZGlhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ0g1UC5BdWRpbycpIHtcbiAgICAgICAgaWYgKG1lZGlhLnBhcmFtcy5maWxlcykge1xuICAgICAgICAgIHRoaXMuc2V0QXVkaW8obWVkaWEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgd2hldGhlciBzdGF0dXMgYmFyIGlzIG5lZWRlZFxuICAgIC8qY29uc3Qgc3RhdHVzQmFyID0gKFxuICAgICAgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGggfHxcbiAgICAgIHRoaXMucGFyYW1zLmJlaGF2aW91ci5tYXhpbXVtTGVuZ3RoIHx8XG4gICAgICAoSDVQSW50ZWdyYXRpb24gJiYgSDVQSW50ZWdyYXRpb24uc2F2ZUZyZXEpXG4gICAgKTsqL1xuXG4gICAgLy8gQ3JlYXRlIElucHV0RmllbGRcbiAgICB0aGlzLmlucHV0RmllbGQgPSBuZXcgSDVQLkVzc2F5U2NvcmU0TE1TLklucHV0RmllbGQoe1xuICAgICAgdGFza0Rlc2NyaXB0aW9uOiB0aGlzLnBhcmFtcy50YXNrRGVzY3JpcHRpb24sXG4gICAgICAvL3BsYWNlaG9sZGVyVGV4dDogdGhpcy5wYXJhbXMucGxhY2Vob2xkZXJUZXh0LFxuICAgICAgLy9tYXhpbXVtTGVuZ3RoOiB0aGlzLnBhcmFtcy5iZWhhdmlvdXIubWF4aW11bUxlbmd0aCxcbiAgICAgIC8vcmVtYWluaW5nQ2hhcnM6IHRoaXMucGFyYW1zLnJlbWFpbmluZ0NoYXJzLFxuICAgICAvLyBpbnB1dEZpZWxkU2l6ZTogdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmlucHV0RmllbGRTaXplLFxuICAgICAgcHJldmlvdXNTdGF0ZTogdGhpcy5wcmV2aW91c1N0YXRlXG4gICAgICAvL3N0YXR1c0Jhcjogc3RhdHVzQmFyXG4gICAgfSwge1xuICAgICAgb25JbnRlcmFjdGVkOiAoZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB0aGF0LmhhbmRsZUludGVyYWN0ZWQocGFyYW1zKTtcbiAgICAgIH0pLFxuICAgICAgb25JbnB1dDogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhhdC5oYW5kbGVJbnB1dCgpO1xuICAgICAgfSlcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0Vmlld1N0YXRlKHRoaXMucHJldmlvdXNTdGF0ZSAmJiB0aGlzLnByZXZpb3VzU3RhdGUudmlld1N0YXRlIHx8ICd0YXNrJyk7XG4gICAgaWYgKHRoaXMudmlld1N0YXRlID09PSAncmVzdWx0cycpIHtcbiAgICAgIC8vIE5lZWQgdG8gd2FpdCB1bnRpbCBET00gaXMgcmVhZHkgZm9yIHVzXG4gICAgICBINVAuZXh0ZXJuYWxEaXNwYXRjaGVyLm9uKCdpbml0aWFsaXplZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhhdC5oYW5kbGVDaGVja0Fuc3dlcih7IHNraXBYQVBJOiB0cnVlIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMudmlld1N0YXRlID09PSAnc29sdXRpb25zJykge1xuICAgICAgLy8gTmVlZCB0byB3YWl0IHVudGlsIERPTSBpcyByZWFkeSBmb3IgdXNcbiAgICAgIEg1UC5leHRlcm5hbERpc3BhdGNoZXIub24oJ2luaXRpYWxpemVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGF0LmhhbmRsZUNoZWNrQW5zd2VyKHsgc2tpcFhBUEk6IHRydWUgfSk7XG4gICAgICAgIHRoYXQuc2hvd1NvbHV0aW9ucygpO1xuICAgICAgICAvLyBXZSBuZWVkIHRoZSByZXRyeSBidXR0b24gaWYgdGhlIG1hc3RlcmluZyBzY29yZSBoYXMgbm90IGJlZW4gcmVhY2hlZCBvciBzY29yaW5nIGlzIGlycmVsZXZhbnRcbiAgICAgICAvKiBpZiAodGhhdC5nZXRTY29yZSgpIDwgdGhhdC5nZXRNYXhTY29yZSgpIHx8IHRoYXQucGFyYW1zLmJlaGF2aW91ci5pZ25vcmVTY29yaW5nIHx8IHRoYXQuZ2V0TWF4U2NvcmUoKSA9PT0gMCkge1xuICAgICAgICAgIGlmICh0aGF0LnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlUmV0cnkpIHtcbiAgICAgICAgICAgIHRoYXQuc2hvd0J1dHRvbigndHJ5LWFnYWluJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoYXQuaGlkZUJ1dHRvbigndHJ5LWFnYWluJyk7XG4gICAgICAgIH0qL1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVnaXN0ZXIgdGFzayBpbnRyb2R1Y3Rpb24gdGV4dFxuICAgIC8vdGhpcy5zZXRJbnRyb2R1Y3Rpb24odGhpcy5pbnB1dEZpZWxkLmdldEludHJvZHVjdGlvbigpKTtcblxuICAgIC8vIFJlZ2lzdGVyIGNvbnRlbnRcbiAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmlucHV0RmllbGQuZ2V0Q29udGVudCgpO1xuICAgIHRoaXMuc2V0Q29udGVudCh0aGlzLmNvbnRlbnQpO1xuXG4gICAgLy8gUmVnaXN0ZXIgQnV0dG9uc1xuICAgIHRoaXMuYWRkQnV0dG9ucygpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBBZGQgYWxsIHRoZSBidXR0b25zIHRoYXQgc2hhbGwgYmUgcGFzc2VkIHRvIEg1UC5RdWVzdGlvbi5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5hZGRCdXR0b25zID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuXG4gICAgLy8gU2hvdyBzb2x1dGlvbiBidXR0b25cbiAgICAvKnRoYXQuYWRkQnV0dG9uKCdzaG93LXNvbHV0aW9uJywgdGhhdC5wYXJhbXMuc2hvd1NvbHV0aW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBOb3QgdXNpbmcgYSBwYXJhbWV0ZXIgZm9yIHNob3dTb2x1dGlvbnMgdG8gbm90IG1lc3Mgd2l0aCBwb3NzaWJlIGZ1dHVyZSBjb250cmFjdCBjaGFuZ2VzXG4gICAgICB0aGF0LmludGVybmFsU2hvd1NvbHV0aW9uc0NhbGwgPSB0cnVlO1xuICAgICAgdGhhdC5zaG93U29sdXRpb25zKCk7XG4gICAgICB0aGF0LmludGVybmFsU2hvd1NvbHV0aW9uc0NhbGwgPSBmYWxzZTtcbiAgICB9LCBmYWxzZSwge1xuICAgICAgJ2FyaWEtbGFiZWwnOiB0aGlzLnBhcmFtcy5hcmlhU2hvd1NvbHV0aW9uXG4gICAgfSwge30pOyovXG5cbiAgICAvLyBDaGVjayBhbnN3ZXIgYnV0dG9uXG4gICAgdGhhdC5hZGRCdXR0b24oJ2NoZWNrLWFuc3dlcicsIHRoYXQucGFyYW1zLmNoZWNrQW5zd2VyLCBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGF0LmhhbmRsZUNoZWNrQW5zd2VyKCk7XG4gICAgfSBcbiAgIC8qIHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVDaGVja0J1dHRvbiwge1xuICAgICAgJ2FyaWEtbGFiZWwnOiB0aGlzLnBhcmFtcy5hcmlhQ2hlY2tcbiAgICB9LCAqL1xuICAgLyoge1xuICAgICAgY29udGVudERhdGE6IHRoaXMuZXh0cmFzLFxuICAgICAgdGV4dElmU3VibWl0dGluZzogdGhpcy5wYXJhbXMuc3VibWl0QW5zd2VyLFxuICAgIH0qL1xuICAgICk7XG5cbiAgICAvLyBSZXRyeSBidXR0b25cbiAgICAvKnRoYXQuYWRkQnV0dG9uKCd0cnktYWdhaW4nLCB0aGF0LnBhcmFtcy50cnlBZ2FpbiwgZnVuY3Rpb24gKCkge1xuICAgICAgdGhhdC5yZXNldFRhc2soKTtcbiAgICB9LCBmYWxzZSwge1xuICAgICAgJ2FyaWEtbGFiZWwnOiB0aGlzLnBhcmFtcy5hcmlhUmV0cnlcbiAgICB9LCB7fSk7Ki9cbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBldmFsdWF0aW9uLlxuICAgKiBAcGFyYW0ge29iamVjdH0gW3BhcmFtcyA9IHt9XSBQYXJhbWV0ZXJzLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtwYXJhbXMuc2tpcFhBUEkgPSBmYWxzZV0gSWYgdHJ1ZSwgZG9uJ3QgdHJpZ2dlciB4QVBJLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmhhbmRsZUNoZWNrQW5zd2VyID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuXG4gICAgcGFyYW1zID0gRXNzYXlTY29yZTRMTVMuZXh0ZW5kKHtcbiAgICAgIHNraXBYQVBJOiBmYWxzZVxuICAgIH0sIHBhcmFtcyk7XG5cbiAgICAvLyBTaG93IG1lc3NhZ2UgaWYgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgaGFzIG5vdCBiZWVuIG1ldFxuICAgIC8qaWYgKHRoYXQuaW5wdXRGaWVsZC5nZXRUZXh0KCkubGVuZ3RoIDwgdGhhdC5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGgpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGF0LnBhcmFtcy5ub3RFbm91Z2hDaGFycy5yZXBsYWNlKC9AY2hhcnMvZywgdGhhdC5wYXJhbXMuYmVoYXZpb3VyLm1pbmltdW1MZW5ndGgpO1xuICAgICAgdGhhdC5pbnB1dEZpZWxkLnNldE1lc3NhZ2VDaGFycyhtZXNzYWdlLCB0cnVlKTtcbiAgICAgIHRoYXQucmVhZChtZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9Ki9cblxuICAgIHRoYXQuc2V0Vmlld1N0YXRlKCdyZXN1bHRzJyk7XG5cbiAgICB0aGF0LmlucHV0RmllbGQuZGlzYWJsZSgpO1xuICAgIC8qXG4gICAgICogT25seSBzZXQgdHJ1ZSBvbiBcImNoZWNrXCIuIFJlc3VsdCBjb21wdXRhdGlvbiBtYXkgdGFrZSBzb21lIHRpbWUgaWZcbiAgICAgKiB0aGVyZSBhcmUgbWFueSBrZXl3b3JkcyBkdWUgdG8gdGhlIGZ1enp5IG1hdGNoIGNoZWNraW5nLCBzbyBpdCdzIG5vdFxuICAgICAqIGEgZ29vZCBpZGVhIHRvIGRvIHRoaXMgd2hpbGUgdHlwaW5nLlxuICAgICAqL1xuICAgIHRoYXQuaXNBbnN3ZXJlZCA9IHRydWU7XG4gICAgdGhhdC5oYW5kbGVFdmFsdWF0aW9uKHBhcmFtcyk7XG5cbiAgIC8qIGlmICh0aGF0LnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlU29sdXRpb25zQnV0dG9uID09PSB0cnVlKSB7XG4gICAgICB0aGF0LnNob3dCdXR0b24oJ3Nob3ctc29sdXRpb24nKTtcbiAgICB9Ki9cbiAgICB0aGF0LmhpZGVCdXR0b24oJ2NoZWNrLWFuc3dlcicpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHVzZXIgaW5wdXQgZnJvbSBET00uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbbGluZWJyZWFrUmVwbGFjZW1lbnQ9JyAnXSBSZXBsYWNlbWVudCBmb3IgbGluZSBicmVha3MuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ2xlYW5lZCBpbnB1dC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRJbnB1dCA9IGZ1bmN0aW9uIChsaW5lYnJlYWtSZXBsYWNlbWVudCkge1xuICAgIGxpbmVicmVha1JlcGxhY2VtZW50ID0gbGluZWJyZWFrUmVwbGFjZW1lbnQgfHwgJyAnO1xuXG4gICAgbGV0IHVzZXJUZXh0ID0gJyc7XG4gICAgaWYgKHRoaXMuaW5wdXRGaWVsZCkge1xuICAgICAgdXNlclRleHQgPSB0aGlzLmlucHV0RmllbGQuZ2V0VGV4dCgpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLnByZXZpb3VzU3RhdGUgJiYgdGhpcy5wcmV2aW91c1N0YXRlLmlucHV0RmllbGQpIHtcbiAgICAgIHVzZXJUZXh0ID0gdGhpcy5wcmV2aW91c1N0YXRlLmlucHV0RmllbGQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVzZXJUZXh0XG4gICAgICAucmVwbGFjZSgvKFxcclxcbnxcXHJ8XFxuKS9nLCBsaW5lYnJlYWtSZXBsYWNlbWVudClcbiAgICAgIC5yZXBsYWNlKC9cXHNcXHMvZywgJyAnKTtcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIHVzZXIgaW50ZXJhY3RlZC5cbiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBQYXJhbWV0ZXJzLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtwYXJhbXMudXBkYXRlU2NvcmVdIElmIHRydWUsIHdpbGwgdHJpZ2dlciBzY29yZSBjb21wdXRhdGlvbi5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oYW5kbGVJbnRlcmFjdGVkID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTtcblxuICAgIC8vIERlbGliZXJhdGVseSBrZWVwaW5nIHRoZSBzdGF0ZSBvbmNlIGFuc3dlcmVkXG4gICAgdGhpcy5pc0Fuc3dlcmVkID0gdGhpcy5pc0Fuc3dlcmVkIHx8IHRoaXMuaW5wdXRGaWVsZC5nZXRUZXh0KCkubGVuZ3RoID4gMDtcbiAgICAvKmlmIChwYXJhbXMudXBkYXRlU2NvcmUpIHtcbiAgICAgIC8vIE9ubHkgdHJpZ2dlcmVkIHdoZW4gZXhwbGljaXRseSByZXF1ZXN0ZWQgZHVlIHRvIHBvdGVudGlhbCBjb21wbGV4aXR5XG4gICAgICB0aGlzLnVwZGF0ZVNjb3JlKCk7XG4gICAgfSovXG5cbiAgICB0aGlzLnRyaWdnZXJYQVBJKCdpbnRlcmFjdGVkJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIEVzc2F5U2NvcmU0TE1TIGhhcyBiZWVuIHN1Ym1pdHRlZC9taW5pbXVtIGxlbmd0aCBtZXQuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUsIGlmIGFuc3dlciB3YXMgZ2l2ZW4uXG4gICAqIEBzZWUgY29udHJhY3QgYXQge0BsaW5rIGh0dHBzOi8vaDVwLm9yZy9kb2N1bWVudGF0aW9uL2RldmVsb3BlcnMvY29udHJhY3RzI2d1aWRlcy1oZWFkZXItMX1cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRBbnN3ZXJHaXZlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5pc0Fuc3dlcmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgbGF0ZXN0IHNjb3JlLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IGxhdGVzdCBzY29yZS5cbiAgICogQHNlZSBjb250cmFjdCBhdCB7QGxpbmsgaHR0cHM6Ly9oNXAub3JnL2RvY3VtZW50YXRpb24vZGV2ZWxvcGVycy9jb250cmFjdHMjZ3VpZGVzLWhlYWRlci0yfVxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldFNjb3JlID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIFJldHVybiB2YWx1ZSBpcyByb3VuZGVkIGJlY2F1c2UgcmVwb3J0aW5nIG1vZHVsZSBmb3IgbW9vZGxlJ3MgSDVQIHBsdWdpbiBleHBlY3RzIGludGVnZXJzXG4gICAgcmV0dXJuICBNYXRoLnJvdW5kKHRoaXMuc2NvcmUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgbWF4aW11bSBwb3NzaWJsZSBzY29yZS5cbiAgICogQHJldHVybiB7bnVtYmVyfSBTY29yZSBuZWNlc3NhcnkgZm9yIG1hc3RlcmluZy5cbiAgICogQHNlZSBjb250cmFjdCBhdCB7QGxpbmsgaHR0cHM6Ly9oNXAub3JnL2RvY3VtZW50YXRpb24vZGV2ZWxvcGVycy9jb250cmFjdHMjZ3VpZGVzLWhlYWRlci0zfVxuICAgKi9cbiAgLypFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuZ2V0TWF4U2NvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gUmV0dXJuIHZhbHVlIGlzIHJvdW5kZWQgYmVjYXVzZSByZXBvcnRpbmcgbW9kdWxlIGZvciBtb29kbGUncyBINVAgcGx1Z2luIGV4cGVjdHMgaW50ZWdlcnNcbiAgICByZXR1cm4gKHRoaXMucGFyYW1zLmJlaGF2aW91ci5pZ25vcmVTY29yaW5nKSA/IHRoaXMucGFyYW1zLmJlaGF2aW91ci5wb2ludHNIb3N0IHx8IDAgOiBNYXRoLnJvdW5kKHRoaXMuc2NvcmVNYXN0ZXJpbmcpO1xuICB9OyovXG5cbiAgLyoqXG4gICAqIFNob3cgc29sdXRpb24uXG4gICAqIEBzZWUgY29udHJhY3QgYXQge0BsaW5rIGh0dHBzOi8vaDVwLm9yZy9kb2N1bWVudGF0aW9uL2RldmVsb3BlcnMvY29udHJhY3RzI2d1aWRlcy1oZWFkZXItNH1cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5zaG93U29sdXRpb25zID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0Vmlld1N0YXRlKCdzb2x1dGlvbnMnKTtcblxuICAgIHRoaXMuaW5wdXRGaWVsZC5kaXNhYmxlKCk7XG5cbiAgICAvKmlmICh0eXBlb2YgdGhpcy5wYXJhbXMuc29sdXRpb24uc2FtcGxlICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLnBhcmFtcy5zb2x1dGlvbi5zYW1wbGUgIT09ICcnKSB7XG4gICAgICAvLyBXZSBhZGQgdGhlIHNhbXBsZSBzb2x1dGlvbiBoZXJlIHRvIG1ha2UgY2hlYXRpbmcgYXQgbGVhc3QgYSBsaXR0bGUgbW9yZSBkaWZmaWN1bHRcbiAgICAgIGlmICh0aGlzLnNvbHV0aW9uLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoU09MVVRJT05fU0FNUExFKVswXS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoU09MVVRJT05fU0FNUExFX1RFWFQpO1xuICAgICAgICB0ZXh0LmlubmVySFRNTCA9IHRoaXMucGFyYW1zLnNvbHV0aW9uLnNhbXBsZTtcbiAgICAgICAgdGhpcy5zb2x1dGlvbi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFNPTFVUSU9OX1NBTVBMRSlbMF0uYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluc2VydCBzb2x1dGlvbiBhZnRlciBleHBsYW5hdGlvbnMgb3IgY29udGVudC5cbiAgICAgIGNvbnN0IHByZWRlY2Vzc29yID0gdGhpcy5jb250ZW50LnBhcmVudE5vZGU7XG5cbiAgICAgIHByZWRlY2Vzc29yLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuc29sdXRpb24sIHByZWRlY2Vzc29yLm5leHRTaWJsaW5nKTtcblxuICAgICAgLy8gVXNlZnVsIGZvciBhY2Nlc3NpYmlsaXR5LCBidXQgc2VlbXMgdG8ganVtcCB0byB3cm9uZyBwb3NpdGlvbiBvbiBzb21lIFNhZmFyaSB2ZXJzaW9uc1xuICAgICAgdGhpcy5zb2x1dGlvbkFubm91bmNlci5mb2N1cygpO1xuICAgIH0qL1xuXG4gICAgdGhpcy5oaWRlQnV0dG9uKCdzaG93LXNvbHV0aW9uJyk7XG5cbiAgICAvLyBIYW5kbGUgY2FsbHMgZnJvbSB0aGUgb3V0c2lkZVxuICAgIGlmICghdGhpcy5pbnRlcm5hbFNob3dTb2x1dGlvbnNDYWxsKSB7XG4gICAgICB0aGlzLmhpZGVCdXR0b24oJ2NoZWNrLWFuc3dlcicpO1xuICAgICAgdGhpcy5oaWRlQnV0dG9uKCd0cnktYWdhaW4nKTtcbiAgICB9XG5cbiAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXNldCB0YXNrLlxuICAgKiBAc2VlIGNvbnRyYWN0IGF0IHtAbGluayBodHRwczovL2g1cC5vcmcvZG9jdW1lbnRhdGlvbi9kZXZlbG9wZXJzL2NvbnRyYWN0cyNndWlkZXMtaGVhZGVyLTV9XG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUucmVzZXRUYXNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0Vmlld1N0YXRlKCd0YXNrJyk7XG5cbiAgICB0aGlzLnNldEV4cGxhbmF0aW9uKCk7XG4gICAgdGhpcy5yZW1vdmVGZWVkYmFjaygpO1xuICAgIHRoaXMuaGlkZVNvbHV0aW9uKCk7XG5cbiAgICB0aGlzLmhpZGVCdXR0b24oJ3Nob3ctc29sdXRpb24nKTtcbiAgICB0aGlzLmhpZGVCdXR0b24oJ3RyeS1hZ2FpbicpO1xuXG4gICAgLy8gUXVlc3Rpb25TZXQgY2FuIGNvbnRyb2wgY2hlY2sgYnV0dG9uIGRlc3BpdGUgbm90IGluIFF1ZXN0aW9uIFR5cGUgY29udHJhY3RcbiAgICAvKmlmICh0aGlzLnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlQ2hlY2tCdXR0b24pIHtcbiAgICAgIHRoaXMuc2hvd0J1dHRvbignY2hlY2stYW5zd2VyJyk7XG4gICAgfSovXG5cbiAgICB0aGlzLmlucHV0RmllbGQuZW5hYmxlKCk7XG4gICAgdGhpcy5pbnB1dEZpZWxkLmZvY3VzKCk7XG5cbiAgICB0aGlzLmlzQW5zd2VyZWQgPSBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IHhBUEkgZGF0YS5cbiAgICogQHJldHVybiB7T2JqZWN0fSB4QVBJIHN0YXRlbWVudC5cbiAgICogQHNlZSBjb250cmFjdCBhdCB7QGxpbmsgaHR0cHM6Ly9oNXAub3JnL2RvY3VtZW50YXRpb24vZGV2ZWxvcGVycy9jb250cmFjdHMjZ3VpZGVzLWhlYWRlci02fVxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldFhBUElEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0ZW1lbnQ6IHRoaXMuZ2V0WEFQSUFuc3dlckV2ZW50KCkuZGF0YS5zdGF0ZW1lbnRcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgdGFzayBoYXMgYmVlbiBwYXNzZWQgYnkgdGhlIHVzZXIuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdXNlciBwYXNzZWQgb3IgdGFzayBpcyBub3Qgc2NvcmVkLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmlzUGFzc2VkID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0cnVlOy8vKHRoaXMucGFyYW1zLmJlaGF2aW91ci5pZ25vcmVTY29yaW5nIHx8IHRoaXMuZ2V0U2NvcmUoKSA+PSB0aGlzLnNjb3JlUGFzc2luZyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzY29yZS5cbiAgICogQHBhcmFtIHtvYmplY3R9IHJlc3VsdHMgUmVzdWx0cy5cbiAgICovXG4gLyogRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLnVwZGF0ZVNjb3JlID0gZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICByZXN1bHRzID0gcmVzdWx0cyB8fCB0aGlzLmNvbXB1dGVSZXN1bHRzKCk7XG4gICAgdGhpcy5zY29yZSA9IE1hdGgubWluKHRoaXMuY29tcHV0ZVNjb3JlKHJlc3VsdHMpLCB0aGlzLmdldE1heFNjb3JlKCkpO1xuICB9O1xuKi9cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgZXZhbHVhdGlvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IFtwYXJhbXMgPSB7fV0gUGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtib29sZWFufSBbcGFyYW1zLnNraXBYQVBJID0gZmFsc2VdIElmIHRydWUsIGRvbid0IHRyaWdnZXIgeEFQSS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oYW5kbGVFdmFsdWF0aW9uID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgIHBhcmFtcyA9IEVzc2F5U2NvcmU0TE1TLmV4dGVuZCh7XG4gICAgICBza2lwWEFQSTogZmFsc2VcbiAgICB9LCBwYXJhbXMpO1xuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmNvbXB1dGVSZXN1bHRzKCk7XG5cbiAgICAvLyBCdWlsZCBleHBsYW5hdGlvbnNcbiAgICBjb25zdCBleHBsYW5hdGlvbnMgPSB0aGlzLmJ1aWxkRXhwbGFuYXRpb24ocmVzdWx0cyk7XG5cbiAgICAvLyBTaG93IGV4cGxhbmF0aW9uc1xuICAgIC8qaWYgKGV4cGxhbmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNldEV4cGxhbmF0aW9uKGV4cGxhbmF0aW9ucywgdGhpcy5wYXJhbXMuZmVlZGJhY2tIZWFkZXIpO1xuICAgIH0qL1xuXG4gICAgLy8gTm90IGFsbCBrZXl3b3JkIGdyb3VwcyBtaWdodCBiZSBuZWNlc3NhcnkgZm9yIG1hc3RlcmluZ1xuICAgLy8gdGhpcy51cGRhdGVTY29yZShyZXN1bHRzKTtcbiAgICAvKmNvbnN0IHRleHRTY29yZSA9IEg1UC5RdWVzdGlvblxuICAgICAgLmRldGVybWluZU92ZXJhbGxGZWVkYmFjayh0aGlzLnBhcmFtcy5vdmVyYWxsRmVlZGJhY2ssIHRoaXMuZ2V0U2NvcmUoKSAvIHRoaXMuZ2V0TWF4U2NvcmUoKSlcbiAgICAgIC5yZXBsYWNlKCdAc2NvcmUnLCB0aGlzLmdldFNjb3JlKCkpXG4gICAgICAucmVwbGFjZSgnQHRvdGFsJywgdGhpcy5nZXRNYXhTY29yZSgpKTsqL1xuXG4gICAgLyppZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5pZ25vcmVTY29yaW5nICYmIHRoaXMuZ2V0TWF4U2NvcmUoKSA+IDApIHtcbiAgICAgIGNvbnN0IGFyaWFNZXNzYWdlID0gKHRoaXMucGFyYW1zLmFyaWFZb3VyUmVzdWx0KVxuICAgICAgICAucmVwbGFjZSgnQHNjb3JlJywgJzpudW0nKVxuICAgICAgICAucmVwbGFjZSgnQHRvdGFsJywgJzp0b3RhbCcpO1xuICAgICAgdGhpcy5zZXRGZWVkYmFjayh0ZXh0U2NvcmUsIHRoaXMuZ2V0U2NvcmUoKSwgdGhpcy5nZXRNYXhTY29yZSgpLCBhcmlhTWVzc2FnZSk7XG4gICAgfSovXG5cbiAgICAvLyBTaG93IGFuZCBoaWRlIGJ1dHRvbnMgYXMgbmVjZXNzYXJ5XG4gICAgLy90aGlzLmhhbmRsZUJ1dHRvbnModGhpcy5nZXRTY29yZSgpKTtcblxuICAgIGlmICghcGFyYW1zLnNraXBYQVBJKSB7XG4gICAgICAvLyBUcmlnZ2VyIHhBUEkgc3RhdGVtZW50cyBhcyBuZWNlc3NhcnlcbiAgICAgIHRoaXMuaGFuZGxlWEFQSSgpO1xuICAgIH1cblxuICAgIHRoaXMudHJpZ2dlcigncmVzaXplJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHNvbHV0aW9uIERPTSBvYmplY3QuXG4gICAqIEByZXR1cm4ge09iamVjdH0gRE9NIG9iamVjdC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5idWlsZFNvbHV0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHNvbHV0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc29sdXRpb24uY2xhc3NMaXN0LmFkZChTT0xVVElPTl9DT05UQUlORVIpO1xuXG4gICAgdGhpcy5zb2x1dGlvbkFubm91bmNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuc29sdXRpb25Bbm5vdW5jZXIuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gICAgLy90aGlzLnNvbHV0aW9uQW5ub3VuY2VyLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHRoaXMucGFyYW1zLmFyaWFOYXZpZ2F0ZWRUb1NvbHV0aW9uKTtcbiAgICB0aGlzLnNvbHV0aW9uQW5ub3VuY2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAvLyBKdXN0IHRlbXBvcmFyeSB0YWJiYWJsZSBlbGVtZW50LiBXaWxsIGJlIGFubm91bmNlZCBieSByZWFkc3Bha2VyLlxuICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgIGV2ZW50LnRhcmdldC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgfSk7XG4gICAgc29sdXRpb24uYXBwZW5kQ2hpbGQodGhpcy5zb2x1dGlvbkFubm91bmNlcik7XG5cbiAgICAvKmNvbnN0IHNvbHV0aW9uVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzb2x1dGlvblRpdGxlLmNsYXNzTGlzdC5hZGQoU09MVVRJT05fVElUTEUpO1xuICAgIHNvbHV0aW9uVGl0bGUuaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMuc29sdXRpb25UaXRsZTtcbiAgICBzb2x1dGlvbi5hcHBlbmRDaGlsZChzb2x1dGlvblRpdGxlKTsqL1xuXG4gICAvKiBjb25zdCBzb2x1dGlvbkludHJvZHVjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHNvbHV0aW9uSW50cm9kdWN0aW9uLmNsYXNzTGlzdC5hZGQoU09MVVRJT05fSU5UUk9EVUNUSU9OKTtcbiAgICBzb2x1dGlvbkludHJvZHVjdGlvbi5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy5zb2x1dGlvbi5pbnRyb2R1Y3Rpb247XG4gICAgc29sdXRpb24uYXBwZW5kQ2hpbGQoc29sdXRpb25JbnRyb2R1Y3Rpb24pOyovXG5cbiAgICBjb25zdCBzb2x1dGlvblNhbXBsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHNvbHV0aW9uU2FtcGxlLmNsYXNzTGlzdC5hZGQoU09MVVRJT05fU0FNUExFKTtcbiAgICBzb2x1dGlvbi5hcHBlbmRDaGlsZChzb2x1dGlvblNhbXBsZSk7XG5cbiAgICByZXR1cm4gc29sdXRpb247XG4gIH07XG5cbiAgLyoqXG4gICAqIEhpZGUgdGhlIHNvbHV0aW9uLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmhpZGVTb2x1dGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5zb2x1dGlvbi5wYXJlbnROb2RlICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnNvbHV0aW9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zb2x1dGlvbik7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBDb21wdXRlIHJlc3VsdHMuXG4gICAqIEByZXR1cm4ge09iamVjdFtdfSBSZXN1bHRzOiBbW3tcImtleXdvcmRcIjoga2V5d29yZCwgXCJtYXRjaFwiOiBtYXRjaCwgXCJpbmRleFwiOiBpbmRleH0qXSpdLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmNvbXB1dGVSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcblxuICAgIC8vIFNob3VsZCBub3QgaGFwcGVuLCBidXQganVzdCB0byBiZSBzdXJlIC4uLlxuICAgLy8gdGhpcy5wYXJhbXMua2V5d29yZHMgPSB0aGlzLnBhcmFtcy5rZXl3b3JkcyB8fCBbXTtcblxuICAgIC8vIEZpbHRlciBvdXQga2V5d29yZHMgdGhhdCBoYXZlIG5vdCBiZWVuIHNldC5cbiAgIC8qIHRoaXMucGFyYW1zLmtleXdvcmRzID0gdGhpcy5wYXJhbXMua2V5d29yZHMuZmlsdGVyKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGVsZW1lbnQua2V5d29yZCAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgfSk7Ki9cblxuICAgIC8qdGhpcy5wYXJhbXMua2V5d29yZHMuZm9yRWFjaChmdW5jdGlvbiAoYWx0ZXJuYXRpdmVHcm91cCkge1xuICAgICAgY29uc3QgcmVzdWx0c0dyb3VwID0gW107XG4gICAgICBjb25zdCBvcHRpb25zID0gYWx0ZXJuYXRpdmVHcm91cC5vcHRpb25zO1xuICAgICAgY29uc3QgY2FzZVNlbnNpdGl2ZSA9ICh0aGF0LnBhcmFtcy5iZWhhdmlvdXIub3ZlcnJpZGVDYXNlU2Vuc2l0aXZlICE9PSAnb2ZmJykgJiZcbiAgICAgICAgKHRoYXQucGFyYW1zLmJlaGF2aW91ci5vdmVycmlkZUNhc2VTZW5zaXRpdmUgPT09ICdvbicgfHwgb3B0aW9ucy5jYXNlU2Vuc2l0aXZlKTtcblxuICAgICAgbGV0IGFsdGVybmF0aXZlcyA9IFthbHRlcm5hdGl2ZUdyb3VwLmtleXdvcmQgfHwgW11dXG4gICAgICAgIC5jb25jYXQoYWx0ZXJuYXRpdmVHcm91cC5hbHRlcm5hdGl2ZXMgfHwgW10pXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKGFsdGVybmF0aXZlKSB7XG4gICAgICAgICAgcmV0dXJuIHRoYXQuaHRtbERlY29kZShhbHRlcm5hdGl2ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvXFwqXG4gICAgICAgKiBHZXQgYWxsIG1hdGNoZXMgdG8gcmVndWxhciBleHByZXNzaW9ucyBhbmQgcHJldGVuZCB0aGUgbWF0Y2hlcyB3ZXJlXG4gICAgICAgKiBnaXZlbiBhcyBhbHRlcm5hdGl2ZSBhbnN3ZXJzIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gZGV0ZWN0IHRoZW0uXG4gICAgICAgKiBUaGlzIHJlc3VsdCBjb21wdXRhdGlvbiBtaWdodCBuZWVkIGEgcmV3cml0ZSAuLi5cbiAgICAgICAqXFwvXG4gICAgICBjb25zdCByZWd1bGFyRXhwcmVzc2lvbk1hdGNoZXMgPSB0aGF0XG4gICAgICAgIC5nZXRSZWdFeHBBbHRlcm5hdGl2ZXMoYWx0ZXJuYXRpdmVzLCB0aGF0LmdldElucHV0KCksIGNhc2VTZW5zaXRpdmUpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgLy8gQWxsb3cgdG8gZGlmZmVyZW50aWF0ZSBmcm9tIHdpbGRjYXJkIGFzdGVyaXNrXG4gICAgICAgICAgcmV0dXJuIG1hdGNoID0gbWF0Y2gucmVwbGFjZSgvXFwqXFwvLCBFc3NheVNjb3JlNExNUy5SRUdVTEFSX0VYUFJFU1NJT05fQVNURVJJU0spO1xuICAgICAgICB9KTtcblxuICAgICAgLy8gTm90IGNoYWluZWQsIGJlY2F1c2Ugd2Ugc3RpbGwgbmVlZCB0aGUgb2xkIHZhbHVlIGluc2lkZVxuICAgICAgYWx0ZXJuYXRpdmVzID0gYWx0ZXJuYXRpdmVzXG4gICAgICAgIC8vIG9ubHkgXCJub3JtYWxcIiBhbHRlcm5hdGl2ZXNcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWx0ZXJuYXRpdmUpIHtcbiAgICAgICAgICByZXR1cm4gKGFsdGVybmF0aXZlWzBdICE9PSAnLycgfHwgYWx0ZXJuYXRpdmVbYWx0ZXJuYXRpdmUubGVuZ3RoIC0gMV0gIT09ICcvJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC8vIHJlZ3VsYXIgbWF0Y2hlcyBmb3VuZCBpbiB0ZXh0IGZvciBhbHRlcm5hdGl2ZXNcbiAgICAgICAgLmNvbmNhdChyZWd1bGFyRXhwcmVzc2lvbk1hdGNoZXMpXG4gICAgICAgIC8vIHJlZ3VsYXIgbWF0Y2hlcyBjb3VsZCBtYXRjaCBlbXB0eSBzdHJpbmdcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWx0ZXJuYXRpdmUpIHtcbiAgICAgICAgICByZXR1cm4gYWx0ZXJuYXRpdmUgIT09ICcnO1xuICAgICAgICB9KTtcblxuICAgICAgLy8gRGV0ZWN0IGFsbCBtYXRjaGVzXG4gICAgICBhbHRlcm5hdGl2ZXMuZm9yRWFjaChmdW5jdGlvbiAoYWx0ZXJuYXRpdmUpIHtcbiAgICAgICAgbGV0IGlucHV0VGVzdCA9IHRoYXQuZ2V0SW5wdXQoKTtcblxuICAgICAgICAvLyBDaGVjayBmb3IgY2FzZSBzZW5zaXRpdml0eVxuICAgICAgICBjb25zdCBjYXNlU2Vuc2l0aXZlID0gdGhhdC5wYXJhbXMuYmVoYXZpb3VyLm92ZXJyaWRlQ2FzZVNlbnNpdGl2ZSA9PT0gJ29uJyB8fCBvcHRpb25zLmNhc2VTZW5zaXRpdmU7XG4gICAgICAgIGlmICghY2FzZVNlbnNpdGl2ZSkge1xuICAgICAgICAgIGFsdGVybmF0aXZlID0gYWx0ZXJuYXRpdmUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpbnB1dFRlc3QgPSBpbnB1dFRlc3QudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEJ1aWxkIGFycmF5IG9mIG1hdGNoZXMgZm9yIGVhY2ggdHlwZSBvZiBtYXRjaFxuICAgICAgICBjb25zdCBtYXRjaGVzRXhhY3QgPSB0aGF0LmRldGVjdEV4YWN0TWF0Y2hlcyhhbHRlcm5hdGl2ZSwgaW5wdXRUZXN0KTtcbiAgICAgICAgY29uc3QgbWF0Y2hlc1dpbGRjYXJkID0gYWx0ZXJuYXRpdmUuaW5kZXhPZignKicpICE9PSAtMSA/IHRoYXQuZGV0ZWN0V2lsZGNhcmRNYXRjaGVzKGFsdGVybmF0aXZlLCBpbnB1dFRlc3QsIGNhc2VTZW5zaXRpdmUpIDogW107XG4gICAgICAgIGNvbnN0IG1hdGNoZXNGdXp6eSA9IG9wdGlvbnMuZm9yZ2l2ZU1pc3Rha2VzID8gdGhhdC5kZXRlY3RGdXp6eU1hdGNoZXMoYWx0ZXJuYXRpdmUsIGlucHV0VGVzdCkgOiBbXTtcblxuICAgICAgICAvLyBNZXJnZSBtYXRjaGVzIHdpdGhvdXQgZHVwbGljYXRlc1xuICAgICAgICB0aGF0Lm1lcmdlTWF0Y2hlcyhtYXRjaGVzRXhhY3QsIG1hdGNoZXNXaWxkY2FyZCwgbWF0Y2hlc0Z1enp5KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmVzdWx0c0dyb3VwLnB1c2goaXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXN1bHRzLnB1c2gocmVzdWx0c0dyb3VwKTtcbiAgICB9KTsqL1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb21wdXRlIHRoZSBzY29yZSBmb3IgdGhlIHJlc3VsdHMuXG4gICAqIEBwYXJhbSB7T2JqZWN0W119IHJlc3VsdHMgLSBSZXN1bHRzIGZyb20gdGhlIHRhc2suXG4gICAqIEByZXR1cm4ge251bWJlcn0gU2NvcmUuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuY29tcHV0ZVNjb3JlID0gZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICBsZXQgc2NvcmUgPSAwO1xuICAgLyogdGhpcy5wYXJhbXMua2V5d29yZHMuZm9yRWFjaChmdW5jdGlvbiAoa2V5d29yZCwgaSkge1xuICAgICAgc2NvcmUgKz0gTWF0aC5taW4ocmVzdWx0c1tpXS5sZW5ndGgsIGtleXdvcmQub3B0aW9ucy5vY2N1cnJlbmNlcykgKiBrZXl3b3JkLm9wdGlvbnMucG9pbnRzO1xuICAgIH0pOyovXG4gICAgcmV0dXJuIHNjb3JlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBCdWlsZCB0aGUgZXhwbGFuYXRpb25zIGZvciBINVAuUXVlc3Rpb24uc2V0RXhwbGFuYXRpb24uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSByZXN1bHRzIC0gUmVzdWx0cyBmcm9tIHRoZSB0YXNrLlxuICAgKiBAcmV0dXJuIHtPYmplY3RbXX0gRXhwbGFuYXRpb25zIGZvciBINVAuUXVlc3Rpb24uXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuYnVpbGRFeHBsYW5hdGlvbiA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgY29uc3QgZXhwbGFuYXRpb25zID0gW107XG5cbiAgICBsZXQgd29yZDtcbi8vICAgIHRoaXMucGFyYW1zLmtleXdvcmRzLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQsIGkpIHtcbi8vICAgICAgd29yZCA9IEZFRURCQUNLX0VNUFRZO1xuLy8gICAgICAvLyBLZXl3b3JkIHdhcyBub3QgZm91bmQgYW5kIGZlZWRiYWNrIGlzIHByb3ZpZGVkIGZvciB0aGlzIGNhc2Vcbi8vICAgICAgaWYgKHJlc3VsdHNbaV0ubGVuZ3RoID09PSAwICYmIGtleXdvcmQub3B0aW9ucy5mZWVkYmFja01pc3NlZCkge1xuLy8gICAgICAgIGlmIChrZXl3b3JkLm9wdGlvbnMuZmVlZGJhY2tNaXNzZWRXb3JkID09PSAna2V5d29yZCcpIHtcbi8vICAgICAgICAgIC8vIE1haW4ga2V5d29yZCBkZWZpbmVkXG4vLyAgICAgICAgICB3b3JkID0ga2V5d29yZC5rZXl3b3JkO1xuLy8gICAgICAgIH1cbi8vICAgICAgICBleHBsYW5hdGlvbnMucHVzaCh7Y29ycmVjdDogd29yZCwgdGV4dDoga2V5d29yZC5vcHRpb25zLmZlZWRiYWNrTWlzc2VkfSk7XG4vLyAgICAgIH1cbi8vXG4vLyAgICAgIC8vIEtleXdvcmQgZm91bmQgYW5kIGZlZWRiYWNrIGlzIHByb3ZpZGVkIGZvciB0aGlzIGNhc2Vcbi8vICAgICAgaWYgKHJlc3VsdHNbaV0ubGVuZ3RoID4gMCAmJiBrZXl3b3JkLm9wdGlvbnMuZmVlZGJhY2tJbmNsdWRlZCkge1xuLy8gICAgICAgIC8vIFNldCB3b3JkIGluIGZyb250IG9mIGZlZWRiYWNrXG4vLyAgICAgICAgc3dpdGNoIChrZXl3b3JkLm9wdGlvbnMuZmVlZGJhY2tJbmNsdWRlZFdvcmQpIHtcbi8vICAgICAgICAgIGNhc2UgJ2tleXdvcmQnOlxuLy8gICAgICAgICAgICAvLyBNYWluIGtleXdvcmQgZGVmaW5lZFxuLy8gICAgICAgICAgICB3b3JkID0ga2V5d29yZC5rZXl3b3JkO1xuLy8gICAgICAgICAgICBicmVhaztcbi8vICAgICAgICAgIGNhc2UgJ2FsdGVybmF0aXZlJzpcbi8vICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgdGhhdCB3YXMgZm91bmRcbi8vICAgICAgICAgICAgd29yZCA9IHJlc3VsdHNbaV1bMF0ua2V5d29yZDtcbi8vICAgICAgICAgICAgYnJlYWs7XG4vLyAgICAgICAgICBjYXNlICdhbnN3ZXInOlxuLy8gICAgICAgICAgICAvLyBBbnN3ZXIgbWF0Y2hpbmcgYW4gYWx0ZXJuYXRpdmUgYXQgdGhlIGxlYXJuZXIgdHlwZWQgaXRcbi8vICAgICAgICAgICAgd29yZCA9IHJlc3VsdHNbaV1bMF0ubWF0Y2g7XG4vLyAgICAgICAgICAgIGJyZWFrO1xuLy8gICAgICAgIH1cbi8vICAgICAgICBleHBsYW5hdGlvbnMucHVzaCh7Y29ycmVjdDogd29yZCwgdGV4dDoga2V5d29yZC5vcHRpb25zLmZlZWRiYWNrSW5jbHVkZWR9KTtcbi8vICAgICAgfVxuLy8gICAgfSk7XG5cbiAgICBpZiAoZXhwbGFuYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIFNvcnQgXCJpbmNsdWRlZFwiIGJlZm9yZSBcIm5vdCBpbmNsdWRlZFwiLCBidXQga2VlcCBvcmRlciBvdGhlcndpc2VcbiAgICAgIGV4cGxhbmF0aW9ucy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLmNvcnJlY3QgPT09IEZFRURCQUNLX0VNUFRZICYmIGIuY29ycmVjdCAhPT0gRkVFREJBQ0tfRU1QVFk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cGxhbmF0aW9ucztcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIGJ1dHRvbnMnIHZpc2liaWxpdHkuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzY29yZSAtIFNjb3JlIHRoZSB1c2VyIHJlY2VpdmVkLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmhhbmRsZUJ1dHRvbnMgPSBmdW5jdGlvbiAoc2NvcmUpIHtcbiAgICAvKmlmICh0aGlzLnBhcmFtcy5zb2x1dGlvbi5zYW1wbGUgJiYgIXRoaXMuc29sdXRpb24pIHtcbiAgICAgIHRoaXMuc2hvd0J1dHRvbignc2hvdy1zb2x1dGlvbicpO1xuICAgIH0qL1xuXG4gICAgLy8gV2UgbmVlZCB0aGUgcmV0cnkgYnV0dG9uIGlmIHRoZSBtYXN0ZXJpbmcgc2NvcmUgaGFzIG5vdCBiZWVuIHJlYWNoZWQgb3Igc2NvcmluZyBpcyBpcnJlbGV2YW50XG4gICAgLyppZiAoc2NvcmUgPCB0aGlzLmdldE1heFNjb3JlKCkgfHwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmlnbm9yZVNjb3JpbmcgfHwgdGhpcy5nZXRNYXhTY29yZSgpID09PSAwKSB7XG4gICAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5KSB7XG4gICAgICAgIHRoaXMuc2hvd0J1dHRvbigndHJ5LWFnYWluJyk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5oaWRlQnV0dG9uKCd0cnktYWdhaW4nKTtcbiAgICB9Ki9cbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIHhBUEkgZXZlbnQgdHJpZ2dlcmluZ1xuICAgKiBAcGFyYW0ge251bWJlcn0gc2NvcmUgLSBTY29yZSB0aGUgdXNlciByZWNlaXZlZC5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5oYW5kbGVYQVBJID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudHJpZ2dlcih0aGlzLmdldFhBUElBbnN3ZXJFdmVudCgpKTtcblxuICAgIC8vIEFkZGl0aW9uYWwgeEFQSSB2ZXJicyB0aGF0IG1pZ2h0IGJlIHVzZWZ1bCBmb3IgbWFraW5nIGFuYWx5dGljcyBlYXNpZXJcbiAgICB0aGlzLnRyaWdnZXIodGhpcy5jcmVhdGVFc3NheVhBUElFdmVudCgncGFzc2VkJykpO1xuICAgLyogaWYgKCF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuaWdub3JlU2NvcmluZyAmJiB0aGlzLmdldE1heFNjb3JlKCkgPiAwKSB7XG4gICAgICBpZiAodGhpcy5nZXRTY29yZSgpIDwgdGhpcy5zY29yZVBhc3NpbmcpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKHRoaXMuY3JlYXRlRXNzYXlYQVBJRXZlbnQoJ2ZhaWxlZCcpKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnRyaWdnZXIodGhpcy5jcmVhdGVFc3NheVhBUElFdmVudCgncGFzc2VkJykpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0U2NvcmUoKSA+PSB0aGlzLmdldE1heFNjb3JlKCkpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKHRoaXMuY3JlYXRlRXNzYXlYQVBJRXZlbnQoJ21hc3RlcmVkJykpO1xuICAgICAgfVxuICAgIH0qL1xuICB9O1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4geEFQSSBldmVudCBmb3IgRXNzYXlTY29yZTRMTVMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJiIC0gU2hvcnQgaWQgb2YgdGhlIHZlcmIgd2Ugd2FudCB0byB0cmlnZ2VyLlxuICAgKiBAcmV0dXJuIHtINVAuWEFQSUV2ZW50fSBFdmVudCB0ZW1wbGF0ZS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5jcmVhdGVFc3NheVhBUElFdmVudCA9IGZ1bmN0aW9uICh2ZXJiKSB7XG4gICAgY29uc3QgeEFQSUV2ZW50ID0gdGhpcy5jcmVhdGVYQVBJRXZlbnRUZW1wbGF0ZSh2ZXJiKTtcbiAgICBFc3NheVNjb3JlNExNUy5leHRlbmQoXG4gICAgICB4QVBJRXZlbnQuZ2V0VmVyaWZpZWRTdGF0ZW1lbnRWYWx1ZShbJ29iamVjdCcsICdkZWZpbml0aW9uJ10pLFxuICAgICAgdGhpcy5nZXR4QVBJRGVmaW5pdGlvbigpKTtcbiAgICByZXR1cm4geEFQSUV2ZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHhBUEkgZGVmaW5pdGlvbiBmb3IgdGhlIHhBUEkgb2JqZWN0LlxuICAgKiByZXR1cm4ge09iamVjdH0gWEFQSSBkZWZpbml0aW9uLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldHhBUElEZWZpbml0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGRlZmluaXRpb24gPSB7fTtcbiAgICBkZWZpbml0aW9uLm5hbWUgPSB7fTtcbiAgICBkZWZpbml0aW9uLm5hbWVbdGhpcy5sYW5ndWFnZVRhZ10gPSB0aGlzLmdldFRpdGxlKCk7XG4gICAgLy8gRmFsbGJhY2sgZm9yIGg1cC1waHAtcmVwb3J0aW5nLCBleHBlY3RzIGVuLVVTXG4gICAgZGVmaW5pdGlvbi5uYW1lWydlbi1VUyddID0gZGVmaW5pdGlvbi5uYW1lW3RoaXMubGFuZ3VhZ2VUYWddO1xuICAgIC8vIFRoZSBINVAgcmVwb3J0aW5nIG1vZHVsZSBleHBlY3RzIHRoZSBcImJsYW5rc1wiIHRvIGJlIGFkZGVkIHRvIHRoZSBkZXNjcmlwdGlvblxuICAgIGRlZmluaXRpb24uZGVzY3JpcHRpb24gPSB7fTtcbiAgICBkZWZpbml0aW9uLmRlc2NyaXB0aW9uW3RoaXMubGFuZ3VhZ2VUYWddID0gdGhpcy5wYXJhbXMudGFza0Rlc2NyaXB0aW9uICsgRXNzYXlTY29yZTRMTVMuRklMTF9JTl9QTEFDRUhPTERFUjtcbiAgICAvLyBGYWxsYmFjayBmb3IgaDVwLXBocC1yZXBvcnRpbmcsIGV4cGVjdHMgZW4tVVNcbiAgICBkZWZpbml0aW9uLmRlc2NyaXB0aW9uWydlbi1VUyddID0gZGVmaW5pdGlvbi5kZXNjcmlwdGlvblt0aGlzLmxhbmd1YWdlVGFnXTtcbiAgICBkZWZpbml0aW9uLnR5cGUgPSAnaHR0cDovL2lkLnRpbmNhbmFwaS5jb20vYWN0aXZpdHl0eXBlL2Vzc2F5JztcbiAgICBkZWZpbml0aW9uLmludGVyYWN0aW9uVHlwZSA9ICdsb25nLWZpbGwtaW4nO1xuICAgIC8qXG4gICAgICogVGhlIG9mZmljaWFsIHhBUEkgZG9jdW1lbnRhdGlvbiBkaXNjb3VyYWdlcyB0byB1c2UgYSBjb3JyZWN0IHJlc3BvbnNlXG4gICAgICogcGF0dGVybiBpdCBpZiB0aGUgY3JpdGVyaWEgZm9yIGEgcXVlc3Rpb24gYXJlIGNvbXBsZXggYW5kIGNvcnJlY3RcbiAgICAgKiByZXNwb25zZXMgY2Fubm90IGJlIGV4aGF1c3RpdmVseSBsaXN0ZWQuIFRoZXkgY2FuJ3QuXG4gICAgICovXG4gICAgIGNvbnNvbGUubG9nKCdnZXR4QVBJRGVmaW5pdGlvbicpO1xuICAgICBjb25zb2xlLmxvZyhkZWZpbml0aW9uKTtcbiAgICByZXR1cm4gZGVmaW5pdGlvbjtcbiAgfTtcblxuICAvKipcbiAgICogQnVpbGQgeEFQSSBhbnN3ZXIgZXZlbnQuXG4gICAqIEByZXR1cm4ge0g1UC5YQVBJRXZlbnR9IHhBUEkgYW5zd2VyIGV2ZW50LlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldFhBUElBbnN3ZXJFdmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB4QVBJRXZlbnQgPSB0aGlzLmNyZWF0ZUVzc2F5WEFQSUV2ZW50KCdhbnN3ZXJlZCcpO1xuXG4gICAgeEFQSUV2ZW50LnNldFNjb3JlZFJlc3VsdCh0aGlzLmdldFNjb3JlKCksIHRoaXMuZ2V0U2NvcmUoKSwgdGhpcywgdHJ1ZSwgdGhpcy5pc1Bhc3NlZCgpKTtcbiAgICB4QVBJRXZlbnQuZGF0YS5zdGF0ZW1lbnQucmVzdWx0LnJlc3BvbnNlID0gdGhpcy5pbnB1dEZpZWxkLmdldFRleHQoKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnZ2V0WEFQSUFuc3dlckV2ZW50Jyk7XG4gICAgY29uc29sZS5sb2coeEFQSUV2ZW50KTtcbiAgICBjb25zb2xlLmxvZygnKioqKioqKioqKioqKioqKioqKioqKioqKionKTtcbiAgICByZXR1cm4geEFQSUV2ZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXRlY3QgZXhhY3QgbWF0Y2hlcyBvZiBuZWVkbGUgaW4gaGF5c3RhY2suXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZWVkbGUgLSBXb3JkIG9yIHBocmFzZSB0byBmaW5kLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGF5c3RhY2sgLSBUZXh0IHRvIGZpbmQgdGhlIHdvcmQgb3IgcGhyYXNlIGluLlxuICAgKiBAcmV0dXJuIHtPYmplY3RbXX0gUmVzdWx0czogW3sna2V5d29yZCc6IG5lZWRsZSwgJ21hdGNoJzogbmVlZGxlLCAnaW5kZXgnOiBmcm9udCArIHBvc30qXS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5kZXRlY3RFeGFjdE1hdGNoZXMgPSBmdW5jdGlvbiAobmVlZGxlLCBoYXlzdGFjaykge1xuICAgIC8vIFNpbXBseSBkZXRlY3QgYWxsIGV4YWN0IG1hdGNoZXMgYW5kIGl0cyBwb3NpdGlvbnMgaW4gdGhlIGhheXN0YWNrXG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgbGV0IHBvcyA9IC0xO1xuICAgIGxldCBmcm9udCA9IDA7XG5cbiAgICBuZWVkbGUgPSBuZWVkbGVcbiAgICAgIC5yZXBsYWNlKC9cXCovLCAnJykgLy8gV2lsZGNhcmRzIGNoZWNrZWQgc2VwYXJhdGVseVxuICAgICAgLnJlcGxhY2UobmV3IFJlZ0V4cChFc3NheVNjb3JlNExNUy5SRUdVTEFSX0VYUFJFU1NJT05fQVNURVJJU0ssICdnJyksICcqJyk7IC8vIEFzdGVyaXNrIGZyb20gcmVnZXhwXG5cbiAgICB3aGlsZSAoKChwb3MgPSBoYXlzdGFjay5pbmRleE9mKG5lZWRsZSkpKSAhPT0gLTEgJiYgbmVlZGxlICE9PSAnJykge1xuICAgICAgaWYgKEg1UC5UZXh0VXRpbGl0aWVzLmlzSXNvbGF0ZWQobmVlZGxlLCBoYXlzdGFjaykpIHtcbiAgICAgICAgcmVzdWx0LnB1c2goeydrZXl3b3JkJzogbmVlZGxlLCAnbWF0Y2gnOiBuZWVkbGUsICdpbmRleCc6IGZyb250ICsgcG9zfSk7XG4gICAgICB9XG4gICAgICBmcm9udCArPSBwb3MgKyBuZWVkbGUubGVuZ3RoO1xuICAgICAgaGF5c3RhY2sgPSBoYXlzdGFjay5zdWJzdHIocG9zICsgbmVlZGxlLmxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIERldGVjdCB3aWxkY2FyZCBtYXRjaGVzIG9mIG5lZWRsZSBpbiBoYXlzdGFjay5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG5lZWRsZSAtIFdvcmQgb3IgcGhyYXNlIHRvIGZpbmQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBoYXlzdGFjayAtIFRleHQgdG8gZmluZCB0aGUgd29yZCBvciBwaHJhc2UgaW4uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gY2FzZVNlbnNpdGl2ZSAtIElmIHRydWUsIGFsdGVybmF0aXZlIGlzIGNhc2Ugc2Vuc2l0aXZlLlxuICAgKiBAcmV0dXJuIHtPYmplY3RbXX0gUmVzdWx0czogW3sna2V5d29yZCc6IG5lZWRsZSwgJ21hdGNoJzogbmVlZGxlLCAnaW5kZXgnOiBmcm9udCArIHBvc30qXS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5kZXRlY3RXaWxkY2FyZE1hdGNoZXMgPSBmdW5jdGlvbiAobmVlZGxlLCBoYXlzdGFjaywgY2FzZVNlbnNpdGl2ZSkge1xuICAgIGlmIChuZWVkbGUuaW5kZXhPZignKicpID09PSAtMSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIENsZWFuIG5lZWRsZSBmcm9tIHN1Y2Nlc3NpdmUgd2lsZGNhcmRzXG4gICAgbmVlZGxlID0gbmVlZGxlLnJlcGxhY2UoL1sqXXsyLH0vZywgJyonKTtcblxuICAgIC8vIENsZWFuIG5lZWRsZSBmcm9tIHJlZ3VsYXIgZXhwcmVzc2lvbiBjaGFyYWN0ZXJzLCAqIG5lZWRlZCBmb3Igd2lsZGNhcmRcbiAgICBjb25zdCByZWdleHBDaGFycyA9IFsnXFxcXCcsICcuJywgJ1snLCAnXScsICc/JywgJysnLCAnKCcsICcpJywgJ3snLCAnfScsICd8JywgJyEnLCAnXicsICctJ107XG4gICAgcmVnZXhwQ2hhcnMuZm9yRWFjaChmdW5jdGlvbiAoY2hhcikge1xuICAgICAgbmVlZGxlID0gbmVlZGxlLnNwbGl0KGNoYXIpLmpvaW4oJ1xcXFwnICsgY2hhcik7XG4gICAgfSk7XG5cbiAgICAvLyBXZSBhY2NlcHQgb25seSBjaGFyYWN0ZXJzIGZvciB0aGUgd2lsZGNhcmRcbiAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKG5lZWRsZS5yZXBsYWNlKC9cXCovZywgRXNzYXlTY29yZTRMTVMuQ0hBUlNfV0lMRENBUkQgKyAnKycpLCB0aGlzLmdldFJlZ0V4cE1vZGlmaWVycyhjYXNlU2Vuc2l0aXZlKSk7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgbGV0IG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleHAuZXhlYyhoYXlzdGFjaykpICE9PSBudWxsICkge1xuICAgICAgaWYgKEg1UC5UZXh0VXRpbGl0aWVzLmlzSXNvbGF0ZWQobWF0Y2hbMF0sIGhheXN0YWNrLCB7J2luZGV4JzogbWF0Y2guaW5kZXh9KSkge1xuICAgICAgICByZXN1bHQucHVzaCh7J2tleXdvcmQnOiBuZWVkbGUsICdtYXRjaCc6IG1hdGNoWzBdLCAnaW5kZXgnOiBtYXRjaC5pbmRleH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXRlY3QgZnV6enkgbWF0Y2hlcyBvZiBuZWVkbGUgaW4gaGF5c3RhY2suXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZWVkbGUgLSBXb3JkIG9yIHBocmFzZSB0byBmaW5kLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGF5c3RhY2sgLSBUZXh0IHRvIGZpbmQgdGhlIHdvcmQgb3IgcGhyYXNlIGluLlxuICAgKiBAcGFyYW0ge09iamVjdFtdfSBSZXN1bHRzLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmRldGVjdEZ1enp5TWF0Y2hlcyA9IGZ1bmN0aW9uIChuZWVkbGUsIGhheXN0YWNrKSB7XG4gICAgLy8gSWRlYWxseSwgdGhpcyBzaG91bGQgYmUgdGhlIG1heGltdW0gbnVtYmVyIG9mIGFsbG93ZWQgdHJhbnNmb3JtYXRpb25zIGZvciB0aGUgTGV2ZW5zaHRlaW4gZGlzY3RhbmNlLlxuICAgIGNvbnN0IHdpbmRvd1NpemUgPSAyO1xuICAgIC8qXG4gICAgICogV2UgY2Fubm90IHNpbXBsZSBzcGxpdCB3b3JkcyBiZWNhdXNlIHdlJ3JlIGFsc28gbG9va2luZyBmb3IgcGhyYXNlcy5cbiAgICAgKiBJZiB3ZSB3ZXJlIGp1c3QgbG9va2luZyBmb3IgZXhhY3QgbWF0Y2hlcywgd2UgY291bGQgdXNlIHNvbWV0aGluZyBzbWFydGVyXG4gICAgICogc3VjaCBhcyB0aGUgS01QIGFsZ29yaXRobS4gQmVjYXVzZSB3ZSdyZSBkZWFsaW5nIHdpdGggZnV6enkgbWF0Y2hlcywgdXNpbmdcbiAgICAgKiB0aGlzIGludHVpdGl2ZSBleGhhdXN0aXZlIGFwcHJvYWNoIG1pZ2h0IGJlIHRoZSBiZXN0IHdheSB0byBnby5cbiAgICAgKi9cbiAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgLy8gV2l0aG91dCBsb29raW5nIGF0IHRoZSBzdXJyb3VuZGluZ3Mgd2UnZCBtaXNzIHdvcmRzIHRoYXQgaGF2ZSBhZGRpdGlvbmFsIG9yIG1pc3NpbmcgY2hhcnNcbiAgICBmb3IgKGxldCBzaXplID0gLXdpbmRvd1NpemU7IHNpemUgPD0gd2luZG93U2l6ZTsgc2l6ZSsrKSB7XG4gICAgICBmb3IgKGxldCBwb3MgPSAwOyBwb3MgPCBoYXlzdGFjay5sZW5ndGg7IHBvcysrKSB7XG4gICAgICAgIGNvbnN0IHN0cmF3ID0gaGF5c3RhY2suc3Vic3RyKHBvcywgbmVlZGxlLmxlbmd0aCArIHNpemUpO1xuICAgICAgICBpZiAoSDVQLlRleHRVdGlsaXRpZXMuYXJlU2ltaWxhcihuZWVkbGUsIHN0cmF3KSAmJiBINVAuVGV4dFV0aWxpdGllcy5pc0lzb2xhdGVkKHN0cmF3LCBoYXlzdGFjaywgeydpbmRleCc6IHBvc30pKSB7XG4gICAgICAgICAgLy8gVGhpcyB3aWxsIG9ubHkgYWRkIHRoZSBtYXRjaCBpZiBpdCdzIG5vdCBhIGR1cGxpY2F0ZSB0aGF0IHdlIGZvdW5kIGFscmVhZHkgaW4gdGhlIHByb3hpbWl0eSBvZiBwb3NcbiAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbnMocmVzdWx0cywgcG9zKSkge1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsna2V5d29yZCc6IG5lZWRsZSwgJ21hdGNoJzogc3RyYXcsICdpbmRleCc6IHBvc30pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICAvKipcbiAgICogR2V0IGFsbCB0aGUgbWF0Y2hlcyBmb3VuZCB0byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBhbHRlcm5hdGl2ZS5cbiAgICogQHBhcmFtIHtzdHJpbmdbXX0gYWx0ZXJuYXRpdmVzIC0gQWx0ZXJuYXRpdmVzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaW5wdXRUZXN0IC0gT3JpZ2luYWwgdGV4dCBieSBzdHVkZW50LlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNhc2VTZW5zaXRpdmUgLSBJZiB0cnVlLCBhbHRlcm5hdGl2ZSBpcyBjYXNlIHNlbnNpdGl2ZS5cbiAgICogQHJldHVybiB7c3RyaW5nW119IE1hdGNoZXMgYnkgcmVndWxhciBleHByZXNzaW9ucy5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRSZWdFeHBBbHRlcm5hdGl2ZXMgPSBmdW5jdGlvbiAoYWx0ZXJuYXRpdmVzLCBpbnB1dFRlc3QsIGNhc2VTZW5zaXRpdmUpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIHJldHVybiBhbHRlcm5hdGl2ZXNcbiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFsdGVybmF0aXZlKSB7XG4gICAgICAgIHJldHVybiAoYWx0ZXJuYXRpdmVbMF0gPT09ICcvJyAmJiBhbHRlcm5hdGl2ZVthbHRlcm5hdGl2ZS5sZW5ndGggLSAxXSA9PT0gJy8nKTtcbiAgICAgIH0pXG4gICAgICAubWFwKGZ1bmN0aW9uIChhbHRlcm5hdGl2ZSkge1xuICAgICAgICBjb25zdCByZWdOZWVkbGUgPSBuZXcgUmVnRXhwKGFsdGVybmF0aXZlLnNsaWNlKDEsIC0xKSwgdGhhdC5nZXRSZWdFeHBNb2RpZmllcnMoY2FzZVNlbnNpdGl2ZSkpO1xuICAgICAgICByZXR1cm4gaW5wdXRUZXN0Lm1hdGNoKHJlZ05lZWRsZSk7XG4gICAgICB9KVxuICAgICAgLnJlZHVjZShmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYS5jb25jYXQoYik7XG4gICAgICB9LCBbXSlcbiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0gIT09IG51bGw7XG4gICAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IG1vZGlmaWVycyBmb3IgcmVndWxhciBleHByZXNzaW9ucy5cbiAgICogQHBhcmFtIHtib29sZWFufSBjYXNlU2Vuc2l0aXZlIC0gSWYgdHJ1ZSwgYWx0ZXJuYXRpdmUgaXMgY2FzZSBzZW5zaXRpdmUuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gTW9kaWZpZXJzIGZvciByZWd1bGFyIGV4cHJlc3Npb25zLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldFJlZ0V4cE1vZGlmaWVycyA9IGZ1bmN0aW9uIChjYXNlU2Vuc2l0aXZlKSB7XG4gICAgY29uc3QgbW9kaWZpZXJzID0gWydnJ107XG4gICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7XG4gICAgICBtb2RpZmllcnMucHVzaCgnaScpO1xuICAgIH1cblxuICAgIHJldHVybiBtb2RpZmllcnMuam9pbignJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIE1lcmdlIHRoZSBtYXRjaGVzLlxuICAgKiBAcGFyYW0gey4uLk9iamVjdFtdfSBtYXRjaGVzIC0gRGV0ZWN0ZWQgbWF0Y2hlcy5cbiAgICogQHJldHVybiB7T2JqZWN0W119IE1lcmdlZCBtYXRjaGVzLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLm1lcmdlTWF0Y2hlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBTYW5pdGl6YXRpb25cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgcmV0dXJuIGFyZ3VtZW50c1swXTtcbiAgICB9XG5cbiAgICAvLyBBZGQgYWxsIGVsZW1lbnRzIGZyb20gYXJnc1sxK10gdG8gYXJnc1swXSBpZiBub3QgYWxyZWFkeSB0aGVyZSBjbG9zZSBieS5cbiAgICBjb25zdCByZXN1bHRzID0gKGFyZ3VtZW50c1swXSB8fCBbXSkuc2xpY2UoKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbWF0Y2gyID0gYXJndW1lbnRzW2ldIHx8IFtdO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtYXRjaDIubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5zKHJlc3VsdHMsIG1hdGNoMltqXS5pbmRleCkpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2gobWF0Y2gyW2pdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYS5pbmRleCA+IGIuaW5kZXg7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGFuIGFycmF5IG9mIGRldGVjdGVkIHJlc3VsdHMgY29udGFpbnMgdGhlIHNhbWUgbWF0Y2ggaW4gdGhlIHdvcmQncyBwcm94aW1pdHkuXG4gICAqIFVzZWQgdG8gcHJldmVudCBkb3VibGUgZW50cmllcyB0aGF0IGNhbiBiZSBjYXVzZWQgYnkgZnV6enkgbWF0Y2hpbmcuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSByZXN1bHRzIC0gUHJlbGltaW5hcnkgcmVzdWx0cy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlc3VsdHMubWF0Y2ggLSBNYXRjaCB0aGF0IHdhcyBmb3VuZCBiZWZvcmUgYXQgYSBwYXJ0aWN1bGFyIHBvc2l0aW9uLlxuICAgKiBAcGFyYW0ge251bWJlcn0gcmVzdWx0cy5pbmRleCAtIFN0YXJ0aW5nIHBvc2l0aW9uIG9mIHRoZSBtYXRjaC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gSW5kZXggb2Ygc29sdXRpb24gdG8gYmUgY2hlY2tlZCBmb3IgZG91YmxlIGVudHJ5LlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gKHJlc3VsdHMsIGluZGV4KSB7XG4gICAgcmV0dXJuIHJlc3VsdHMuc29tZShmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICByZXR1cm4gTWF0aC5hYnMocmVzdWx0LmluZGV4IC0gaW5kZXgpIDw9IHJlc3VsdC5tYXRjaC5sZW5ndGg7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEV4dGVuZCBhbiBhcnJheSBqdXN0IGxpa2UgSlF1ZXJ5J3MgZXh0ZW5kLlxuICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJndW1lbnRzIC0gT2JqZWN0cyB0byBiZSBtZXJnZWQuXG4gICAqIEByZXR1cm4ge09iamVjdH0gTWVyZ2VkIG9iamVjdHMuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5leHRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGtleSBpbiBhcmd1bWVudHNbaV0pIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhcmd1bWVudHNbaV0sIGtleSkpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGFyZ3VtZW50c1swXVtrZXldID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgICB0eXBlb2YgYXJndW1lbnRzW2ldW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aGlzLmV4dGVuZChhcmd1bWVudHNbMF1ba2V5XSwgYXJndW1lbnRzW2ldW2tleV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFyZ3VtZW50c1swXVtrZXldID0gYXJndW1lbnRzW2ldW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcmd1bWVudHNbMF07XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCB0YXNrIHRpdGxlLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRpdGxlLlxuICAgKi9cbiAgRXNzYXlTY29yZTRMTVMucHJvdG90eXBlLmdldFRpdGxlID0gZnVuY3Rpb24gKCkge1xuICAgIGxldCByYXc7XG4gICAgaWYgKHRoaXMuZXh0cmFzLm1ldGFkYXRhKSB7XG4gICAgICByYXcgPSB0aGlzLmV4dHJhcy5tZXRhZGF0YS50aXRsZTtcbiAgICB9XG4gICAgcmF3ID0gcmF3IHx8IEVzc2F5U2NvcmU0TE1TLkRFRkFVTFRfREVTQ1JJUFRJT047XG5cbiAgICAvLyBINVAgQ29yZSBmdW5jdGlvbjogY3JlYXRlVGl0bGVcbiAgICByZXR1cm4gSDVQLmNyZWF0ZVRpdGxlKHJhdyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBsYW5ndWFnZSB0YWcgKFJGQyA1NjQ2KS4gQXNzdW1pbmcgXCJsYW5ndWFnZS1jb3V0cnlcIi4gTm8gdmFsaWRhdGlvbi5cbiAgICogQ21wLiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTY0NlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2VUYWcgTGFuZ3VhZ2UgdGFnLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IEZvcm1hdHRlZCBsYW5ndWFnZSB0YWcuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5mb3JtYXRMYW5ndWFnZUNvZGUgPSBmdW5jdGlvbiAobGFuZ3VhZ2VDb2RlKSB7XG4gICAgaWYgKHR5cGVvZiBsYW5ndWFnZUNvZGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VDb2RlO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogUkZDIDU2NDYgc3RhdGVzIHRoYXQgbGFuZ3VhZ2UgdGFncyBhcmUgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0XG4gICAgICogcmVjb21tZW5kYXRpb25zIG1heSBiZSBmb2xsb3dlZCB0byBpbXByb3ZlIGh1bWFuIGludGVycHJldGF0aW9uXG4gICAgICovXG4gICAgY29uc3Qgc2VnbWVudHMgPSBsYW5ndWFnZUNvZGUuc3BsaXQoJy0nKTtcbiAgICBzZWdtZW50c1swXSA9IHNlZ21lbnRzWzBdLnRvTG93ZXJDYXNlKCk7IC8vIElTTyA2MzkgcmVjb21tZW5kYXRpb25cbiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgc2VnbWVudHNbMV0gPSBzZWdtZW50c1sxXS50b1VwcGVyQ2FzZSgpOyAvLyBJU08gMzE2Ni0xIHJlY29tbWVuZGF0aW9uXG4gICAgfVxuICAgIGxhbmd1YWdlQ29kZSA9IHNlZ21lbnRzLmpvaW4oJy0nKTtcblxuICAgIHJldHVybiBsYW5ndWFnZUNvZGU7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRydWUgc3RyaW5nIGZyb20gSFRNTCBlbmNvZGVkIHN0cmluZ1xuICAgKiBAcGFyYW0ge3N0cmluZ30gaW5wdXQgLSBJbnB1dCBzdHJpbmcuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gT3V0cHV0IHN0cmluZy5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5odG1sRGVjb2RlID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgY29uc3QgZHBhcnNlciA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaW5wdXQsICd0ZXh0L2h0bWwnKTtcbiAgICByZXR1cm4gZHBhcnNlci5kb2N1bWVudEVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHN0YXRlIGZvciBINVAuUXVlc3Rpb24uXG4gICAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBzdGF0ZS5cbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLnByb3RvdHlwZS5nZXRDdXJyZW50U3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0RmllbGQpIHtcbiAgICAgIHJldHVybjsgLy8gbWF5IG5vdCBiZSBhdHRhY2hlZCB0byB0aGUgRE9NIHlldFxuICAgIH1cblxuICAgLy8gdGhpcy5pbnB1dEZpZWxkLnVwZGF0ZU1lc3NhZ2VTYXZlZCh0aGlzLnBhcmFtcy5tZXNzYWdlU2F2ZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaW5wdXRGaWVsZDogdGhpcy5pbnB1dEZpZWxkLmdldFRleHQoKSxcbiAgICAgIHZpZXdTdGF0ZTogdGhpcy52aWV3U3RhdGVcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXQgdmlldyBzdGF0ZS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0YXRlIFZpZXcgc3RhdGUuXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5wcm90b3R5cGUuc2V0Vmlld1N0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgaWYgKEVzc2F5U2NvcmU0TE1TLlZJRVdfU1RBVEVTLmluZGV4T2Yoc3RhdGUpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudmlld1N0YXRlID0gc3RhdGU7XG4gIH07XG5cbiAgLyoqIEBjb25zdGFudCB7c3RyaW5nfVxuICAgKiBsYXRpbiBzcGVjaWFsIGNoYXJzOiBcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAwRkZcbiAgICogZ3JlZWsgY2hhcnM6IFxcdTAzNzAtXFx1MDNGRlxuICAgKiBreXJpbGxpYyBjaGFyczogXFx1MDQwMC1cXHUwNEZGXG4gICAqIGhpcmFnYW5hICsga2F0YWthbmE6IFxcdTMwNDAtXFx1MzBGRlxuICAgKiBjb21tb24gQ0pLIGNoYXJhY3RlcnM6IFxcdTRFMDAtXFx1NjJGRlxcdTYzMDAtXFx1NzdGRlxcdTc4MDAtXFx1OENGRlxcdThEMDAtXFx1OUZGRlxuICAgKiB0aGFpIGNoYXJzOiBcXHUwRTAwLVxcdTBFN0ZcbiAgICovXG4gIEVzc2F5U2NvcmU0TE1TLkNIQVJTX1dJTERDQVJEID0gJ1tBLXpcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAwRkZcXHUwMzcwLVxcdTAzRkZcXHUwNDAwLVxcdTA0RkZcXHUzMDQwLVxcdTMwOUZcXHUzMDQwLVxcdTMwRkZcXHU0RTAwLVxcdTYyRkZcXHU2MzAwLVxcdTc3RkZcXHU3ODAwLVxcdThDRkZcXHU4RDAwLVxcdTlGRkZcXHUwRTAwLVxcdTBFN0ZdJztcblxuICAvKiogQGNvbnN0YW50IHtzdHJpbmd9XG4gICAqIFJlcXVpcmVkIHRvIGJlIGFkZGVkIHRvIHhBUEkgb2JqZWN0IGRlc2NyaXB0aW9uIGZvciBINVAgcmVwb3J0aW5nXG4gICAqL1xuICBFc3NheVNjb3JlNExNUy5GSUxMX0lOX1BMQUNFSE9MREVSID0gJ19fX19fX19fX18nO1xuXG4gIC8qKiBAY29uc3RhbnQge3N0cmluZ30gKi9cbiAgRXNzYXlTY29yZTRMTVMuREVGQVVMVF9ERVNDUklQVElPTiA9ICdFc3NheVNjb3JlNExNUyc7XG5cbiAgLyoqIEBjb25zdGFudCB7c3RyaW5nfSAqL1xuICBFc3NheVNjb3JlNExNUy5SRUdVTEFSX0VYUFJFU1NJT05fQVNURVJJU0sgPSAnOjo6SDVQLUVzc2F5U2NvcmU0TE1TLVJFR0VYUC1BU1RFUklTSzo6Oic7XG5cbiAgLyoqIEBjb25zdGFudCB7c3RyaW5nW119IHZpZXcgc3RhdGUgbmFtZXMqL1xuICBFc3NheVNjb3JlNExNUy5WSUVXX1NUQVRFUyA9IFsndGFzaycsICdyZXN1bHRzJywgJ3NvbHV0aW9ucyddO1xuXG4gIHJldHVybiBFc3NheVNjb3JlNExNUztcbn0oSDVQLmpRdWVyeSwgSDVQLlF1ZXN0aW9uKTtcbiJdLCJuYW1lcyI6WyJINVAiLCJFc3NheVNjb3JlNExNUyIsIiQiLCJRdWVzdGlvbiIsIkZFRURCQUNLX0VNUFRZIiwiY29uZmlnIiwiY29udGVudElkIiwiY29udGVudERhdGEiLCJjYWxsIiwidGhpcyIsInBhcmFtcyIsImV4dGVuZCIsIm1lZGlhIiwidGFza0Rlc2NyaXB0aW9uIiwiY2hlY2tBbnN3ZXIiLCJleHRyYXMiLCJjb25zb2xlIiwibG9nIiwiZGVmYXVsdExhbmd1YWdlIiwibWV0YWRhdGEiLCJsYW5ndWFnZVRhZyIsImZvcm1hdExhbmd1YWdlQ29kZSIsInNjb3JlIiwiaW50ZXJuYWxTaG93U29sdXRpb25zQ2FsbCIsInByZXZpb3VzU3RhdGUiLCJpc0Fuc3dlcmVkIiwiaW5wdXRGaWVsZCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJ1cGRhdGVTY29yZSIsInByb3RvdHlwZSIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwicmVnaXN0ZXJEb21FbGVtZW50cyIsInRoYXQiLCJ0eXBlIiwidW5kZWZpbmVkIiwibGlicmFyeSIsInNwbGl0IiwiZmlsZSIsInNldEltYWdlIiwicGF0aCIsImRpc2FibGVJbWFnZVpvb21pbmciLCJhbHQiLCJ0aXRsZSIsInNvdXJjZXMiLCJzZXRWaWRlbyIsImZpbGVzIiwic2V0QXVkaW8iLCJJbnB1dEZpZWxkIiwib25JbnRlcmFjdGVkIiwiaGFuZGxlSW50ZXJhY3RlZCIsIm9uSW5wdXQiLCJoYW5kbGVJbnB1dCIsInNldFZpZXdTdGF0ZSIsInZpZXdTdGF0ZSIsImV4dGVybmFsRGlzcGF0Y2hlciIsIm9uIiwiaGFuZGxlQ2hlY2tBbnN3ZXIiLCJza2lwWEFQSSIsInNob3dTb2x1dGlvbnMiLCJjb250ZW50IiwiZ2V0Q29udGVudCIsInNldENvbnRlbnQiLCJhZGRCdXR0b25zIiwiYWRkQnV0dG9uIiwiZGlzYWJsZSIsImhhbmRsZUV2YWx1YXRpb24iLCJoaWRlQnV0dG9uIiwiZ2V0SW5wdXQiLCJsaW5lYnJlYWtSZXBsYWNlbWVudCIsInVzZXJUZXh0IiwiZ2V0VGV4dCIsInJlcGxhY2UiLCJ0cmlnZ2VyWEFQSSIsImdldEFuc3dlckdpdmVuIiwiZ2V0U2NvcmUiLCJNYXRoIiwicm91bmQiLCJ0cmlnZ2VyIiwicmVzZXRUYXNrIiwic2V0RXhwbGFuYXRpb24iLCJyZW1vdmVGZWVkYmFjayIsImhpZGVTb2x1dGlvbiIsImVuYWJsZSIsImZvY3VzIiwiZ2V0WEFQSURhdGEiLCJzdGF0ZW1lbnQiLCJnZXRYQVBJQW5zd2VyRXZlbnQiLCJkYXRhIiwiaXNQYXNzZWQiLCJyZXN1bHRzIiwiY29tcHV0ZVJlc3VsdHMiLCJidWlsZEV4cGxhbmF0aW9uIiwiaGFuZGxlWEFQSSIsImJ1aWxkU29sdXRpb24iLCJzb2x1dGlvbiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNvbHV0aW9uQW5ub3VuY2VyIiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiYmx1ciIsImFwcGVuZENoaWxkIiwic29sdXRpb25TYW1wbGUiLCJTT0xVVElPTl9TQU1QTEUiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJjb21wdXRlU2NvcmUiLCJleHBsYW5hdGlvbnMiLCJzb3J0IiwiYSIsImIiLCJjb3JyZWN0IiwiaGFuZGxlQnV0dG9ucyIsImNyZWF0ZUVzc2F5WEFQSUV2ZW50IiwidmVyYiIsInhBUElFdmVudCIsImNyZWF0ZVhBUElFdmVudFRlbXBsYXRlIiwiZ2V0VmVyaWZpZWRTdGF0ZW1lbnRWYWx1ZSIsImdldHhBUElEZWZpbml0aW9uIiwiZGVmaW5pdGlvbiIsIm5hbWUiLCJnZXRUaXRsZSIsImRlc2NyaXB0aW9uIiwiRklMTF9JTl9QTEFDRUhPTERFUiIsImludGVyYWN0aW9uVHlwZSIsInNldFNjb3JlZFJlc3VsdCIsInJlc3VsdCIsInJlc3BvbnNlIiwiZGV0ZWN0RXhhY3RNYXRjaGVzIiwibmVlZGxlIiwiaGF5c3RhY2siLCJwb3MiLCJmcm9udCIsIlJlZ0V4cCIsIlJFR1VMQVJfRVhQUkVTU0lPTl9BU1RFUklTSyIsImluZGV4T2YiLCJUZXh0VXRpbGl0aWVzIiwiaXNJc29sYXRlZCIsInB1c2giLCJzdWJzdHIiLCJkZXRlY3RXaWxkY2FyZE1hdGNoZXMiLCJjYXNlU2Vuc2l0aXZlIiwiZm9yRWFjaCIsImNoYXIiLCJqb2luIiwicmVnZXhwIiwiQ0hBUlNfV0lMRENBUkQiLCJnZXRSZWdFeHBNb2RpZmllcnMiLCJtYXRjaCIsImV4ZWMiLCJpbmRleCIsImRldGVjdEZ1enp5TWF0Y2hlcyIsInNpemUiLCJzdHJhdyIsImFyZVNpbWlsYXIiLCJjb250YWlucyIsImdldFJlZ0V4cEFsdGVybmF0aXZlcyIsImFsdGVybmF0aXZlcyIsImlucHV0VGVzdCIsImZpbHRlciIsImFsdGVybmF0aXZlIiwibWFwIiwicmVnTmVlZGxlIiwic2xpY2UiLCJyZWR1Y2UiLCJjb25jYXQiLCJpdGVtIiwibW9kaWZpZXJzIiwibWVyZ2VNYXRjaGVzIiwiYXJndW1lbnRzIiwiaSIsIm1hdGNoMiIsImoiLCJzb21lIiwiYWJzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJyYXciLCJERUZBVUxUX0RFU0NSSVBUSU9OIiwiY3JlYXRlVGl0bGUiLCJsYW5ndWFnZUNvZGUiLCJzZWdtZW50cyIsInRvTG93ZXJDYXNlIiwidG9VcHBlckNhc2UiLCJodG1sRGVjb2RlIiwiaW5wdXQiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJkb2N1bWVudEVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImdldEN1cnJlbnRTdGF0ZSIsInN0YXRlIiwiVklFV19TVEFURVMiLCJqUXVlcnkiXSwic291cmNlUm9vdCI6IiJ9